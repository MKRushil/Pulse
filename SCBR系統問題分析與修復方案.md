# SCBR ç³»çµ±å•é¡Œåˆ†æèˆ‡ä¿®å¾©æ–¹æ¡ˆ

## ä¸€ã€æ ¸å¿ƒå•é¡Œç¸½è¦½

### 1. **è¼¸å‡ºé©—è­‰å™¨åƒæ•¸éŒ¯èª¤** âš ï¸ **ç·Šæ€¥**
- **å•é¡Œ**: `output_validator.validate()` è¢«èª¿ç”¨æ™‚ä½¿ç”¨äº†éŒ¯èª¤çš„åƒæ•¸åç¨± `output_text`ï¼Œä½†è©²æ–¹æ³•å¯¦éš›æ¥å—çš„åƒæ•¸åç¨±æ˜¯ `llm_output`
- **ä½ç½®**: `main.py` ç¬¬ 441 è¡Œ
- **å½±éŸ¿**: å°è‡´æ‰€æœ‰è¨ºæ–·è«‹æ±‚éƒ½è¿”å› 400 Bad Request
- **ä¿®å¾©**: å°‡ `output_text` æ”¹ç‚º `llm_output`

### 2. **è¾¨è­‰æ¨ç†å›ºå®šè¼¸å‡ºå•é¡Œ** âš ï¸ **åš´é‡**
- **å•é¡Œ**: æ¯æ¬¡è¨ºæ–·éƒ½è¼¸å‡ºã€Œç—…åã€‘é›œç—… ã€ç—…æ©Ÿã€‘ç—…æ©Ÿå¾…å®šï¼Œéœ€é€²ä¸€æ­¥è¾¨è­‰ ã€æ²»å‰‡ã€‘è¾¨è­‰æ–½æ²» éš¨ç—‡åŠ æ¸›ã€
- **åŸå› **: 
  - `pattern_diagnosis.py` ä¸­çš„ `_infer_tcm_disease()` æ–¹æ³•éæ–¼ç°¡å–®ï¼Œåªæ ¹æ“šæœ‰é™çš„ç—‡ç‹€é—œéµå­—åŒ¹é…
  - ç•¶ç—‡ç‹€ç„¡æ³•åŒ¹é…æ™‚ï¼Œç›´æ¥è¿”å›ã€Œé›œç—…ã€
  - ç—…æ©Ÿæ¨å°åªä¾è³´ç°¡å–®çš„å­—å…¸æ˜ å°„ï¼Œç„¡æ³•è™•ç†è¤‡é›œæƒ…æ³
- **å½±éŸ¿**: è¨ºæ–·çµæœç¼ºä¹å¯¦ç”¨åƒ¹å€¼

### 3. **æ¡ˆä¾‹æª¢ç´¢ä½†æœªä½¿ç”¨å•é¡Œ** âš ï¸ **åš´é‡**
- **å•é¡Œ**: é›–ç„¶æª¢ç´¢åˆ° 30 å€‹ TCMCaseï¼Œä½†ï¼š
  - æ²’æœ‰çœŸæ­£åˆ©ç”¨é€™äº›æ¡ˆä¾‹é€²è¡Œæ¨ç†
  - åªæ˜¯ç°¡å–®æå– syndrome_termsï¼Œæœªæ·±åº¦åˆ†ææ¡ˆä¾‹å…§å®¹
  - æ²’æœ‰ä½¿ç”¨æ¡ˆä¾‹çš„è¨ºæ–·çµæœã€æ²»ç™‚æ–¹æ¡ˆç­‰é—œéµä¿¡æ¯
- **ä½ç½®**: `pattern_diagnosis.py` çš„ `_extract_patterns_from_cases()` æ–¹æ³•
- **å½±éŸ¿**: æµªè²»æª¢ç´¢è³‡æºï¼Œè¨ºæ–·æº–ç¢ºåº¦ä½

### 4. **è¼ªæ¬¡ç®¡ç†å•é¡Œ** âš ï¸ **åš´é‡**
- **å•é¡Œ**: ç³»çµ±å§‹çµ‚åœç•™åœ¨ç¬¬ 1 è¼ªï¼Œç„¡æ³•æ­£ç¢ºé€²è¡Œå¤šè¼ªèºæ—‹æ¨ç†
- **åŸå› **:
  - `main.py` ä¸­çš„ `continue_spiral` åƒæ•¸æœªæ­£ç¢ºå‚³é
  - æœƒè©±ç®¡ç†å™¨çš„è¼ªæ¬¡è¨ˆæ•¸æœªæ­£ç¢ºæ›´æ–°
  - å‰ç«¯å¯èƒ½æ²’æœ‰æ­£ç¢ºè¨­ç½® `continue_spiral=True`
- **å½±éŸ¿**: ç„¡æ³•é€²è¡Œå¤šè¼ªè¨ºæ–·å„ªåŒ–

### 5. **ç´¯ç©å•é¡Œç®¡ç†ç¼ºé™·** âš ï¸ **åš´é‡**
- **å•é¡Œ**: ç³»çµ±æœªæ­£ç¢ºå¯¦ç¾ã€Œå‰ä¸€å€‹å•é¡Œ + è£œå……æ¢ä»¶ã€çš„ç´¯ç©æ¨¡å¼
- **ä½ç½®**: `dialog_manager.py` çš„ `add_question()` æ–¹æ³•
- **ç¾ç‹€**: é›–ç„¶æœ‰ç´¯ç©é‚è¼¯ï¼Œä½†åœ¨ `main.py` ä¸­ä½¿ç”¨æ™‚æœªæ­£ç¢ºç´¯ç©ç—‡ç‹€å’Œä¸Šä¸‹æ–‡
- **å½±éŸ¿**: æ¯è¼ªè¨ºæ–·éƒ½åƒæ˜¯å…¨æ–°é–‹å§‹ï¼Œå¤±å»æ­·å²ä¿¡æ¯

### 6. **è©•ä¼°æŒ‡æ¨™å¤±æ•ˆ** âš ï¸ **ä¸­ç­‰**
- **å•é¡Œ**: æ”¶æ–‚åº¦è©•ä¼°ä¸€ç›´é¡¯ç¤ºéŒ¯èª¤æˆ–ä¸æº–ç¢ºçš„å€¼
- **åŸå› **:
  - `convergence.py` ä¸­çš„æŒ‡æ¨™è¨ˆç®—é‚è¼¯éæ–¼ç°¡å–®
  - RCIï¼ˆè¾¨è­‰ä¸€è‡´æ€§æŒ‡æ•¸ï¼‰ç¸½æ˜¯ç‚º 0.000
  - CMSï¼ˆè­‰æ“šåŒ¹é…åˆ†æ•¸ï¼‰ç¸½æ˜¯ç‚º 0.400
- **å½±éŸ¿**: ç„¡æ³•æ­£ç¢ºåˆ¤æ–·ä½•æ™‚çµ‚æ­¢èºæ—‹æ¨ç†

### 7. **è£œå•æ©Ÿåˆ¶æœªé¡¯ç¤ºåœ¨å‰ç«¯** âš ï¸ **ä¸­ç­‰**
- **å•é¡Œ**: è£œå•å•é¡Œåªè¨˜éŒ„åœ¨å¾Œç«¯æ—¥èªŒä¸­ï¼Œæœªè¿”å›çµ¦å‰ç«¯
- **åŸå› **: API éŸ¿æ‡‰çµæ§‹å•é¡Œ
- **å½±éŸ¿**: ç”¨æˆ¶ç„¡æ³•çœ‹åˆ°ç³»çµ±éœ€è¦å“ªäº›è£œå……ä¿¡æ¯

### 8. **æ¡ˆä¾‹èåˆèˆ‡é‡æ’é‚è¼¯å†—é¤˜** âš ï¸ **è¼•å¾®**
- **å•é¡Œ**: å¦‚æœåªé¸æ“‡ top-1 æ¡ˆä¾‹ï¼Œå‰‡ RRF èåˆã€MMR é‡æ’éƒ½æ˜¯å¤šé¤˜çš„
- **ä½ç½®**: `dynamic_retrieval.py`
- **å»ºè­°**: ç°¡åŒ–ç‚ºç›´æ¥é¸æ“‡ top-k æ¡ˆä¾‹ï¼ˆk=5ï¼‰ï¼Œå¯¦ç”¨æ¡ˆä¾‹æ•¸=1

### 9. **Knowledge å’Œ Prompts è³‡æ–™å¤¾æœªæ•´åˆ** âš ï¸ **ä¸­ç­‰**
- **å•é¡Œ**: ç³»çµ±æœªä½¿ç”¨ knowledge è³‡æ–™å¤¾çš„è£œå……çŸ¥è­˜å’Œ prompts è³‡æ–™å¤¾çš„è¼¸å‡ºæ¨¡æ¿
- **å½±éŸ¿**: è¨ºæ–·çµæœç¼ºä¹æ·±åº¦å’Œè¦ç¯„æ€§

### 10. **Jieba åˆ†æå™¨æå–å¤±æ•—** âš ï¸ **è¼•å¾®**
- **å•é¡Œ**: æ—¥èªŒé¡¯ç¤ºã€ŒJiebaåˆ†æå™¨æœªèƒ½æå–åˆ°æœ‰æ•ˆç—‡ç‹€ã€
- **åŸå› **: ç”¨æˆ¶è¼¸å…¥çš„ç—‡ç‹€æè¿°èˆ‡è©å…¸ä¸åŒ¹é…
- **å½±éŸ¿**: æª¢ç´¢æ•ˆæœå·®ï¼Œç—‡ç‹€è­˜åˆ¥ä¸æº–

## äºŒã€è©³ç´°ä¿®å¾©æ–¹æ¡ˆ

### ä¿®å¾© 1: è¼¸å‡ºé©—è­‰å™¨åƒæ•¸éŒ¯èª¤

**æ–‡ä»¶**: `main.py` ç¬¬ 441 è¡Œ

```python
# éŒ¯èª¤ä»£ç¢¼
validation_result = self.output_validator.validate(
    output_text=result.get("final_text", ""),  # âŒ éŒ¯èª¤çš„åƒæ•¸å
    context={...}
)

# ä¿®å¾©ä»£ç¢¼
validation_result = self.output_validator.validate(
    llm_output=result.get("final_text", ""),  # âœ… æ­£ç¢ºçš„åƒæ•¸å
    context={...}
)
```

### ä¿®å¾© 2: å¢å¼·è¾¨è­‰æ¨ç†é‚è¼¯

**æ–‡ä»¶**: `pattern_diagnosis.py`

éœ€è¦å®Œå…¨é‡å¯« `_pattern_reasoning()` å’Œ `_diagnosis_reasoning()` æ–¹æ³•ï¼Œä½¿å…¶ï¼š

1. **æ·±åº¦åˆ†ææ¡ˆä¾‹å…§å®¹**ï¼š
   - æå–æ¡ˆä¾‹çš„å®Œæ•´è¨ºæ–·é‚è¼¯
   - åˆ†ææ¡ˆä¾‹çš„ç—‡ç‹€çµ„åˆæ¨¡å¼
   - è€ƒæ…®æ¡ˆä¾‹çš„æ²»ç™‚æ•ˆæœ

2. **ä½¿ç”¨ LLM é€²è¡Œæ¨ç†**ï¼ˆå¦‚æœå•Ÿç”¨ï¼‰ï¼š
   - å°‡å‰ 5 å€‹æ¡ˆä¾‹ä½œç‚ºåƒè€ƒ
   - ä½¿ç”¨ LLM é€²è¡Œè¾¨è­‰åˆ†æ
   - ç”Ÿæˆç—…åã€ç—…æ©Ÿã€æ²»å‰‡

3. **å»ºç«‹æ›´å®Œæ•´çš„ç—‡ç‹€-è­‰å‹æ˜ å°„**ï¼š
   - æ“´å±• `eight_principles_map`
   - æ“´å±• `zangfu_map`
   - å¢åŠ ç—‡ç‹€çµ„åˆæ¨¡å¼è­˜åˆ¥

### ä¿®å¾© 3: æ­£ç¢ºç®¡ç†è¼ªæ¬¡å’Œç´¯ç©å•é¡Œ

**æ–‡ä»¶**: `main.py` ç¬¬ 260-292 è¡Œ

```python
# ç•¶å‰å•é¡Œï¼šè¼ªæ¬¡ç®¡ç†é‚è¼¯ä¸æ¸…æ™°
# éœ€è¦æ”¹é€²ç‚ºï¼š

# 1. å¦‚æœæ˜¯ç¹¼çºŒæœƒè©±ï¼Œå‰‡ç´¯ç©å•é¡Œ
if continue_spiral and session_id:
    session = self.dialog.get_session(session_id)
    if session:
        # ç´¯ç©æ–°å•é¡Œåˆ°ä¹‹å‰çš„å•é¡Œä¸­
        session.add_question(cleaned_question)
        # å¢åŠ è¼ªæ¬¡
        round_num = self.dialog.increment_round(session_id)
        logger.info(f"â• ç¹¼çºŒæœƒè©± {session_id[:8]}***: è¼ªæ¬¡ {round_num}")
    else:
        # æœƒè©±ä¸å­˜åœ¨ï¼Œå‰µå»ºæ–°æœƒè©±
        session_id = self.dialog.create_session(cleaned_question, patient_ctx or {})
        round_num = 1
        logger.info(f"ğŸ†• å‰µå»ºæ–°æœƒè©±: {session_id}")
else:
    # å‰µå»ºæ–°æœƒè©±
    session_id = self.dialog.create_session(cleaned_question, patient_ctx or {})
    round_num = 1
    logger.info(f"ğŸ†• å‰µå»ºæ–°æœƒè©±: {session_id}")

# 2. ç²å–ç´¯ç©å•é¡Œï¼ˆåŒ…å«æ‰€æœ‰æ­·å²å•é¡Œï¼‰
session = self.dialog.get_session(session_id)
accumulated_question = session.get_accumulated_question()

logger.info(f"ğŸ“ ç´¯ç©å•é¡Œ: {accumulated_question[:100]}...")
logger.info(f"ğŸ”¢ ç•¶å‰è¼ªæ¬¡: {round_num}")
```

### ä¿®å¾© 4: æ”¹é€²è©•ä¼°æŒ‡æ¨™

**æ–‡ä»¶**: `convergence.py`

éœ€è¦é‡æ–°è¨­è¨ˆè©•ä¼°æŒ‡æ¨™çš„è¨ˆç®—æ–¹æ³•ï¼š

1. **RCIï¼ˆè¾¨è­‰ä¸€è‡´æ€§æŒ‡æ•¸ï¼‰**ï¼š
   - æ¯”è¼ƒç•¶å‰è¼ªèˆ‡ä¸Šä¸€è¼ªçš„è­‰å‹åˆ¤æ–·
   - å¦‚æœè­‰å‹ç©©å®šï¼ŒRCI å¢åŠ 

2. **CMSï¼ˆè­‰æ“šåŒ¹é…åˆ†æ•¸ï¼‰**ï¼š
   - è¨ˆç®—ç—‡ç‹€èˆ‡æ¡ˆä¾‹çš„å¯¦éš›åŒ¹é…åº¦
   - è€ƒæ…®ç—‡ç‹€è¦†è“‹ç‡

3. **CSCï¼ˆè­‰å€™ç©©å®šä¿‚æ•¸ï¼‰**ï¼š
   - è¿½è¹¤è­‰å‹è®ŠåŒ–
   - è¨ˆç®—ç©©å®šæ€§

### ä¿®å¾© 5: è£œå•æ©Ÿåˆ¶å‰ç«¯é¡¯ç¤º

**æ–‡ä»¶**: `main.py` ç¬¬ 480-500 è¡Œ

ç¢ºä¿ API éŸ¿æ‡‰åŒ…å«è£œå•å•é¡Œï¼š

```python
return {
    "session_id": session_id,
    "round": round_num,
    "diagnosis": {
        "pattern": result.get("pattern_diagnosis", {}),
        "text": result.get("final_text", "")
    },
    "gap_questions": gap_questions,  # âœ… ç¢ºä¿åŒ…å«è£œå•
    "can_continue": not should_stop,
    "convergence": convergence_metrics,
    "trace_id": trace_id
}
```

### ä¿®å¾© 6: ç°¡åŒ–æ¡ˆä¾‹æª¢ç´¢é‚è¼¯

**æ–‡ä»¶**: `dynamic_retrieval.py`

```python
# å¦‚æœåªéœ€è¦ top-1 æ¡ˆä¾‹ç”¨æ–¼æ¨ç†ï¼Œç°¡åŒ–æµç¨‹ï¼š
async def optimized_retrieval(self, ...):
    # 1. ç›´æ¥æœç´¢ top-k=5
    case_results = await self.search_engine.search_tcmcase(...)
    
    # 2. é¸æ“‡æœ€ä½³æ¡ˆä¾‹ï¼ˆtop-1ï¼‰
    best_case = case_results[0] if case_results else None
    
    # 3. è¿”å›çµæœ
    return {
        "case": case_results[:5],  # è¿”å›å‰ 5 å€‹ä¾›åƒè€ƒ
        "best_case": best_case,     # æ¨™è¨˜æœ€ä½³æ¡ˆä¾‹
        "rpcase": rpcase_results
    }
```

### ä¿®å¾© 7: æ•´åˆ Knowledge å’Œ Prompts

éœ€è¦å‰µå»ºæ–°çš„æ¨¡çµ„ä¾†æ•´åˆé€™äº›è³‡æºï¼š

1. **Knowledge æ•´åˆå™¨** (`knowledge_integrator.py`):
   - è®€å– knowledge è³‡æ–™å¤¾çš„è£œå……çŸ¥è­˜
   - åœ¨è¨ºæ–·æ™‚æä¾›ç›¸é—œçŸ¥è­˜ä½œç‚ºä¸Šä¸‹æ–‡

2. **Prompt æ¨¡æ¿ç®¡ç†å™¨** (`prompt_manager.py`):
   - è®€å– prompts è³‡æ–™å¤¾çš„è¼¸å‡ºæ¨¡æ¿
   - æ ¼å¼åŒ–è¨ºæ–·çµæœ

### ä¿®å¾© 8: å¢å¼· Jieba ç—‡ç‹€æå–

**æ–‡ä»¶**: `spiral_engine.py`

```python
# åœ¨ STEP 1 å¾Œæ·»åŠ å›é€€æ©Ÿåˆ¶
analysis = self.jieba_processor.analyze_case(question)
symptoms = analysis.get("symptom", [])

# å¦‚æœ Jieba æœªèƒ½æå–ç—‡ç‹€ï¼Œå˜—è©¦ä½¿ç”¨ LLM æå–
if not symptoms and self.llm:
    try:
        llm_symptoms = await self._extract_symptoms_with_llm(question)
        symptoms = llm_symptoms
        logger.info(f"âœ… LLM æå–åˆ° {len(symptoms)} å€‹ç—‡ç‹€")
    except Exception as e:
        logger.warning(f"âš ï¸ LLM ç—‡ç‹€æå–å¤±æ•—: {e}")
```

## ä¸‰ã€æ–‡ä»¶ä¾è³´é—œä¿‚ç¢ºèª

### æ ¸å¿ƒä¾è³´
```
main.py (SCBREngine)
    â”œâ”€â”€ input_sanitizer.py (è¼¸å…¥æ·¨åŒ–) âœ…
    â”œâ”€â”€ dialog_manager.py (æœƒè©±ç®¡ç†) âœ…
    â”œâ”€â”€ spiral_engine.py (èºæ—‹æ¨ç†) âœ…
    â”‚   â”œâ”€â”€ search_engine.py (æª¢ç´¢å¼•æ“) âœ…
    â”‚   â”œâ”€â”€ dynamic_retrieval.py (å‹•æ…‹æª¢ç´¢) âœ…
    â”‚   â”œâ”€â”€ pattern_diagnosis.py (è¾¨è­‰è¨ºæ–·) âœ…
    â”‚   â”œâ”€â”€ output_formatter.py (è¼¸å‡ºæ ¼å¼åŒ–) âœ…
    â”‚   â””â”€â”€ convergence.py (æ”¶æ–‚åº¦è©•ä¼°) âœ…
    â”œâ”€â”€ gap_asker.py (è£œå•ç”Ÿæˆ) âœ…
    â”œâ”€â”€ output_validator.py (è¼¸å‡ºé©—è­‰) âœ…
    â”œâ”€â”€ self_reviewer.py (è‡ªæˆ‘å¯©ç¨¿) âœ…
    â”œâ”€â”€ stop_criteria.py (çµ‚æ­¢æ¢ä»¶) âœ…
    â””â”€â”€ rpcase_manager.py (å¯¦ç”¨æ¡ˆä¾‹ç®¡ç†) âœ…
```

### æœªä½¿ç”¨ä½†é‡è¦çš„æ–‡ä»¶
```
âŒ knowledge/ (è£œå……çŸ¥è­˜è³‡æ–™å¤¾) - éœ€è¦æ•´åˆ
âŒ prompts/ (è¼¸å‡ºæ¨¡æ¿è³‡æ–™å¤¾) - éœ€è¦æ•´åˆ
âš ï¸ constitution_classifier.py (é«”è³ªåˆ†é¡) - å¯é¸æ•´åˆ
âš ï¸ pathogenesis_engine.py (ç—…æ©Ÿå¼•æ“) - å¯é¸æ•´åˆ
âš ï¸ query_expander.py (æŸ¥è©¢æ“´å±•) - å¯é¸æ•´åˆ
âš ï¸ temporal_smoother.py (æ™‚åºå¹³æ»‘) - å¯é¸æ•´åˆ
```

### é‡è¤‡æˆ–å†—é¤˜çš„æ–‡ä»¶
```
âš ï¸ pattern_shifter.py - åŠŸèƒ½å¯èƒ½èˆ‡ pattern_diagnosis.py é‡è¤‡
âš ï¸ syndrome_analyzer.py - åŠŸèƒ½å¯èƒ½èˆ‡ pattern_diagnosis.py é‡è¤‡
âš ï¸ discriminative_weights.py - å¦‚æœä¸ä½¿ç”¨åŠ æ¬Šï¼Œå¯ç§»é™¤
```

## å››ã€å„ªå…ˆç´šä¿®å¾©é †åº

### ç¬¬ä¸€éšæ®µï¼šç·Šæ€¥ä¿®å¾©ï¼ˆ1-2 å¤©ï¼‰
1. âœ… ä¿®å¾©è¼¸å‡ºé©—è­‰å™¨åƒæ•¸éŒ¯èª¤
2. âœ… ä¿®æ­£è¼ªæ¬¡ç®¡ç†é‚è¼¯
3. âœ… ä¿®æ­£ç´¯ç©å•é¡Œé‚è¼¯
4. âœ… ç¢ºä¿è£œå•é¡¯ç¤ºåœ¨å‰ç«¯

### ç¬¬äºŒéšæ®µï¼šæ ¸å¿ƒå„ªåŒ–ï¼ˆ3-5 å¤©ï¼‰
1. âœ… é‡å¯«è¾¨è­‰æ¨ç†é‚è¼¯
2. âœ… æ”¹é€²æ¡ˆä¾‹åˆ©ç”¨æ–¹å¼
3. âœ… ä¿®æ­£è©•ä¼°æŒ‡æ¨™
4. âœ… å¢å¼·ç—‡ç‹€æå–

### ç¬¬ä¸‰éšæ®µï¼šåŠŸèƒ½å®Œå–„ï¼ˆ5-7 å¤©ï¼‰
1. âœ… æ•´åˆ Knowledge è³‡æ–™å¤¾
2. âœ… æ•´åˆ Prompts è³‡æ–™å¤¾
3. âœ… å„ªåŒ–æª¢ç´¢é‚è¼¯
4. âœ… å¢åŠ é«”è³ªåˆ†é¡

## äº”ã€æ¸¬è©¦é©—è­‰è¨ˆåŠƒ

### æ¸¬è©¦æ¡ˆä¾‹
1. **å–®è¼ªè¨ºæ–·æ¸¬è©¦**ï¼š
   - è¼¸å…¥ç°¡å–®ç—‡ç‹€ï¼Œé©—è­‰è¨ºæ–·çµæœ
   - æª¢æŸ¥æ˜¯å¦æ­£ç¢ºè¼¸å‡ºç—…åã€ç—…æ©Ÿã€æ²»å‰‡

2. **å¤šè¼ªè¨ºæ–·æ¸¬è©¦**ï¼š
   - ç¬¬ 1 è¼ªï¼šåˆå§‹ç—‡ç‹€
   - ç¬¬ 2 è¼ªï¼šè£œå……ç—‡ç‹€
   - ç¬¬ 3 è¼ªï¼šå†è£œå……
   - é©—è­‰ç´¯ç©å•é¡Œå’Œè¼ªæ¬¡ç®¡ç†

3. **é‚Šç•Œæ¸¬è©¦**ï¼š
   - SQL æ³¨å…¥æ¸¬è©¦
   - å‘½ä»¤æ³¨å…¥æ¸¬è©¦
   - è¶…é•·è¼¸å…¥æ¸¬è©¦

4. **æ€§èƒ½æ¸¬è©¦**ï¼š
   - ä¸¦ç™¼è«‹æ±‚æ¸¬è©¦
   - éŸ¿æ‡‰æ™‚é–“æ¸¬è©¦
   - è¨˜æ†¶é«”ä½¿ç”¨æ¸¬è©¦

## å…­ã€å»ºè­°çš„ç¨‹å¼ç¢¼è¨»è§£æ¨™æº–

æ¯å€‹å‡½æ•¸éƒ½æ‡‰è©²åŒ…å«ï¼š

```python
def function_name(param1: type, param2: type) -> return_type:
    """
    å‡½æ•¸ç°¡è¿°ï¼ˆä¸€å¥è©±èªªæ˜åŠŸèƒ½ï¼‰
    
    è©³ç´°èªªæ˜ï¼š
    - é€™å€‹å‡½æ•¸è² è²¬ä»€éº¼
    - ä¸»è¦çš„è™•ç†é‚è¼¯æ˜¯ä»€éº¼
    - æœ‰å“ªäº›ç‰¹æ®Šæƒ…æ³éœ€è¦æ³¨æ„
    
    åƒæ•¸ï¼š
        param1: åƒæ•¸1çš„èªªæ˜
        param2: åƒæ•¸2çš„èªªæ˜
    
    è¿”å›ï¼š
        è¿”å›å€¼çš„èªªæ˜
    
    ç•°å¸¸ï¼š
        ValueError: ä»€éº¼æƒ…æ³ä¸‹æœƒæ‹‹å‡ºæ­¤ç•°å¸¸
        
    ç¯„ä¾‹ï¼š
        >>> function_name("example", 123)
        expected_output
    """
    # æ­¥é©Ÿ1ï¼šåˆå§‹åŒ–è®Šé‡
    result = None
    
    # æ­¥é©Ÿ2ï¼šä¸»è¦è™•ç†é‚è¼¯
    try:
        # å…·é«”æ“ä½œ
        result = process(param1, param2)
    except Exception as e:
        # éŒ¯èª¤è™•ç†
        logger.error(f"è™•ç†å¤±æ•—: {e}")
        raise
    
    # æ­¥é©Ÿ3ï¼šè¿”å›çµæœ
    return result
```

