2025-11-04 02:13:03 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 02:13:03 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 02:13:03 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 02:13:03 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 02:13:03 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 02:13:03 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 02:13:03 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 02:13:03 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:13:06 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:13:06 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:13:06 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:13:06 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:13:06 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:13:06 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 02:13:06 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:13:06 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:13:06 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:13:06 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 02:13:06 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:13:06 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:13:07 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 02:13:07 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 02:13:07 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 02:13:07 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 02:13:07 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 02:13:07 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 02:13:07 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 02:13:07 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 02:13:07 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:13:07 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 02:13:07 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 02:13:07 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 02:13:07 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 02:13:07 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 02:13:07 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 02:13:07 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 02:13:07 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 02:13:07 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:13:07 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 02:13:08 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 02:13:08 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 02:13:08 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 02:13:08 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 02:13:08 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 02:13:08 - s_cbr.backend.main - INFO - 
2025-11-04 02:13:08 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 02:13:08 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 02:13:08 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 02:13:08 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 02:13:08 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 02:13:08 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 02:13:08 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 02:13:08 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 02:13:08 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 02:13:09 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 02:13:09 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 02:13:09 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:13:13 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 02:13:13 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 02:13:14 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 02:13:14 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 02:13:14 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 02:13:14 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 02:13:14 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 02:13:14 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:13:16 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:13:17 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:13:17 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:13:17 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:13:17 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:13:17 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 02:13:17 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:13:17 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:13:17 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:13:17 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 02:13:17 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:13:17 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:13:18 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 02:13:18 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 02:13:18 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 02:13:18 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 02:13:18 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 02:13:18 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 02:13:18 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 02:13:18 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 02:13:18 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:13:18 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 02:13:18 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 02:13:18 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 02:13:18 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 02:13:18 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 02:13:18 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 02:13:18 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 02:13:18 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 02:13:18 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:13:18 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 02:13:18 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 02:13:18 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 02:13:18 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 02:13:18 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 02:13:18 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 02:13:18 - s_cbr.backend.main - INFO - 
2025-11-04 02:13:18 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 02:13:18 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 02:13:18 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 02:13:18 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 02:13:18 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 02:13:18 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 02:13:18 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 02:13:18 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 02:13:18 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 02:13:19 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 02:13:19 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 02:13:19 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:13:20 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 02:13:20 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 02:13:20 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 02:13:20 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 02:13:20 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 02:13:20 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 02:13:20 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 02:13:20 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:13:24 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:13:24 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:13:24 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:13:24 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:13:24 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:13:24 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 02:13:24 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:13:24 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:13:24 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:13:24 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 02:13:24 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:13:24 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:13:25 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 02:13:25 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 02:13:25 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 02:13:25 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 02:13:25 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 02:13:25 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 02:13:25 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 02:13:25 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 02:13:25 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:13:25 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 02:13:25 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 02:13:25 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 02:13:25 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 02:13:25 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 02:13:25 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 02:13:25 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 02:13:25 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 02:13:25 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:13:25 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 02:13:25 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 02:13:25 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 02:13:25 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 02:13:25 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 02:13:25 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 02:13:25 - s_cbr.backend.main - INFO - 
2025-11-04 02:13:25 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 02:13:25 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 02:13:25 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 02:13:25 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 02:13:25 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 02:13:25 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 02:13:25 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 02:13:25 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 02:13:26 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 02:13:27 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 02:13:27 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 02:13:27 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:39:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 02:39:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 02:39:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 02:39:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 02:39:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 02:39:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 02:39:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 02:39:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:39:44 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:39:44 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:39:45 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:39:45 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:39:45 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:39:45 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 02:39:45 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:39:45 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:39:45 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:39:45 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 02:39:45 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:39:45 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:39:46 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 02:39:46 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 02:39:46 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 02:39:46 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 02:39:46 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 02:39:46 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 02:39:46 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 02:39:46 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 02:39:46 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:39:46 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 02:39:46 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 02:39:46 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 02:39:46 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 02:39:46 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 02:39:46 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 02:39:46 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 02:39:46 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 02:39:46 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 02:39:46 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 02:39:46 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:39:46 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 02:39:46 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 02:39:46 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 02:39:46 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 02:39:46 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 02:39:46 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 02:39:46 - s_cbr.backend.main - INFO - 
2025-11-04 02:39:46 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 02:39:46 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 02:39:46 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 02:39:46 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 02:39:46 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 02:39:46 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 02:39:46 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 02:39:46 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 02:39:47 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 02:39:47 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 02:39:47 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 02:39:47 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:46:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 02:46:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 02:46:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 02:46:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 02:46:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 02:46:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 02:46:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 02:46:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:46:10 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:46:10 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:46:10 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:46:10 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:46:10 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:46:10 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 02:46:10 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:46:10 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:46:10 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:46:10 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 02:46:10 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:46:10 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:46:11 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 02:46:11 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 02:46:11 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 02:46:11 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 02:46:11 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 02:46:11 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 02:46:11 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 02:46:11 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 02:46:11 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:46:11 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 02:46:11 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 02:46:11 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 02:46:11 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 02:46:11 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 02:46:11 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 02:46:11 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 02:46:11 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 02:46:11 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 02:46:11 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 02:46:11 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:46:11 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 02:46:12 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 02:46:12 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 02:46:12 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 02:46:12 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 02:46:12 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 02:46:12 - s_cbr.backend.main - INFO - 
2025-11-04 02:46:12 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 02:46:12 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 02:46:12 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 02:46:12 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 02:46:12 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 02:46:12 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 02:46:12 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 02:46:12 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 02:46:12 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 02:46:13 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 02:46:13 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 02:46:13 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:47:39 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 02:47:39 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 02:47:39 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 02:47:39 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 02:47:39 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 02:47:39 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 02:47:39 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 02:47:39 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:47:42 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:47:42 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:47:42 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:47:42 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:47:42 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:47:42 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 02:47:42 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:47:42 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:47:42 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:47:43 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 02:47:43 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:47:43 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:47:43 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 02:47:43 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 02:47:43 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 02:47:43 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 02:47:43 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 02:47:43 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 02:47:43 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 02:47:43 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 02:47:43 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:47:43 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 02:47:44 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 02:47:44 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 02:47:44 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 02:47:44 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 02:47:44 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 02:47:44 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 02:47:44 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 02:47:44 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 02:47:44 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 02:47:44 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:47:44 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 02:47:44 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:47:44 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 02:56:10 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 02:56:10 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 02:56:10 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 02:56:10 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 02:56:10 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 02:56:10 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 02:56:10 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 02:56:10 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:56:14 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:56:14 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:56:14 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:56:14 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:56:14 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:56:14 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 02:56:14 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:56:14 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:56:14 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:56:14 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 02:56:14 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:56:14 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:56:15 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 02:56:15 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 02:56:15 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 02:56:15 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 02:56:15 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 02:56:15 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 02:56:15 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 02:56:15 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 02:56:15 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:56:15 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 02:56:15 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 02:56:15 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 02:56:15 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 02:56:15 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 02:56:15 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 02:56:15 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 02:56:15 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 02:56:15 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 02:56:15 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 02:56:15 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:56:15 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 02:56:15 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 02:56:15 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 02:56:15 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 02:56:15 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 02:56:15 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 02:56:15 - s_cbr.backend.main - INFO - 
2025-11-04 02:56:15 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 02:56:15 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 02:56:15 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 02:56:15 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 02:56:15 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 02:56:15 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 02:56:15 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 02:56:15 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 02:56:16 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 02:56:16 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 02:56:16 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 02:56:16 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:57:42 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 02:57:43 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 02:57:43 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 02:57:43 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 02:57:43 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 02:57:43 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 02:57:43 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 02:57:43 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:57:46 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:57:46 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 02:57:46 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:57:46 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:57:46 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:57:46 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 02:57:46 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:57:46 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:57:46 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:57:46 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 02:57:46 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:57:46 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 02:57:47 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 02:57:47 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 02:57:47 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 02:57:47 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 02:57:47 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 02:57:47 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 02:57:47 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 02:57:47 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 02:57:47 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 02:57:47 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 02:57:47 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 02:57:47 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 02:57:47 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 02:57:47 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 02:57:48 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 02:57:48 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 02:57:48 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 02:57:48 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 02:57:48 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 02:57:48 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 02:57:48 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 02:57:48 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 02:57:48 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 02:57:53 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:04:32 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:04:32 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:04:32 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:04:32 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:04:32 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:04:32 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:04:32 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:04:32 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:04:35 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:04:35 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:04:35 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:04:35 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:04:35 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:04:35 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:04:35 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:04:35 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:04:35 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:04:35 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:04:35 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:04:35 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:04:36 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:04:36 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:04:36 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:04:36 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:04:36 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:04:36 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:04:36 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:04:36 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:04:36 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:04:36 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:04:36 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:04:36 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:04:36 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:04:36 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:04:37 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:04:37 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:04:37 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:04:37 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:04:37 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:04:37 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:04:37 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:04:37 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:04:37 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:04:37 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:04:37 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:04:37 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:04:37 - s_cbr.backend.main - INFO - 
2025-11-04 03:04:37 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:04:37 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:04:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:04:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:04:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:04:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:04:37 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:04:37 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:04:37 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:04:38 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:04:38 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:04:38 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:04:44 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:04:44 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:04:44 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:04:44 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:04:44 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:04:44 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:04:44 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:04:44 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:04:47 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:04:47 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:04:47 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:04:47 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:04:47 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:04:47 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:04:47 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:04:47 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:04:47 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:04:47 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:04:47 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:04:47 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:04:48 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:04:48 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:04:48 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:04:48 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:04:48 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:04:48 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:04:48 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:04:48 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:04:48 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:04:48 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:04:48 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:04:48 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:04:48 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:04:48 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:04:49 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:04:49 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:04:49 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:04:49 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:04:49 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:04:49 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:04:49 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:04:49 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:04:49 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:04:49 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:04:49 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:04:49 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:04:49 - s_cbr.backend.main - INFO - 
2025-11-04 03:04:49 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:04:49 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:04:49 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:04:49 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:04:49 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:04:49 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:04:49 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:04:49 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:04:49 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:04:50 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:04:50 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:04:50 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:04:51 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:04:51 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:04:51 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:04:51 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:04:51 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:04:51 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:04:51 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:04:51 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:04:54 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:04:54 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:04:54 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:04:54 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:04:54 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:04:54 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:04:54 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:04:54 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:04:54 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:04:54 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:04:54 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:04:54 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:04:55 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:04:55 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:04:55 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:04:55 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:04:55 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:04:55 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:04:55 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:04:55 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:04:55 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:04:55 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:04:55 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:04:55 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:04:55 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:04:55 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:04:56 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:04:56 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:04:56 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:04:56 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:04:56 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:04:56 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:04:56 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:04:56 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:04:56 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:04:56 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:04:56 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:04:56 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:04:56 - s_cbr.backend.main - INFO - 
2025-11-04 03:04:56 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:04:56 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:04:56 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:04:56 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:04:56 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:04:56 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:04:56 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:04:56 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:04:56 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:04:57 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:04:57 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:04:57 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:03 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:05:03 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:05:03 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:05:03 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:05:03 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:05:03 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:05:03 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:05:03 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:05:06 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:05:06 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:05:06 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:06 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:06 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:06 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:05:06 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:05:06 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:05:06 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:06 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:05:06 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:05:06 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:07 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:05:07 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:05:07 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:05:07 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:05:07 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:05:07 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:05:07 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:05:07 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:05:07 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:05:07 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:05:07 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:05:07 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:05:07 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:05:07 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:05:07 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:05:07 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:07 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:05:07 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:05:07 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:05:07 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:07 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:05:07 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:05:07 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:05:07 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:05:07 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:05:07 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:05:07 - s_cbr.backend.main - INFO - 
2025-11-04 03:05:07 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:05:07 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:05:07 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:05:07 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:05:07 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:05:07 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:05:07 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:05:07 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:05:08 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:05:08 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:05:09 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:05:09 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:13 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:05:13 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:05:13 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:05:13 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:05:13 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:05:13 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:05:13 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:05:13 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:05:16 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:05:16 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:05:16 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:16 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:16 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:16 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:05:16 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:05:16 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:05:16 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:17 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:05:17 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:05:17 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:17 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:05:17 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:05:17 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:05:17 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:05:17 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:05:17 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:05:17 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:05:17 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:05:17 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:05:17 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:05:17 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:05:17 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:05:17 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:05:17 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:05:18 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:05:18 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:18 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:05:18 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:05:18 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:05:18 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:18 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:05:18 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:05:18 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:05:18 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:05:18 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:05:18 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:05:18 - s_cbr.backend.main - INFO - 
2025-11-04 03:05:18 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:05:18 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:05:18 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:05:18 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:05:18 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:05:18 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:05:18 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:05:18 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:05:18 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:05:19 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:05:19 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:05:19 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:21 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:05:21 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:05:21 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:05:21 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:05:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:05:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:05:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:05:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:05:24 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:05:24 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:05:24 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:24 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:24 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:24 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:05:24 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:05:24 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:05:24 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:24 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:05:24 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:05:24 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:25 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:05:25 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:05:25 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:05:25 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:05:25 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:05:25 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:05:25 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:05:25 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:05:25 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:05:25 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:05:25 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:05:25 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:05:25 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:05:25 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:05:26 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:05:26 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:26 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:05:26 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:05:26 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:05:26 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:26 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:05:26 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:05:26 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:05:26 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:05:26 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:05:26 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:05:26 - s_cbr.backend.main - INFO - 
2025-11-04 03:05:26 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:05:26 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:05:26 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:05:26 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:05:26 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:05:26 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:05:26 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:05:26 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:05:26 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:05:27 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:05:27 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:05:27 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:05:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:05:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:05:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:05:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:05:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:05:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:05:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:05:36 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:05:36 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:05:36 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:36 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:36 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:36 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:05:36 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:05:36 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:05:36 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:36 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:05:36 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:05:36 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:37 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:05:37 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:05:37 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:05:37 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:05:37 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:05:37 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:05:37 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:05:37 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:05:37 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:05:37 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:05:37 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:05:37 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:05:37 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:05:37 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:05:37 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:05:37 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:37 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:05:37 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:05:37 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:05:37 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:37 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:05:37 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:05:37 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:05:37 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:05:37 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:05:37 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:05:37 - s_cbr.backend.main - INFO - 
2025-11-04 03:05:37 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:05:37 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:05:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:05:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:05:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:05:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:05:37 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:05:37 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:05:38 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:05:38 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:05:39 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:05:39 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:40 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:05:40 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:05:40 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:05:40 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:05:40 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:05:40 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:05:40 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:05:40 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:05:43 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:05:43 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:05:43 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:43 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:43 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:43 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:05:43 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:05:43 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:05:43 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:43 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:05:43 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:05:43 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:05:44 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:05:44 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:05:44 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:05:44 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:05:44 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:05:44 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:05:44 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:05:44 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:05:44 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:05:44 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:05:44 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:05:44 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:05:44 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:05:44 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:05:44 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:05:44 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:44 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:05:44 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:05:44 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:05:44 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:05:44 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:05:44 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:05:44 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:05:44 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:05:44 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:05:44 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:05:44 - s_cbr.backend.main - INFO - 
2025-11-04 03:05:44 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:05:44 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:05:44 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:05:44 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:05:44 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:05:44 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:05:44 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:05:44 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:05:45 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:05:46 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:05:46 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:05:46 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:07:23 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:07:23 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:07:23 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:07:23 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:07:23 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:07:23 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:07:24 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:07:24 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:07:27 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:07:27 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:07:27 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:07:27 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:07:27 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:07:27 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:07:27 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:07:27 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:07:27 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:07:27 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:07:27 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:07:27 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:07:28 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:07:28 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:07:28 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:07:28 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:07:28 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:07:28 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:07:28 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:07:28 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:07:28 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:07:28 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:07:28 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:07:28 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:07:28 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:07:28 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:07:28 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:07:28 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:07:28 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:07:28 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:07:28 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:07:28 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:07:28 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:07:28 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:07:29 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:07:34 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:07:36 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['bm25_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:07:36 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 0 å€‹çµæœ
2025-11-04 03:07:41 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:07:44 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:07:45 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['bm25_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:07:45 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 0 å€‹çµæœ
2025-11-04 03:07:50 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:07:53 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:07:54 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['bm25_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:07:55 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 0 å€‹çµæœ
2025-11-04 03:07:59 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:08:02 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:08:04 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['bm25_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:08:04 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 0 å€‹çµæœ
2025-11-04 03:08:08 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:08:11 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:08:12 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['bm25_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:08:12 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 0 å€‹çµæœ
2025-11-04 03:08:16 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:08:20 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:08:20 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['bm25_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:08:21 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 0 å€‹çµæœ
2025-11-04 03:18:21 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:18:21 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:18:21 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:18:21 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:18:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:18:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:18:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:18:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:18:24 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:18:24 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:18:24 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:18:24 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:18:24 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:18:24 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:18:24 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:18:24 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:18:24 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:18:25 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:18:25 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:18:25 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:18:25 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:18:25 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:18:25 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:18:25 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:18:25 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:18:25 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:18:25 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:18:25 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:18:25 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:18:25 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:18:25 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:18:25 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:18:25 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:18:25 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:18:26 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:18:26 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:18:26 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:18:26 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:18:26 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:18:26 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:18:26 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:18:26 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:18:26 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:18:26 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:18:26 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:18:26 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:18:26 - s_cbr.backend.main - INFO - 
2025-11-04 03:18:26 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:18:26 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:18:26 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:18:26 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:18:26 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:18:26 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:18:26 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:18:26 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:18:26 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:18:27 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:18:27 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:18:27 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:18:28 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:18:29 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:18:29 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:18:29 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:18:29 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:18:29 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:18:29 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:18:29 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:18:31 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:18:32 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:18:32 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:18:32 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:18:32 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:18:32 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:18:32 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:18:32 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:18:32 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:18:32 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:18:32 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:18:32 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:18:33 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:18:33 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:18:33 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:18:33 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:18:33 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:18:33 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:18:33 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:18:33 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:18:33 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:18:33 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:18:33 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:18:33 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:18:33 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:18:33 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:18:33 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:18:33 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:18:33 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:18:33 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:18:33 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:18:33 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:18:33 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:18:33 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:18:33 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:18:33 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:18:33 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:18:33 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:18:33 - s_cbr.backend.main - INFO - 
2025-11-04 03:18:33 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:18:33 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:18:33 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:18:33 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:18:33 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:18:33 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:18:33 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:18:33 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:18:34 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:18:34 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:18:34 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:18:34 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:18:59 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:18:59 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:18:59 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:18:59 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:18:59 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:18:59 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:18:59 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:18:59 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:19:02 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:19:02 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:19:02 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:19:02 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:19:02 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:19:02 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:19:02 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:19:02 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:19:02 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:19:02 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:19:02 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:19:02 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:19:03 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:19:03 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:19:03 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:19:03 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:19:03 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:19:03 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:19:03 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:19:03 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:19:03 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:19:03 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:19:03 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:19:03 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:19:03 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:19:03 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:19:04 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:19:04 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:19:04 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:19:04 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:19:04 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:19:04 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:19:04 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:19:04 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:19:04 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:19:04 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:19:04 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:19:04 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:19:04 - s_cbr.backend.main - INFO - 
2025-11-04 03:19:04 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:19:04 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:19:04 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:19:04 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:19:04 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:19:04 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:19:04 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:19:04 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:19:04 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:19:05 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:19:05 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:19:05 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:19:07 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:19:07 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:19:07 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:19:07 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:19:07 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:19:07 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:19:07 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:19:07 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:19:10 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:19:10 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:19:10 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:19:10 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:19:10 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:19:10 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:19:10 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:19:10 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:19:10 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:19:10 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:19:10 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:19:10 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:19:11 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:19:11 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:19:11 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:19:11 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:19:11 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:19:11 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:19:11 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:19:11 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:19:11 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:19:11 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:19:11 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:19:11 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:19:11 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:19:11 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:19:11 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:19:11 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:19:11 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:19:11 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:19:11 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:19:11 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:19:11 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:19:11 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:19:11 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:19:11 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:19:11 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:19:11 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:19:11 - s_cbr.backend.main - INFO - 
2025-11-04 03:19:11 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:19:11 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:19:11 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:19:11 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:19:11 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:19:11 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:19:11 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:19:11 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:19:12 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:19:12 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:19:12 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:19:13 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:21:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:21:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:21:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:21:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:21:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:21:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:21:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:21:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:21:45 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:21:45 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:21:45 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:21:45 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:21:45 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:21:45 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:21:45 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:21:45 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:21:45 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:21:45 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:21:45 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:21:45 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:21:46 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:21:46 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:21:46 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:21:46 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:21:46 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:21:46 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:21:46 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:21:46 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:21:46 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:21:46 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:21:46 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:21:46 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:21:46 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:21:46 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:21:46 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:21:46 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:21:46 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:21:46 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:21:46 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:21:46 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:21:46 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:21:46 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:21:46 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:21:50 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:21:50 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ç­‰ç—‡ç‹€ï¼ŒåŒæ™‚æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è¾¨è­‰å’Œé«”è³ªåˆ†æã€‚"
}
2025-11-04 03:21:50 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ç­‰ç—‡ç‹€ï¼ŒåŒæ™‚æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è¾¨è­‰å’Œé«”è³ªåˆ†æã€‚"
}
2025-11-04 03:21:52 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:21:52 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 03:22:21 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 2 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:22:21 - s_cbr.LLMClient - ERROR - âŒ è§£æ LLM JSON ç‰‡æ®µå¤±æ•—: Expecting property name enclosed in double quotes: line 5 column 27 (char 94)
2025-11-04 03:31:10 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:31:10 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:31:11 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:31:11 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:31:11 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:31:11 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:31:11 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:31:11 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:31:14 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:31:14 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:31:14 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:31:14 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:31:14 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:31:14 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:31:14 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:31:14 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:31:14 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:31:14 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:31:14 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:31:14 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:31:15 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:31:15 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:31:15 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:31:15 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:31:15 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:31:15 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:31:15 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:31:15 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:31:15 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:31:15 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:31:15 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:31:15 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:31:15 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:31:15 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:31:15 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:31:15 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:31:15 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:31:15 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:31:15 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:31:15 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:31:15 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:31:15 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:31:15 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:31:15 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:31:15 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:31:15 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:31:15 - s_cbr.backend.main - INFO - 
2025-11-04 03:31:15 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:31:15 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:31:15 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:31:15 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:31:15 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:31:15 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:31:15 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:31:15 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:31:16 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:31:16 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:31:16 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:31:16 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:34:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:34:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:34:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:34:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:34:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:34:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:34:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:34:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:34:09 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:34:10 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:34:10 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:34:10 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:34:10 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:34:10 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:34:10 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:34:10 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:34:10 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:34:10 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:34:10 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:34:10 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:34:11 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:34:11 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:34:11 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:34:11 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:34:11 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:34:11 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:34:11 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:34:11 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:34:11 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:34:11 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:34:11 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:34:11 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:34:11 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:34:11 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:34:11 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:34:11 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:34:11 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:34:11 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:34:11 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:34:11 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:34:11 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:34:11 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:34:11 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:34:15 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:34:15 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†è‡ªå·±çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è¾¨è­‰å’Œé«”è³ªåˆ†æã€‚"
}
2025-11-04 03:34:15 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†è‡ªå·±çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è¾¨è­‰å’Œé«”è³ªåˆ†æã€‚"
}
2025-11-04 03:34:16 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:34:16 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 03:34:41 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 2 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:34:41 - s_cbr.LLMClient - ERROR - âŒ è§£æ LLM JSON ç‰‡æ®µå¤±æ•—: Expecting property name enclosed in double quotes: line 6 column 7 (char 101)
2025-11-04 03:39:08 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:39:08 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:39:08 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:39:08 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:39:08 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:39:08 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:39:08 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:39:08 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:39:11 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:39:11 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:39:11 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:39:11 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:39:11 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:39:11 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:39:11 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:39:11 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:39:11 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:39:12 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:39:12 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:39:12 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:39:13 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:39:13 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:39:13 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:39:13 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:39:13 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:39:13 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:39:13 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:39:13 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:39:13 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:39:13 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:39:13 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:39:13 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:39:13 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:39:13 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:39:13 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:39:13 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:39:13 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:39:13 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:39:13 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:39:13 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:39:13 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:39:13 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:39:13 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:39:13 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:39:13 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:39:13 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:39:13 - s_cbr.backend.main - INFO - 
2025-11-04 03:39:13 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:39:13 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:39:13 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:39:13 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:39:13 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:39:13 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:39:13 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:39:13 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:39:14 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:39:14 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:39:14 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:39:14 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:40:24 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:40:24 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:40:24 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:40:24 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:40:24 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:40:24 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:40:24 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:40:24 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:40:28 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:40:28 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:40:28 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:40:28 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:40:28 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:40:28 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:40:28 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:40:28 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:40:28 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:40:28 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:40:28 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:40:28 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:40:29 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:40:29 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:40:29 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:40:29 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:40:29 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:40:29 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:40:29 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:40:29 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:40:29 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:40:29 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:40:29 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:40:29 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:40:29 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:40:29 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:40:29 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:40:29 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:40:29 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:40:29 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:40:29 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:40:29 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:40:29 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:40:29 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:40:29 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:40:34 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:40:34 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸ä¸‹ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸ä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†å»ºè­°ã€‚"
}
2025-11-04 03:40:34 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸ä¸‹ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸ä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†å»ºè­°ã€‚"
}
2025-11-04 03:40:36 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:40:36 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 03:41:02 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 2 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:41:02 - s_cbr.LLMClient - ERROR - âŒ LLM JSON è§£æå¤±æ•—ï¼ˆä¿®å¾©å‰ç‰‡æ®µï¼‰ï¼š
{
  "layer": "L3_SAFETY_REVIEW",
  "status": "passed",
  "input": {
    "diagnosis_payload": {...} // åŸå§‹è¼¸å…¥å…§å®¹
  },
  "violations": [],
  "safe_diagnosis_payload": {
    "tcm_inference": {
      "syndrome_analysis": "æ ¹æ“šä½¿ç”¨è€…çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œåƒè€ƒéŒ¨å®šæ¡ˆä¾‹çš„è¨ºæ–·å’Œæ²»å‰‡ï¼Œåˆæ­¥åˆ¤æ–·ç‚ºå¿ƒè„¾å…©è™›æˆ–å¿ƒè…ä¸äº¤è­‰ã€‚",
      "primary_pattern": "å¿ƒè„¾å…©è™›",
      "possible_diseases": ["å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰"],
      "pathogenesis": "æ€æ…®éåº¦ã€å‹ç´¯éåº¦å°è‡´å¿ƒè„¾å…©è™›ï¼Œå¾è€Œå¼•èµ·å¤±çœ ã€å¿ƒæ‚¸ç­‰ç—‡ç‹€ã€‚",
      "treatment_principle": "è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥",
      "followup_questions": ["æ‚¨æœ€è¿‘æ˜¯å¦æœ‰éåº¦æ€æ…®æˆ–å‹ç´¯ï¼Ÿ", "æ‚¨æ˜¯å¦æœ‰å…¶ä»–ä¼´éš¨ç—‡ç‹€ï¼Œå¦‚é ­æšˆã€å£ä¹¾ç­‰ï¼Ÿ"]
    },
    "selected_case": {
      "case_id": "CASE_20251005212239_M890_ebf84a5e",
      "match_score": 0.9741,
      "match_reason": "ä½¿ç”¨è€…çš„ä¸»è¨´å¿ƒæ‚¸å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±èˆ‡æ¡ˆä¾‹çš„ç—‡ç‹€å’ŒèˆŒè„ˆç›¸ç¬¦ï¼Œä¸”æ¡ˆä¾‹çš„è¨ºæ–·å’Œæ²»å‰‡èˆ‡ä½¿ç”¨è€…çš„ç—‡ç‹€ç›¸å»åˆã€‚"
    },
    "coverage_evaluation": {
      "user_symptoms_covered": ["å¿ƒæ‚¸", "å¤±çœ ", "èˆŒæ·¡", "è„ˆç´°å¼±"],
      "user_symptoms_missing_in_case": ["åƒä¸å¤ªä¸‹"],
      "case_symptoms_not_mentioned_by_user": ["ç›œæ±—"],
      "coverage_ratio": 0.8
    }
  }
}
2025-11-04 03:41:02 - s_cbr.LLMClient - ERROR - âŒ LLM JSON è§£æå¤±æ•—ï¼ˆä¿®å¾©å¾Œç‰‡æ®µï¼‰ï¼š
{
  "layer": "L3_SAFETY_REVIEW",
  "status": "passed",
  "input": {
    "diagnosis_payload": {...} // åŸå§‹è¼¸å…¥å…§å®¹
  },
  "violations": [],
  "safe_diagnosis_payload": {
    "tcm_inference": {
      "syndrome_analysis": "æ ¹æ“šä½¿ç”¨è€…çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œåƒè€ƒéŒ¨å®šæ¡ˆä¾‹çš„è¨ºæ–·å’Œæ²»å‰‡ï¼Œåˆæ­¥åˆ¤æ–·ç‚ºå¿ƒè„¾å…©è™›æˆ–å¿ƒè…ä¸äº¤è­‰ã€‚",
      "primary_pattern": "å¿ƒè„¾å…©è™›",
      "possible_diseases": ["å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰"],
      "pathogenesis": "æ€æ…®éåº¦ã€å‹ç´¯éåº¦å°è‡´å¿ƒè„¾å…©è™›ï¼Œå¾è€Œå¼•èµ·å¤±çœ ã€å¿ƒæ‚¸ç­‰ç—‡ç‹€ã€‚",
      "treatment_principle": "è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥",
      "followup_questions": ["æ‚¨æœ€è¿‘æ˜¯å¦æœ‰éåº¦æ€æ…®æˆ–å‹ç´¯ï¼Ÿ", "æ‚¨æ˜¯å¦æœ‰å…¶ä»–ä¼´éš¨ç—‡ç‹€ï¼Œå¦‚é ­æšˆã€å£ä¹¾ç­‰ï¼Ÿ"]
    },
    "selected_case": {
      "case_id": "CASE_20251005212239_M890_ebf84a5e",
      "match_score": 0.9741,
      "match_reason": "ä½¿ç”¨è€…çš„ä¸»è¨´å¿ƒæ‚¸å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±èˆ‡æ¡ˆä¾‹çš„ç—‡ç‹€å’ŒèˆŒè„ˆç›¸ç¬¦ï¼Œä¸”æ¡ˆä¾‹çš„è¨ºæ–·å’Œæ²»å‰‡èˆ‡ä½¿ç”¨è€…çš„ç—‡ç‹€ç›¸å»åˆã€‚"
    },
    "coverage_evaluation": {
      "user_symptoms_covered": ["å¿ƒæ‚¸", "å¤±çœ ", "èˆŒæ·¡", "è„ˆç´°å¼±"],
      "user_symptoms_missing_in_case": ["åƒä¸å¤ªä¸‹"],
      "case_symptoms_not_mentioned_by_user": ["ç›œæ±—"],
      "coverage_ratio": 0.8
    }
  }
}
2025-11-04 03:43:08 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:43:08 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:43:08 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:43:08 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:43:08 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:43:08 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:43:08 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:43:08 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:43:11 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:43:11 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:43:11 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:43:11 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:43:11 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:43:11 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:43:11 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:43:11 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:43:11 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:43:11 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:43:11 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:43:11 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:43:12 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:43:12 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:43:12 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:43:12 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:43:12 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:43:12 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:43:12 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:43:12 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:43:12 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:43:12 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:43:12 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:43:12 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:43:12 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:43:12 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:43:12 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:43:12 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:43:12 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:43:12 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:43:12 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:43:12 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:43:12 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:43:12 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:43:12 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:43:12 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:43:12 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:43:12 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:43:12 - s_cbr.backend.main - INFO - 
2025-11-04 03:43:12 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:43:12 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:43:12 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:43:12 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:43:12 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:43:12 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:43:12 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:43:12 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:43:13 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:43:13 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:43:13 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:43:13 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:43:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:43:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:43:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:43:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:43:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:43:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:43:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:43:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:43:37 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:43:37 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:43:37 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:43:37 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:43:37 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:43:37 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:43:37 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:43:37 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:43:37 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:43:37 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:43:37 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:43:37 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:43:38 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:43:38 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:43:38 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:43:38 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:43:38 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:43:38 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:43:38 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:43:38 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:43:38 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:43:38 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:43:38 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:43:38 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:43:38 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:43:38 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:43:38 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:43:38 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:43:38 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:43:38 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:43:38 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:43:38 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:43:38 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:43:38 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:43:38 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:43:42 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:43:42 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ç­‰ç—‡ç‹€ï¼ŒåŒæ™‚æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æå’Œè¾¨è­‰è«–æ²»ã€‚"
}
2025-11-04 03:43:42 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ç­‰ç—‡ç‹€ï¼ŒåŒæ™‚æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æå’Œè¾¨è­‰è«–æ²»ã€‚"
}
2025-11-04 03:43:44 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:43:44 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 03:44:09 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 2 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:44:09 - s_cbr.LLMClient - ERROR - âŒ LLM JSON è§£æå¤±æ•—ï¼ˆä¿®å¾©å‰ç‰‡æ®µï¼‰ï¼š
{
  "layer": "L3_SAFETY_REVIEW",
  "status": "passed",
  "input": {
    "diagnosis_payload": {
      ...  // åŸå§‹è¼¸å…¥å…§å®¹
    }
  },
  "violations": [],
  "safe_diagnosis_payload": {
    "tcm_inference": {
      "syndrome_analysis": "æ ¹æ“šæ‚¨çš„å¤±çœ ã€å¿ƒæ‚¸ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œåƒè€ƒéŒ¨å®šæ¡ˆä¾‹CASE_20251005212239_M890_ebf84a5eï¼Œå¯èƒ½æ˜¯å¿ƒè…ä¸äº¤è­‰å‹",
      "primary_pattern": "å¿ƒè…ä¸äº¤",
      "possible_diseases": ["å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰"],
      "pathogenesis": "æ€æ…®éåº¦å°è‡´å¿ƒè¡€è€—æï¼Œå¿ƒè…ä¸äº¤ï¼Œå‡ºç¾å¤±çœ ã€å¿ƒæ‚¸ç­‰ç—‡ç‹€",
      "treatment_principle": "æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…",
      "followup_questions": ["æ‚¨çš„å¤±çœ æ˜¯é›£ä»¥å…¥ç¡ã€å®¹æ˜“é†’ä¾†ï¼Œé‚„æ˜¯æ—©é†’å¾Œç„¡æ³•å†ç¡ï¼Ÿ", "æ‚¨çš„èˆŒæ·¡æ˜¯æŒ‡èˆŒé ­é¡è‰²æ·¡ï¼Œé‚„æ˜¯èˆŒè‹”æ·¡ï¼Ÿ"]
    },
    "selected_case": {
      "case_id": "CASE_20251005212239_M890_ebf84a5e",
      "match_score": 0.9831,
      "match_reason": "ä¸»è¨´å¤±çœ ã€å¿ƒæ‚¸èˆ‡æ¡ˆä¾‹ç›¸ç¬¦ï¼ŒèˆŒæ·¡ã€è„ˆç´°å¼±ä¹Ÿèˆ‡æ¡ˆä¾‹çš„èˆŒè‹”å’Œè„ˆè±¡ç›¸ç¬¦"
    },
    "coverage_evaluation": {
      "user_symptoms_covered": ["å¤±çœ ", "å¿ƒæ‚¸", "èˆŒæ·¡", "è„ˆç´°å¼±"],
      "user_symptoms_missing_in_case": ["åƒä¸å¤ªä¸‹"],
      "case_symptoms_not_mentioned_by_user": ["ç›œæ±—"],
      "coverage_ratio": 0.8
    }
  }
}
2025-11-04 03:44:09 - s_cbr.LLMClient - ERROR - âŒ LLM JSON è§£æå¤±æ•—ï¼ˆä¿®å¾©å¾Œç‰‡æ®µï¼‰ï¼š
{
  "layer": "L3_SAFETY_REVIEW",
  "status": "passed",
  "input": {
    "diagnosis_payload": {
      ...  
    }
  },
  "violations": [],
  "safe_diagnosis_payload": {
    "tcm_inference": {
      "syndrome_analysis": "æ ¹æ“šæ‚¨çš„å¤±çœ ã€å¿ƒæ‚¸ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œåƒè€ƒéŒ¨å®šæ¡ˆä¾‹CASE_20251005212239_M890_ebf84a5eï¼Œå¯èƒ½æ˜¯å¿ƒè…ä¸äº¤è­‰å‹",
      "primary_pattern": "å¿ƒè…ä¸äº¤",
      "possible_diseases": ["å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰"],
      "pathogenesis": "æ€æ…®éåº¦å°è‡´å¿ƒè¡€è€—æï¼Œå¿ƒè…ä¸äº¤ï¼Œå‡ºç¾å¤±çœ ã€å¿ƒæ‚¸ç­‰ç—‡ç‹€",
      "treatment_principle": "æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…",
      "followup_questions": ["æ‚¨çš„å¤±çœ æ˜¯é›£ä»¥å…¥ç¡ã€å®¹æ˜“é†’ä¾†ï¼Œé‚„æ˜¯æ—©é†’å¾Œç„¡æ³•å†ç¡ï¼Ÿ", "æ‚¨çš„èˆŒæ·¡æ˜¯æŒ‡èˆŒé ­é¡è‰²æ·¡ï¼Œé‚„æ˜¯èˆŒè‹”æ·¡ï¼Ÿ"]
    },
    "selected_case": {
      "case_id": "CASE_20251005212239_M890_ebf84a5e",
      "match_score": 0.9831,
      "match_reason": "ä¸»è¨´å¤±çœ ã€å¿ƒæ‚¸èˆ‡æ¡ˆä¾‹ç›¸ç¬¦ï¼ŒèˆŒæ·¡ã€è„ˆç´°å¼±ä¹Ÿèˆ‡æ¡ˆä¾‹çš„èˆŒè‹”å’Œè„ˆè±¡ç›¸ç¬¦"
    },
    "coverage_evaluation": {
      "user_symptoms_covered": ["å¤±çœ ", "å¿ƒæ‚¸", "èˆŒæ·¡", "è„ˆç´°å¼±"],
      "user_symptoms_missing_in_case": ["åƒä¸å¤ªä¸‹"],
      "case_symptoms_not_mentioned_by_user": ["ç›œæ±—"],
      "coverage_ratio": 0.8
    }
  }
}
2025-11-04 03:48:04 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:48:04 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:48:05 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:48:05 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:48:05 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:48:05 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:48:05 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:48:05 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:48:08 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:48:08 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:48:08 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:48:08 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:48:08 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:48:08 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:48:08 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:48:08 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:48:08 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:48:08 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:48:08 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:48:08 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:48:09 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:48:09 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:48:09 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:48:09 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:48:09 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:48:09 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:48:09 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:48:09 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:48:09 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:48:09 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:48:09 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:48:09 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:48:09 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:48:09 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:48:09 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:48:09 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:48:09 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:48:09 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:48:09 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:48:09 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:48:09 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:48:09 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:48:10 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:48:14 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:48:14 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œéœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è¾¨è­‰å’Œé«”è³ªåˆ†æã€‚"
}
2025-11-04 03:48:14 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œéœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è¾¨è­‰å’Œé«”è³ªåˆ†æã€‚"
}
2025-11-04 03:48:15 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:48:15 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 03:48:40 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 2 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:48:47 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:48:50 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:48:50 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤±çœ å’Œç›œæ±—çš„ç—‡ç‹€ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¤±çœ ", "ç›œæ±—"],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
```
2025-11-04 03:48:50 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤±çœ å’Œç›œæ±—çš„ç—‡ç‹€ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¤±çœ ", "ç›œæ±—"],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
```
2025-11-04 03:48:52 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:48:52 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 03:49:13 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 2 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:49:20 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:49:23 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:49:23 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å°ä¾¿æ¸…é•·", "æ€•å†·", "ç™½å¸¶é‡å¤š"],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
```
2025-11-04 03:49:23 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å°ä¾¿æ¸…é•·", "æ€•å†·", "ç™½å¸¶é‡å¤š"],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
```
2025-11-04 03:49:25 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:49:25 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 03:49:37 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:49:41 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:49:41 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 03:49:41 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 03:49:42 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:49:42 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 03:49:58 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:50:01 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:50:01 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "expand"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 03:50:01 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "expand"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 03:50:02 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:50:02 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 03:50:13 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:50:16 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:50:16 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "syndrome_analysis",
    "reason": "ä½¿ç”¨è€…æä¾›äº†èˆŒè„ˆè³‡è¨Šï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œ"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [],
    "tongue_pulse_terms": ["èˆŒç´…", "è‹”é»ƒè†©", "è„ˆå¼¦æ»‘"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„èˆŒè„ˆè³‡è¨Šï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æ"
}
```
2025-11-04 03:50:16 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "syndrome_analysis",
    "reason": "ä½¿ç”¨è€…æä¾›äº†èˆŒè„ˆè³‡è¨Šï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œ"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [],
    "tongue_pulse_terms": ["èˆŒç´…", "è‹”é»ƒè†©", "è„ˆå¼¦æ»‘"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„èˆŒè„ˆè³‡è¨Šï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æ"
}
```
2025-11-04 03:50:17 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:50:17 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 03:56:01 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:56:01 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:56:01 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:56:01 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:56:01 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:56:01 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:56:01 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:56:01 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:56:04 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:56:04 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:56:04 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:56:04 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:56:04 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:56:04 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:56:04 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:56:04 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:56:04 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:56:05 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:56:05 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:56:05 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:56:05 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:56:05 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:56:05 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:56:05 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:56:05 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:56:05 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:56:05 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:56:05 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:56:05 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:56:05 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:56:06 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:56:06 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:56:06 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:56:06 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:56:06 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:56:06 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:56:06 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:56:06 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:56:06 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:56:06 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:56:06 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:56:06 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:56:06 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:56:06 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:56:06 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:56:06 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:56:06 - s_cbr.backend.main - INFO - 
2025-11-04 03:56:06 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:56:06 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:56:06 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:56:06 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:56:06 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:56:06 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:56:06 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:56:06 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:56:06 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:56:07 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:56:07 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:56:07 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:56:09 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:56:09 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:56:09 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:56:09 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:56:09 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:56:09 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:56:09 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:56:09 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:56:12 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:56:12 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:56:12 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:56:12 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:56:12 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:56:12 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:56:12 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:56:12 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:56:12 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:56:12 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:56:12 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:56:12 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:56:13 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:56:13 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:56:13 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:56:13 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:56:13 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:56:13 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:56:13 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:56:13 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:56:13 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:56:13 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:56:13 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:56:13 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:56:13 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:56:13 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:56:13 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:56:13 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:56:13 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:56:13 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:56:13 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:56:13 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:56:13 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:56:13 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:56:13 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:56:13 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:56:13 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:56:13 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:56:13 - s_cbr.backend.main - INFO - 
2025-11-04 03:56:13 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:56:13 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:56:13 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:56:13 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:56:13 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:56:13 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:56:13 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:56:13 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:56:14 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:56:14 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:56:15 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:56:15 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:57:14 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:57:15 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:57:15 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:57:15 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:57:15 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:57:15 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:57:15 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:57:15 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:57:18 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:57:18 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:57:18 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:57:18 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:57:18 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:57:18 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:57:18 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:57:18 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:57:18 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:57:18 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:57:18 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:57:18 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:57:19 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:57:19 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:57:19 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:57:19 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:57:19 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:57:19 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:57:19 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:57:19 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:57:19 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:57:19 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:57:19 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:57:19 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:57:19 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:57:19 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:57:19 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:57:19 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:57:19 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:57:19 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:57:19 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:57:19 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:57:19 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:57:19 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:57:20 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:57:23 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 03:57:23 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†å»ºè­°ã€‚"
}
2025-11-04 03:57:23 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†å»ºè­°ã€‚"
}
2025-11-04 03:57:25 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 03:57:25 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 03:58:02 - s_cbr.LLMClient - ERROR - âŒ LLM JSON è§£æå¤±æ•—ï¼ˆä¿®å¾©å‰ç‰‡æ®µï¼‰ï¼š
{
  "layer": "L3_SAFETY_REVIEW",
  "status": "rewritten",
  "input": {
    "diagnosis_payload": {
      "layer": "L2_CASE_ANCHORED_DIAGNOSIS",
      "status": "ok",
      "input": {
        "user_accumulated_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
        "retrieved_cases": [
          {
            "case_id": "CASE_20251005212239_M890_ebf84a5e",
            "score": 0.9831,
            "chief_complaint": "ç„¦æ…®å¤±çœ ä¸€æœˆ",
            "symptom_terms": [
              "å¤±çœ ",
              "ç›œæ±—"
            ],
            "syndrome_terms": [
              "è­‰å‹"
            ],
            "diagnosis": "å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰",
            "treatment_principle": "æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…",
            "tongue_terms": [
              "å¾®ç´…",
              "èˆŒé«”",
              "èˆŒè‹”",
              "è–„é»ƒ"
            ],
            "pulse_terms": [
              "ç·Šå¼µ",
              "è„ˆè±¡",
              "ç´°æ•¸",
              "ç´°å¼±",
              "é™°è™›"
            ],
            "zangfu_terms": [
              "å¿ƒæ‚¸",
              "å¿ƒ",
              "è‚è†½",
              "è…",
              "è‚º",
              "è„¾èƒƒ",
              "å¿ƒè…"
            ],
            "treatment_terms": [
              "äº¤é€š"
            ],
            "full_text": "..."
          },
          {
            "case_id": "CASE_20251005212254_D567_d31d0467",
            "score": 0.9464,
            "chief_complaint": "å¤±çœ å¤šå¤¢åŠå¹´",
            "symptom_terms": [
              "å¤±çœ "
            ],
            "syndrome_terms": [
              "è­‰å‹"
            ],
            "diagnosis": "å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰",
            "treatment_principle": "è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥",
            "tongue_terms": [
              "èˆŒé«”",
              "æ·¡ç´…",
              "èˆŒè‹”",
              "è–„ç™½"
            ],
            "pulse_terms": [
              "è„ˆè±¡",
              "ç´°å¼±",
              "æ²‰å¼±",
              "å…©è™›",
              "è™›æ"
            ],
            "zangfu_terms": [
              "å¿ƒæ‚¸",
              "å¿ƒ",
              "è‚è†½",
              "è…",
              "è‚º",
              "è„¾èƒƒ",
              "å¿ƒè„¾"
            ],
            "treatment_terms": [
              "è£œç›Š"
            ],
            "full_text": "..."
          },
          {
            "case_id": "CASE_20251005212248_U678_17f9e6cd",
            "score": 0.8662,
            "chief_complaint": "å¤±çœ ç„¦æ…®å…©æœˆ",
            "symptom_terms": [
              "å¤±çœ "
            ],
            "syndrome_terms": [
              "è­‰å‹"
            ],
            "diagnosis": "å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰",
            "treatment_principle": "è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥",
            "tongue_terms": [
              "ç™½å¤©",
              "èˆŒé«”",
              "æ·¡ç´…",
              "èˆŒè‹”",
              "è–„ç™½"
            ],
            "pulse_terms": [
              "è„ˆè±¡",
              "ç´°å¼±",
              "æ²‰å¼±",
              "å…©è™›",
              "è™›æ"
            ],
            "zangfu_terms": [
              "å¿ƒç…©",
              "å¿ƒæ‚¸",
              "å¿ƒ",
              "è‚è†½",
              "è…",
              "è‚º",
              "è„¾èƒƒ",
              "å¿ƒè„¾"
            ],
            "treatment_terms": [
              "è£œç›Š"
            ],
            "full_text": "..."
          }
        ],
        "selected_case": {
          "case_id": "CASE_20251005212239_M890_ebf84a5e",
          "match_score": 0.9831,
          "match_reason": "ä½¿ç”¨è€…çš„ä¸»è¨´å¿ƒæ‚¸å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±èˆ‡æ¡ˆä¾‹çš„ç—‡ç‹€ç›¸ç¬¦ï¼Œä¸”æ¡ˆä¾‹çš„è¨ºæ–·ç‚ºå¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰ï¼Œèˆ‡ä½¿ç”¨è€…çš„ç—‡ç‹€å»åˆã€‚"
        },
        "coverage_evaluation": {
          "user_symptoms_covered": [
            "å¿ƒæ‚¸",
            "å¤±çœ ",
            "èˆŒæ·¡",
            "è„ˆç´°å¼±"
          ],
          "user_symptoms_missing_in_case": [
            "åƒä¸å¤ªä¸‹"
          ],
          "case_symptoms_not_mentioned_by_user": [
            "ç›œæ±—",
            "é ­æšˆ"
          ],
          "coverage_ratio": 0.8
        },
        "tcm_inference": {
          "syndrome_analysis": "æ ¹æ“šä½¿ç”¨è€…çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œåƒè€ƒéŒ¨å®šæ¡ˆä¾‹çš„ç—‡ç‹€å’Œè¨ºæ–·ï¼Œåˆæ­¥åˆ¤æ–·ç‚ºå¿ƒè…ä¸äº¤è­‰ã€‚å¿ƒè…ä¸äº¤æ˜¯æŒ‡å¿ƒè‡Ÿå’Œè…è‡Ÿä¹‹é–“çš„åŠŸèƒ½å¤±èª¿ï¼Œå°è‡´å¿ƒæ‚¸ã€å¤±çœ ç­‰ç—‡ç‹€ã€‚ä½¿ç”¨è€…çš„èˆŒæ·¡ã€è„ˆç´°å¼±ä¹Ÿæ”¯æŒé€™å€‹è¨ºæ–·ã€‚",
          "primary_pattern": "å¿ƒè…ä¸äº¤",
          "possible_diseases": [
            "å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰"
          ],
          "pathogenesis": "å¿ƒè…ä¸äº¤è­‰çš„ç—…æ©Ÿæ˜¯å¿ƒè‡Ÿå’Œè…è‡Ÿä¹‹é–“çš„åŠŸèƒ½å¤±èª¿ï¼Œå°è‡´å¿ƒæ‚¸ã€å¤±çœ ç­‰ç—‡ç‹€ã€‚é€™å¯èƒ½æ˜¯ç”±æ–¼é•·æœŸçš„ç²¾ç¥ç·Šå¼µã€ç¼ºä¹ä¼‘æ¯ç­‰å› ç´ å°è‡´çš„ã€‚",
          "treatment_principle": "æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…",
          "followup_questions": [
            "æ‚¨æœ€è¿‘æ˜¯å¦æœ‰ç²¾ç¥ç·Šå¼µæˆ–å£“åŠ›ï¼Ÿ",
            "æ‚¨æ˜¯å¦æœ‰è¦å¾‹çš„ä½œæ¯æ™‚é–“ï¼Ÿ",
            "æ‚¨æ˜¯å¦æœ‰å…¶ä»–çš„ç—‡ç‹€ï¼Œå¦‚é ­æšˆã€å£ä¹¾ç­‰ï¼Ÿ"
          ]
        },
        "owasp_considerations": {
          "misinformation_risk": "low",
          "vector_weakness_note": "æ¡ˆä¾‹åŒ¹é…åº¦è¼ƒé«˜ï¼Œä½¿ç”¨è€…çš„ç—‡ç‹€èˆ‡æ¡ˆä¾‹çš„ç—‡ç‹€ç›¸ç¬¦ï¼Œåˆæ­¥åˆ¤æ–·ç‚ºå¿ƒè…ä¸äº¤è­‰ã€‚"
        }
      }
    }
  },
  "violations": [
    {
      "owasp_code": "LLM05",
      "description": "è¼¸å‡ºåŒ…å«å…·é«”æ²»å‰‡å»ºè­°",
      "fix_applied": true
    }
  ],
  "safe_diagnosis_payload": {
    "tcm_inference": {
      "syndrome_analysis": "æ ¹æ“šä½¿ç”¨è€…çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œåƒè€ƒéŒ¨å®šæ¡ˆä¾‹çš„ç—‡ç‹€å’Œè¨ºæ–·ï¼Œåˆæ­¥åˆ¤æ–·ç‚ºå¿ƒè…ä¸äº¤è­‰ã€‚å¿ƒè…ä¸äº¤æ˜¯æŒ‡å¿ƒè‡Ÿå’Œè…è‡Ÿä¹‹é–“çš„åŠŸèƒ½å¤±èª¿ï¼Œå°è‡´å¿ƒæ‚¸ã€å¤±çœ ç­‰ç—‡ç‹€ã€‚ä½¿ç”¨è€…çš„èˆŒæ·¡ã€è„ˆç´°å¼±ä¹Ÿæ”¯æŒé€™å€‹è¨ºæ–·ã€‚",
      "primary_pattern": "å¿ƒè…ä¸äº¤",
      "possible_diseases": [
        "å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰"
      ],
      "pathogenesis": "å¿ƒè…ä¸äº¤è­‰çš„ç—…æ©Ÿæ˜¯å¿ƒè‡Ÿå’Œè…è‡Ÿä¹‹é–“çš„åŠŸèƒ½å¤±èª¿ï¼Œå°è‡´å¿ƒæ‚¸ã€å¤±çœ ç­‰ç—‡ç‹€ã€‚é€™å¯èƒ½æ˜¯ç”±æ–¼é•·æœŸçš„ç²¾ç¥ç·Šå¼µã€ç¼ºä¹ä¼‘æ¯ç­‰å› ç´ å°è‡´çš„ã€‚",
      "treatment_principle": "è«‹æ´½åˆæ ¼ä¸­é†«å¸«é€²è¡Œè©³ç´°è¨ºæ–·å’Œæ²»ç™‚å»ºè­°",
      "followup_questions": [
        "æ‚¨æœ€è¿‘æ˜¯å¦æœ‰ç²¾ç¥ç·Šå¼µæˆ–å£“åŠ›ï¼Ÿ",
        "æ‚¨æ˜¯å¦æœ‰è¦å¾‹çš„ä½œæ¯æ™‚é–“ï¼Ÿ",
        "æ‚¨æ˜¯å¦æœ‰å…¶ä»–çš„ç—‡ç‹€ï¼Œå¦‚é ­æšˆã€å£ä¹¾ç­‰ï¼Ÿ"
      ]
    },
    "selected_case": {
      "case_id": "CASE_20251005212239_M890_ebf84a5e",
      "match_score": 0.9831,
      "match_reason": "ä½¿ç”¨è€…çš„ä¸»è¨´å¿ƒæ‚¸å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±èˆ‡æ¡ˆä¾‹çš„ç—‡ç‹€ç›¸ç¬¦ï¼Œä¸”æ¡ˆä¾‹çš„è¨ºæ–·ç‚ºå¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰ï¼Œèˆ‡ä½¿ç”¨è€…çš„ç—‡ç‹€å»åˆã€‚"
    }
2025-11-04 03:58:02 - s_cbr.LLMClient - ERROR - âŒ LLM JSON è§£æå¤±æ•—ï¼ˆä¿®å¾©å¾Œç‰‡æ®µï¼‰ï¼š
{
  "layer": "L3_SAFETY_REVIEW",
  "status": "rewritten",
  "input": {
    "diagnosis_payload": {
      "layer": "L2_CASE_ANCHORED_DIAGNOSIS",
      "status": "ok",
      "input": {
        "user_accumulated_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
        "retrieved_cases": [
          {
            "case_id": "CASE_20251005212239_M890_ebf84a5e",
            "score": 0.9831,
            "chief_complaint": "ç„¦æ…®å¤±çœ ä¸€æœˆ",
            "symptom_terms": [
              "å¤±çœ ",
              "ç›œæ±—"
            ],
            "syndrome_terms": [
              "è­‰å‹"
            ],
            "diagnosis": "å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰",
            "treatment_principle": "æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…",
            "tongue_terms": [
              "å¾®ç´…",
              "èˆŒé«”",
              "èˆŒè‹”",
              "è–„é»ƒ"
            ],
            "pulse_terms": [
              "ç·Šå¼µ",
              "è„ˆè±¡",
              "ç´°æ•¸",
              "ç´°å¼±",
              "é™°è™›"
            ],
            "zangfu_terms": [
              "å¿ƒæ‚¸",
              "å¿ƒ",
              "è‚è†½",
              "è…",
              "è‚º",
              "è„¾èƒƒ",
              "å¿ƒè…"
            ],
            "treatment_terms": [
              "äº¤é€š"
            ],
            "full_text": "..."
          },
          {
            "case_id": "CASE_20251005212254_D567_d31d0467",
            "score": 0.9464,
            "chief_complaint": "å¤±çœ å¤šå¤¢åŠå¹´",
            "symptom_terms": [
              "å¤±çœ "
            ],
            "syndrome_terms": [
              "è­‰å‹"
            ],
            "diagnosis": "å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰",
            "treatment_principle": "è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥",
            "tongue_terms": [
              "èˆŒé«”",
              "æ·¡ç´…",
              "èˆŒè‹”",
              "è–„ç™½"
            ],
            "pulse_terms": [
              "è„ˆè±¡",
              "ç´°å¼±",
              "æ²‰å¼±",
              "å…©è™›",
              "è™›æ"
            ],
            "zangfu_terms": [
              "å¿ƒæ‚¸",
              "å¿ƒ",
              "è‚è†½",
              "è…",
              "è‚º",
              "è„¾èƒƒ",
              "å¿ƒè„¾"
            ],
            "treatment_terms": [
              "è£œç›Š"
            ],
            "full_text": "..."
          },
          {
            "case_id": "CASE_20251005212248_U678_17f9e6cd",
            "score": 0.8662,
            "chief_complaint": "å¤±çœ ç„¦æ…®å…©æœˆ",
            "symptom_terms": [
              "å¤±çœ "
            ],
            "syndrome_terms": [
              "è­‰å‹"
            ],
            "diagnosis": "å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰",
            "treatment_principle": "è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥",
            "tongue_terms": [
              "ç™½å¤©",
              "èˆŒé«”",
              "æ·¡ç´…",
              "èˆŒè‹”",
              "è–„ç™½"
            ],
            "pulse_terms": [
              "è„ˆè±¡",
              "ç´°å¼±",
              "æ²‰å¼±",
              "å…©è™›",
              "è™›æ"
            ],
            "zangfu_terms": [
              "å¿ƒç…©",
              "å¿ƒæ‚¸",
              "å¿ƒ",
              "è‚è†½",
              "è…",
              "è‚º",
              "è„¾èƒƒ",
              "å¿ƒè„¾"
            ],
            "treatment_terms": [
              "è£œç›Š"
            ],
            "full_text": "..."
          }
        ],
        "selected_case": {
          "case_id": "CASE_20251005212239_M890_ebf84a5e",
          "match_score": 0.9831,
          "match_reason": "ä½¿ç”¨è€…çš„ä¸»è¨´å¿ƒæ‚¸å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±èˆ‡æ¡ˆä¾‹çš„ç—‡ç‹€ç›¸ç¬¦ï¼Œä¸”æ¡ˆä¾‹çš„è¨ºæ–·ç‚ºå¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰ï¼Œèˆ‡ä½¿ç”¨è€…çš„ç—‡ç‹€å»åˆã€‚"
        },
        "coverage_evaluation": {
          "user_symptoms_covered": [
            "å¿ƒæ‚¸",
            "å¤±çœ ",
            "èˆŒæ·¡",
            "è„ˆç´°å¼±"
          ],
          "user_symptoms_missing_in_case": [
            "åƒä¸å¤ªä¸‹"
          ],
          "case_symptoms_not_mentioned_by_user": [
            "ç›œæ±—",
            "é ­æšˆ"
          ],
          "coverage_ratio": 0.8
        },
        "tcm_inference": {
          "syndrome_analysis": "æ ¹æ“šä½¿ç”¨è€…çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œåƒè€ƒéŒ¨å®šæ¡ˆä¾‹çš„ç—‡ç‹€å’Œè¨ºæ–·ï¼Œåˆæ­¥åˆ¤æ–·ç‚ºå¿ƒè…ä¸äº¤è­‰ã€‚å¿ƒè…ä¸äº¤æ˜¯æŒ‡å¿ƒè‡Ÿå’Œè…è‡Ÿä¹‹é–“çš„åŠŸèƒ½å¤±èª¿ï¼Œå°è‡´å¿ƒæ‚¸ã€å¤±çœ ç­‰ç—‡ç‹€ã€‚ä½¿ç”¨è€…çš„èˆŒæ·¡ã€è„ˆç´°å¼±ä¹Ÿæ”¯æŒé€™å€‹è¨ºæ–·ã€‚",
          "primary_pattern": "å¿ƒè…ä¸äº¤",
          "possible_diseases": [
            "å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰"
          ],
          "pathogenesis": "å¿ƒè…ä¸äº¤è­‰çš„ç—…æ©Ÿæ˜¯å¿ƒè‡Ÿå’Œè…è‡Ÿä¹‹é–“çš„åŠŸèƒ½å¤±èª¿ï¼Œå°è‡´å¿ƒæ‚¸ã€å¤±çœ ç­‰ç—‡ç‹€ã€‚é€™å¯èƒ½æ˜¯ç”±æ–¼é•·æœŸçš„ç²¾ç¥ç·Šå¼µã€ç¼ºä¹ä¼‘æ¯ç­‰å› ç´ å°è‡´çš„ã€‚",
          "treatment_principle": "æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…",
          "followup_questions": [
            "æ‚¨æœ€è¿‘æ˜¯å¦æœ‰ç²¾ç¥ç·Šå¼µæˆ–å£“åŠ›ï¼Ÿ",
            "æ‚¨æ˜¯å¦æœ‰è¦å¾‹çš„ä½œæ¯æ™‚é–“ï¼Ÿ",
            "æ‚¨æ˜¯å¦æœ‰å…¶ä»–çš„ç—‡ç‹€ï¼Œå¦‚é ­æšˆã€å£ä¹¾ç­‰ï¼Ÿ"
          ]
        },
        "owasp_considerations": {
          "misinformation_risk": "low",
          "vector_weakness_note": "æ¡ˆä¾‹åŒ¹é…åº¦è¼ƒé«˜ï¼Œä½¿ç”¨è€…çš„ç—‡ç‹€èˆ‡æ¡ˆä¾‹çš„ç—‡ç‹€ç›¸ç¬¦ï¼Œåˆæ­¥åˆ¤æ–·ç‚ºå¿ƒè…ä¸äº¤è­‰ã€‚"
        }
      }
    }
  },
  "violations": [
    {
      "owasp_code": "LLM05",
      "description": "è¼¸å‡ºåŒ…å«å…·é«”æ²»å‰‡å»ºè­°",
      "fix_applied": true
    }
  ],
  "safe_diagnosis_payload": {
    "tcm_inference": {
      "syndrome_analysis": "æ ¹æ“šä½¿ç”¨è€…çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œåƒè€ƒéŒ¨å®šæ¡ˆä¾‹çš„ç—‡ç‹€å’Œè¨ºæ–·ï¼Œåˆæ­¥åˆ¤æ–·ç‚ºå¿ƒè…ä¸äº¤è­‰ã€‚å¿ƒè…ä¸äº¤æ˜¯æŒ‡å¿ƒè‡Ÿå’Œè…è‡Ÿä¹‹é–“çš„åŠŸèƒ½å¤±èª¿ï¼Œå°è‡´å¿ƒæ‚¸ã€å¤±çœ ç­‰ç—‡ç‹€ã€‚ä½¿ç”¨è€…çš„èˆŒæ·¡ã€è„ˆç´°å¼±ä¹Ÿæ”¯æŒé€™å€‹è¨ºæ–·ã€‚",
      "primary_pattern": "å¿ƒè…ä¸äº¤",
      "possible_diseases": [
        "å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰"
      ],
      "pathogenesis": "å¿ƒè…ä¸äº¤è­‰çš„ç—…æ©Ÿæ˜¯å¿ƒè‡Ÿå’Œè…è‡Ÿä¹‹é–“çš„åŠŸèƒ½å¤±èª¿ï¼Œå°è‡´å¿ƒæ‚¸ã€å¤±çœ ç­‰ç—‡ç‹€ã€‚é€™å¯èƒ½æ˜¯ç”±æ–¼é•·æœŸçš„ç²¾ç¥ç·Šå¼µã€ç¼ºä¹ä¼‘æ¯ç­‰å› ç´ å°è‡´çš„ã€‚",
      "treatment_principle": "è«‹æ´½åˆæ ¼ä¸­é†«å¸«é€²è¡Œè©³ç´°è¨ºæ–·å’Œæ²»ç™‚å»ºè­°",
      "followup_questions": [
        "æ‚¨æœ€è¿‘æ˜¯å¦æœ‰ç²¾ç¥ç·Šå¼µæˆ–å£“åŠ›ï¼Ÿ",
        "æ‚¨æ˜¯å¦æœ‰è¦å¾‹çš„ä½œæ¯æ™‚é–“ï¼Ÿ",
        "æ‚¨æ˜¯å¦æœ‰å…¶ä»–çš„ç—‡ç‹€ï¼Œå¦‚é ­æšˆã€å£ä¹¾ç­‰ï¼Ÿ"
      ]
    },
    "selected_case": {
      "case_id": "CASE_20251005212239_M890_ebf84a5e",
      "match_score": 0.9831,
      "match_reason": "ä½¿ç”¨è€…çš„ä¸»è¨´å¿ƒæ‚¸å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±èˆ‡æ¡ˆä¾‹çš„ç—‡ç‹€ç›¸ç¬¦ï¼Œä¸”æ¡ˆä¾‹çš„è¨ºæ–·ç‚ºå¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰ï¼Œèˆ‡ä½¿ç”¨è€…çš„ç—‡ç‹€å»åˆã€‚"
    }
2025-11-04 03:59:52 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 03:59:52 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 03:59:52 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 03:59:52 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 03:59:52 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 03:59:52 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 03:59:52 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 03:59:52 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:59:55 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:59:55 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 03:59:55 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:59:55 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:59:55 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:59:55 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 03:59:55 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:59:55 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:59:55 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:59:56 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:59:56 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 03:59:56 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 03:59:57 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 03:59:57 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 03:59:57 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 03:59:57 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 03:59:57 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 03:59:57 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 03:59:57 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 03:59:57 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 03:59:57 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 03:59:57 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 03:59:57 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 03:59:57 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 03:59:57 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 03:59:57 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 03:59:57 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 03:59:57 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 03:59:57 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 03:59:57 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 03:59:57 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 03:59:57 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 03:59:57 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 03:59:57 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 03:59:57 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:59:57 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 03:59:57 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 03:59:57 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 03:59:57 - s_cbr.backend.main - INFO - 
2025-11-04 03:59:57 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 03:59:57 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 03:59:57 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 03:59:57 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 03:59:57 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 03:59:57 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 03:59:57 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 03:59:57 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 03:59:58 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 03:59:58 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 03:59:58 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 03:59:58 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:01:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 04:01:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 04:01:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 04:01:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 04:01:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 04:01:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 04:01:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 04:01:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:01:34 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:01:34 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:01:34 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:01:34 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:01:34 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:01:34 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 04:01:34 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:01:34 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:01:34 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:01:35 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:01:35 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:01:35 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:01:35 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 04:01:35 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 04:01:35 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 04:01:35 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 04:01:35 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 04:01:35 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 04:01:35 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 04:01:35 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 04:01:35 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:01:35 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 04:01:36 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 04:01:36 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 04:01:36 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 04:01:36 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 04:01:36 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:01:36 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 04:01:36 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 04:01:36 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 04:01:36 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 04:01:36 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:01:36 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 04:01:36 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:01:36 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:01:40 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:01:40 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ç­‰ç—‡ç‹€ï¼ŒåŒæ™‚æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†å»ºè­°ã€‚"
}
2025-11-04 04:01:40 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ç­‰ç—‡ç‹€ï¼ŒåŒæ™‚æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†å»ºè­°ã€‚"
}
2025-11-04 04:01:40 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:01:40 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:02:02 - s_cbr.LLMClient - ERROR - âŒ LLM JSON è§£æå¤±æ•—ï¼ˆä¿®å¾©å‰ç‰‡æ®µï¼‰ï¼š
{
  "layer": "L3_SAFETY_REVIEW",
  "status": "rewritten",
  "input": {
    "diagnosis_payload": {
      ... (åŸå§‹è¼¸å…¥å…§å®¹)
    }
  },
  "violations": [
    {
      "owasp_code": "LLM05",
      "description": "è¼¸å‡ºåŒ…å«å…·é«”æ²»å‰‡å»ºè­°",
      "fix_applied": true
    }
  ],
  "safe_diagnosis_payload": {
    "tcm_inference": {
      "syndrome_analysis": "æ ¹æ“šæ‚¨çš„å¤±çœ ã€å¿ƒæ‚¸ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œåƒè€ƒéŒ¨å®šæ¡ˆä¾‹CASE_20251005212239_M890_ebf84a5eï¼Œå¯èƒ½æ˜¯å¿ƒè…ä¸äº¤è­‰å‹ï¼Œéœ€è¦æ»‹é™°é™ç«ã€äº¤é€šå¿ƒè…çš„æ²»å‰‡",
      "primary_pattern": "å¿ƒè…ä¸äº¤",
      "possible_diseases": ["å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰"],
      "pathogenesis": "æ€æ…®éåº¦å°è‡´å¿ƒè¡€è™§è™›ï¼Œå¿ƒè…ä¸äº¤ï¼Œå‡ºç¾å¤±çœ ã€å¿ƒæ‚¸ç­‰ç—‡ç‹€",
      "treatment_principle": "å®œæ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…ï¼Œè«‹æ´½åˆæ ¼ä¸­é†«å¸«",
      "followup_questions": ["æ‚¨çš„å¤±çœ æ˜¯é›£ä»¥å…¥ç¡ã€å®¹æ˜“é†’ä¾†ï¼Œé‚„æ˜¯æ—©é†’å¾Œç„¡æ³•å†ç¡ï¼Ÿ", "æ‚¨çš„èˆŒæ·¡æ˜¯æŒ‡èˆŒé ­é¡è‰²æ·¡ï¼Œé‚„æ˜¯èˆŒè‹”æ·¡ï¼Ÿ"]
    },
    "selected_case": {
      "case_id": "CASE_20251005212239_M890_ebf84a5e",
      "match_score": 0.9831,
      "match_reason": "ä¸»è¨´å¤±çœ ã€å¿ƒæ‚¸èˆ‡æ¡ˆä¾‹ç›¸ç¬¦ï¼ŒèˆŒæ·¡ã€è„ˆç´°å¼±ä¹Ÿèˆ‡æ¡ˆä¾‹çš„èˆŒè‹”ã€è„ˆè±¡æè¿°ç›¸è¿‘"
    },
    "coverage_evaluation": {
      "user_symptoms_covered": ["å¤±çœ ", "å¿ƒæ‚¸", "èˆŒæ·¡", "è„ˆç´°å¼±"],
      "user_symptoms_missing_in_case": ["åƒä¸å¤ªä¸‹"],
      "case_symptoms_not_mentioned_by_user": ["ç›œæ±—", "é ­æšˆ"],
      "coverage_ratio": 0.8
    }
  }
}
2025-11-04 04:02:02 - s_cbr.LLMClient - ERROR - âŒ LLM JSON è§£æå¤±æ•—ï¼ˆä¿®å¾©å¾Œç‰‡æ®µï¼‰ï¼š
{
  "layer": "L3_SAFETY_REVIEW",
  "status": "rewritten",
  "input": {
    "diagnosis_payload": {
      ... (åŸå§‹è¼¸å…¥å…§å®¹)
    }
  },
  "violations": [
    {
      "owasp_code": "LLM05",
      "description": "è¼¸å‡ºåŒ…å«å…·é«”æ²»å‰‡å»ºè­°",
      "fix_applied": true
    }
  ],
  "safe_diagnosis_payload": {
    "tcm_inference": {
      "syndrome_analysis": "æ ¹æ“šæ‚¨çš„å¤±çœ ã€å¿ƒæ‚¸ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œåƒè€ƒéŒ¨å®šæ¡ˆä¾‹CASE_20251005212239_M890_ebf84a5eï¼Œå¯èƒ½æ˜¯å¿ƒè…ä¸äº¤è­‰å‹ï¼Œéœ€è¦æ»‹é™°é™ç«ã€äº¤é€šå¿ƒè…çš„æ²»å‰‡",
      "primary_pattern": "å¿ƒè…ä¸äº¤",
      "possible_diseases": ["å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰"],
      "pathogenesis": "æ€æ…®éåº¦å°è‡´å¿ƒè¡€è™§è™›ï¼Œå¿ƒè…ä¸äº¤ï¼Œå‡ºç¾å¤±çœ ã€å¿ƒæ‚¸ç­‰ç—‡ç‹€",
      "treatment_principle": "å®œæ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…ï¼Œè«‹æ´½åˆæ ¼ä¸­é†«å¸«",
      "followup_questions": ["æ‚¨çš„å¤±çœ æ˜¯é›£ä»¥å…¥ç¡ã€å®¹æ˜“é†’ä¾†ï¼Œé‚„æ˜¯æ—©é†’å¾Œç„¡æ³•å†ç¡ï¼Ÿ", "æ‚¨çš„èˆŒæ·¡æ˜¯æŒ‡èˆŒé ­é¡è‰²æ·¡ï¼Œé‚„æ˜¯èˆŒè‹”æ·¡ï¼Ÿ"]
    },
    "selected_case": {
      "case_id": "CASE_20251005212239_M890_ebf84a5e",
      "match_score": 0.9831,
      "match_reason": "ä¸»è¨´å¤±çœ ã€å¿ƒæ‚¸èˆ‡æ¡ˆä¾‹ç›¸ç¬¦ï¼ŒèˆŒæ·¡ã€è„ˆç´°å¼±ä¹Ÿèˆ‡æ¡ˆä¾‹çš„èˆŒè‹”ã€è„ˆè±¡æè¿°ç›¸è¿‘"
    },
    "coverage_evaluation": {
      "user_symptoms_covered": ["å¤±çœ ", "å¿ƒæ‚¸", "èˆŒæ·¡", "è„ˆç´°å¼±"],
      "user_symptoms_missing_in_case": ["åƒä¸å¤ªä¸‹"],
      "case_symptoms_not_mentioned_by_user": ["ç›œæ±—", "é ­æšˆ"],
      "coverage_ratio": 0.8
    }
  }
}
2025-11-04 04:08:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 04:08:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 04:08:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 04:08:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 04:08:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 04:08:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 04:08:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 04:08:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:08:35 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:08:35 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:08:35 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:08:35 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:08:35 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:08:35 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 04:08:35 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:08:35 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:08:35 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:08:35 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:08:35 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:08:35 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:08:36 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 04:08:36 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 04:08:36 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 04:08:36 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 04:08:36 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 04:08:36 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 04:08:36 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 04:08:36 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 04:08:36 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:08:36 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 04:08:36 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 04:08:36 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 04:08:36 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 04:08:36 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 04:08:36 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:08:36 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 04:08:36 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 04:08:36 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 04:08:36 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 04:08:36 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:08:36 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 04:08:36 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:08:36 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:08:41 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:08:41 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸ä¸‹ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸ä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æå’Œè¾¨è­‰è«–æ²»ã€‚"
}
2025-11-04 04:08:41 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸ä¸‹ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸ä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æå’Œè¾¨è­‰è«–æ²»ã€‚"
}
2025-11-04 04:08:42 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:08:42 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:09:23 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:09:27 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:09:27 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œä¸”æåŠéœ€è¦çœ‹ä¸­é†«èª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "åƒä¸å¤ªä¸‹", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
```
2025-11-04 04:09:27 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œä¸”æåŠéœ€è¦çœ‹ä¸­é†«èª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "åƒä¸å¤ªä¸‹", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
```
2025-11-04 04:09:28 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:09:28 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:10:00 - s_cbr.LLMClient - ERROR - âŒ LLM JSON è§£æå¤±æ•—ï¼ˆä¿®å¾©å‰ç‰‡æ®µï¼‰ï¼š
{"layer": "L3_SAFETY_REVIEW", "status": "rewritten", "input": {"diagnosis_payload": {"layer": "L2_CASE_ANCHORED_DIAGNOSIS", "status": "ok", "input": {"user_accumulated_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚", "retrieved_cases": [{"case_id": "CASE_20251005212239_M890_ebf84a5e", "score": 1.0, "chief_complaint": "ç„¦æ…®å¤±çœ ä¸€æœˆ", "symptom_terms": ["å¤±çœ ", "ç›œæ±—"], "syndrome_terms": ["è­‰å‹"], "diagnosis": "å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰", "treatment_principle": "æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…", "tongue_terms": ["å¾®ç´…", "èˆŒé«”", "èˆŒè‹”", "è–„é»ƒ"], "pulse_terms": ["ç·Šå¼µ", "è„ˆè±¡", "ç´°æ•¸", "ç´°å¼±", "é™°è™›"], "zangfu_terms": ["å¿ƒæ‚¸", "å¿ƒ", "è‚è†½", "è…", "è‚º", "è„¾èƒƒ", "å¿ƒè…"], "treatment_terms": ["äº¤é€š"], "full_text": "..."}, {"case_id": "CASE_20251005212254_D567_d31d0467", "score": 0.7679, "chief_complaint": "å¤±çœ å¤šå¤¢åŠå¹´", "symptom_terms": ["å¤±çœ "], "syndrome_terms": ["è­‰å‹"], "diagnosis": "å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰", "treatment_principle": "è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥", "tongue_terms": ["èˆŒé«”", "æ·¡ç´…", "èˆŒè‹”", "è–„ç™½"], "pulse_terms": ["è„ˆè±¡", "ç´°å¼±", "æ²‰å¼±", "å…©è™›", "è™›æ"], "zangfu_terms": ["å¿ƒæ‚¸", "å¿ƒ", "è‚è†½", "è…", "è‚º", "è„¾èƒƒ", "å¿ƒè„¾"], "treatment_terms": ["è£œç›Š"], "full_text": "..."}, {"case_id": "CASE_20251005212248_U678_17f9e6cd", "score": 0.6729, "chief_complaint": "å¤±çœ ç„¦æ…®å…©æœˆ", "symptom_terms": ["å¤±çœ "], "syndrome_terms": ["è­‰å‹"], "diagnosis": "å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰", "treatment_principle": "è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥", "tongue_terms": ["ç™½å¤©", "èˆŒé«”", "æ·¡ç´…", "èˆŒè‹”", "è–„ç™½"], "pulse_terms": ["è„ˆè±¡", "ç´°å¼±", "æ²‰å¼±", "å…©è™›", "è™›æ"], "zangfu_terms": ["å¿ƒç…©", "å¿ƒæ‚¸", "å¿ƒ", "è‚è†½", "è…", "è‚º", "è„¾èƒƒ", "å¿ƒè„¾"], "treatment_terms": ["è£œç›Š"], "full_text": "..."}]}, "selected_case": {"case_id": "CASE_20251005212239_M890_ebf84a5e", "match_score": 1.0, "match_reason": "ä½¿ç”¨è€…çš„å¤±çœ å’Œç›œæ±—ç—‡ç‹€èˆ‡æ¡ˆä¾‹çš„ä¸»è¨´å’Œç—‡ç‹€åˆ—è¡¨é«˜åº¦åŒ¹é…ï¼Œä¸”æ¡ˆä¾‹çš„èˆŒè±¡å’Œè„ˆè±¡ä¹Ÿèˆ‡ä½¿ç”¨è€…çš„ç—‡ç‹€ç›¸ç¬¦ï¼Œè¡¨æ˜å¿ƒè…ä¸äº¤çš„è­‰å‹å¯èƒ½æ˜¯ä½¿ç”¨è€…çš„ç—…å› ã€‚"}, "coverage_evaluation": {"user_symptoms_covered": ["å¤±çœ ", "ç›œæ±—"], "user_symptoms_missing_in_case": [], "case_symptoms_not_mentioned_by_user": ["å¿ƒæ‚¸", "é ­æšˆ"], "coverage_ratio": 1.0}, "tcm_inference": {"syndrome_analysis": "æ ¹æ“šä½¿ç”¨è€…çš„å¤±çœ å’Œç›œæ±—ç—‡ç‹€ï¼Œåƒè€ƒéŒ¨å®šæ¡ˆä¾‹çš„è­‰å‹å’Œè‡Ÿè…‘å®šä½ï¼Œä½¿ç”¨è€…å¯èƒ½æ‚£æœ‰å¿ƒè…ä¸äº¤è­‰ï¼Œè¡¨ç¾ç‚ºå¿ƒç«ä¸Šç‚ï¼Œè…æ°´ä¸‹è™›ï¼Œå°è‡´å¤±çœ å’Œç›œæ±—ç­‰ç—‡ç‹€ã€‚", "primary_pattern": "å¿ƒè…ä¸äº¤", "possible_diseases": ["å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰"], "pathogenesis": "å¿ƒç«ä¸Šç‚ï¼Œè…æ°´ä¸‹è™›ï¼Œå°è‡´å¿ƒè…ä¸äº¤ï¼Œå‡ºç¾å¤±çœ å’Œç›œæ±—ç­‰ç—‡ç‹€ã€‚", "treatment_principle": "æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…", "followup_questions": ["æ‚¨æ˜¯å¦æœ‰å¿ƒæ‚¸æˆ–é ­æšˆçš„ç—‡ç‹€ï¼Ÿ", "æ‚¨æ˜¯å¦æœ‰å£ä¹¾æˆ–å°¿é »çš„ç—‡ç‹€ï¼Ÿ"]}, "owasp_considerations": {"misinformation_risk": "low", "vector_weakness_note": "æ¡ˆä¾‹åŒ¹é…åº¦é«˜ï¼Œä½¿ç”¨è€…çš„ç—‡ç‹€èˆ‡æ¡ˆä¾‹çš„ä¸»è¨´å’Œç—‡ç‹€åˆ—è¡¨é«˜åº¦åŒ¹é…ï¼Œè¡¨æ˜å¿ƒè…ä¸äº¤çš„è­‰å‹å¯èƒ½æ˜¯ä½¿ç”¨è€…çš„ç—…å› ã€‚"}}}}, "violations": [{"owasp_code": "LLM05", "description": "è¼¸å‡ºåŒ…å«å…·é«”æ²»å‰‡å»ºè­°", "fix_applied": true}], "safe_diagnosis_payload": {"tcm_inference": {"syndrome_analysis": "æ ¹æ“šä½¿ç”¨è€…çš„å¤±çœ å’Œç›œæ±—ç—‡ç‹€ï¼Œåƒè€ƒéŒ¨å®šæ¡ˆä¾‹çš„è­‰å‹å’Œè‡Ÿè…‘å®šä½ï¼Œä½¿ç”¨è€…å¯èƒ½æ‚£æœ‰å¿ƒè…ä¸äº¤è­‰ï¼Œè¡¨ç¾ç‚ºå¿ƒç«ä¸Šç‚ï¼Œè…æ°´ä¸‹è™›ï¼Œå°è‡´å¤±çœ å’Œç›œæ±—ç­‰ç—‡ç‹€ã€‚", "primary_pattern": "å¿ƒè…ä¸äº¤", "possible_diseases": ["å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰"], "pathogenesis": "å¿ƒç«ä¸Šç‚ï¼Œè…æ°´ä¸‹è™›ï¼Œå°è‡´å¿ƒè…ä¸äº¤ï¼Œå‡ºç¾å¤±çœ å’Œç›œæ±—ç­‰ç—‡ç‹€ã€‚", "treatment_principle": "è«‹æ´½åˆæ ¼ä¸­é†«å¸«", "followup_questions": ["æ‚¨æ˜¯å¦æœ‰å¿ƒæ‚¸æˆ–é ­æšˆçš„ç—‡ç‹€ï¼Ÿ", "æ‚¨æ˜¯å¦æœ‰å£ä¹¾æˆ–å°¿é »çš„ç—‡ç‹€ï¼Ÿ"]}, "selected_case": {"case_id": "CASE_20251005212239_M890_ebf84a5e", "match_score": 1.0, "match_reason": "ä½¿ç”¨è€…çš„å¤±çœ å’Œç›œæ±—ç—‡ç‹€èˆ‡æ¡ˆä¾‹çš„ä¸»è¨´å’Œç—‡ç‹€åˆ—è¡¨é«˜åº¦åŒ¹é…ï¼Œä¸”æ¡ˆä¾‹çš„èˆŒè±¡å’Œè„ˆè±¡ä¹Ÿèˆ‡ä½¿ç”¨è€…çš„ç—‡ç‹€ç›¸ç¬¦ï¼Œè¡¨æ˜å¿ƒè…ä¸äº¤çš„è­‰å‹å¯èƒ½æ˜¯ä½¿ç”¨è€…çš„ç—…å› ã€‚"}, "coverage_evaluation": {"user_symptoms_covered": ["å¤±çœ ", "ç›œæ±—"], "user_symptoms_missing_in_case": [], "case_symptoms_not_mentioned_by_user": ["å¿ƒæ‚¸", "é ­æšˆ"], "coverage_ratio": 1.0}}}
2025-11-04 04:10:00 - s_cbr.LLMClient - ERROR - âŒ LLM JSON è§£æå¤±æ•—ï¼ˆä¿®å¾©å¾Œç‰‡æ®µï¼‰ï¼š
{"layer": "L3_SAFETY_REVIEW", "status": "rewritten", "input": {"diagnosis_payload": {"layer": "L2_CASE_ANCHORED_DIAGNOSIS", "status": "ok", "input": {"user_accumulated_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚", "retrieved_cases": [{"case_id": "CASE_20251005212239_M890_ebf84a5e", "score": 1.0, "chief_complaint": "ç„¦æ…®å¤±çœ ä¸€æœˆ", "symptom_terms": ["å¤±çœ ", "ç›œæ±—"], "syndrome_terms": ["è­‰å‹"], "diagnosis": "å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰", "treatment_principle": "æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…", "tongue_terms": ["å¾®ç´…", "èˆŒé«”", "èˆŒè‹”", "è–„é»ƒ"], "pulse_terms": ["ç·Šå¼µ", "è„ˆè±¡", "ç´°æ•¸", "ç´°å¼±", "é™°è™›"], "zangfu_terms": ["å¿ƒæ‚¸", "å¿ƒ", "è‚è†½", "è…", "è‚º", "è„¾èƒƒ", "å¿ƒè…"], "treatment_terms": ["äº¤é€š"], "full_text": "..."}, {"case_id": "CASE_20251005212254_D567_d31d0467", "score": 0.7679, "chief_complaint": "å¤±çœ å¤šå¤¢åŠå¹´", "symptom_terms": ["å¤±çœ "], "syndrome_terms": ["è­‰å‹"], "diagnosis": "å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰", "treatment_principle": "è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥", "tongue_terms": ["èˆŒé«”", "æ·¡ç´…", "èˆŒè‹”", "è–„ç™½"], "pulse_terms": ["è„ˆè±¡", "ç´°å¼±", "æ²‰å¼±", "å…©è™›", "è™›æ"], "zangfu_terms": ["å¿ƒæ‚¸", "å¿ƒ", "è‚è†½", "è…", "è‚º", "è„¾èƒƒ", "å¿ƒè„¾"], "treatment_terms": ["è£œç›Š"], "full_text": "..."}, {"case_id": "CASE_20251005212248_U678_17f9e6cd", "score": 0.6729, "chief_complaint": "å¤±çœ ç„¦æ…®å…©æœˆ", "symptom_terms": ["å¤±çœ "], "syndrome_terms": ["è­‰å‹"], "diagnosis": "å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰", "treatment_principle": "è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥", "tongue_terms": ["ç™½å¤©", "èˆŒé«”", "æ·¡ç´…", "èˆŒè‹”", "è–„ç™½"], "pulse_terms": ["è„ˆè±¡", "ç´°å¼±", "æ²‰å¼±", "å…©è™›", "è™›æ"], "zangfu_terms": ["å¿ƒç…©", "å¿ƒæ‚¸", "å¿ƒ", "è‚è†½", "è…", "è‚º", "è„¾èƒƒ", "å¿ƒè„¾"], "treatment_terms": ["è£œç›Š"], "full_text": "..."}]}, "selected_case": {"case_id": "CASE_20251005212239_M890_ebf84a5e", "match_score": 1.0, "match_reason": "ä½¿ç”¨è€…çš„å¤±çœ å’Œç›œæ±—ç—‡ç‹€èˆ‡æ¡ˆä¾‹çš„ä¸»è¨´å’Œç—‡ç‹€åˆ—è¡¨é«˜åº¦åŒ¹é…ï¼Œä¸”æ¡ˆä¾‹çš„èˆŒè±¡å’Œè„ˆè±¡ä¹Ÿèˆ‡ä½¿ç”¨è€…çš„ç—‡ç‹€ç›¸ç¬¦ï¼Œè¡¨æ˜å¿ƒè…ä¸äº¤çš„è­‰å‹å¯èƒ½æ˜¯ä½¿ç”¨è€…çš„ç—…å› ã€‚"}, "coverage_evaluation": {"user_symptoms_covered": ["å¤±çœ ", "ç›œæ±—"], "user_symptoms_missing_in_case": [], "case_symptoms_not_mentioned_by_user": ["å¿ƒæ‚¸", "é ­æšˆ"], "coverage_ratio": 1.0}, "tcm_inference": {"syndrome_analysis": "æ ¹æ“šä½¿ç”¨è€…çš„å¤±çœ å’Œç›œæ±—ç—‡ç‹€ï¼Œåƒè€ƒéŒ¨å®šæ¡ˆä¾‹çš„è­‰å‹å’Œè‡Ÿè…‘å®šä½ï¼Œä½¿ç”¨è€…å¯èƒ½æ‚£æœ‰å¿ƒè…ä¸äº¤è­‰ï¼Œè¡¨ç¾ç‚ºå¿ƒç«ä¸Šç‚ï¼Œè…æ°´ä¸‹è™›ï¼Œå°è‡´å¤±çœ å’Œç›œæ±—ç­‰ç—‡ç‹€ã€‚", "primary_pattern": "å¿ƒè…ä¸äº¤", "possible_diseases": ["å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰"], "pathogenesis": "å¿ƒç«ä¸Šç‚ï¼Œè…æ°´ä¸‹è™›ï¼Œå°è‡´å¿ƒè…ä¸äº¤ï¼Œå‡ºç¾å¤±çœ å’Œç›œæ±—ç­‰ç—‡ç‹€ã€‚", "treatment_principle": "æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…", "followup_questions": ["æ‚¨æ˜¯å¦æœ‰å¿ƒæ‚¸æˆ–é ­æšˆçš„ç—‡ç‹€ï¼Ÿ", "æ‚¨æ˜¯å¦æœ‰å£ä¹¾æˆ–å°¿é »çš„ç—‡ç‹€ï¼Ÿ"]}, "owasp_considerations": {"misinformation_risk": "low", "vector_weakness_note": "æ¡ˆä¾‹åŒ¹é…åº¦é«˜ï¼Œä½¿ç”¨è€…çš„ç—‡ç‹€èˆ‡æ¡ˆä¾‹çš„ä¸»è¨´å’Œç—‡ç‹€åˆ—è¡¨é«˜åº¦åŒ¹é…ï¼Œè¡¨æ˜å¿ƒè…ä¸äº¤çš„è­‰å‹å¯èƒ½æ˜¯ä½¿ç”¨è€…çš„ç—…å› ã€‚"}}}}, "violations": [{"owasp_code": "LLM05", "description": "è¼¸å‡ºåŒ…å«å…·é«”æ²»å‰‡å»ºè­°", "fix_applied": true}], "safe_diagnosis_payload": {"tcm_inference": {"syndrome_analysis": "æ ¹æ“šä½¿ç”¨è€…çš„å¤±çœ å’Œç›œæ±—ç—‡ç‹€ï¼Œåƒè€ƒéŒ¨å®šæ¡ˆä¾‹çš„è­‰å‹å’Œè‡Ÿè…‘å®šä½ï¼Œä½¿ç”¨è€…å¯èƒ½æ‚£æœ‰å¿ƒè…ä¸äº¤è­‰ï¼Œè¡¨ç¾ç‚ºå¿ƒç«ä¸Šç‚ï¼Œè…æ°´ä¸‹è™›ï¼Œå°è‡´å¤±çœ å’Œç›œæ±—ç­‰ç—‡ç‹€ã€‚", "primary_pattern": "å¿ƒè…ä¸äº¤", "possible_diseases": ["å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰"], "pathogenesis": "å¿ƒç«ä¸Šç‚ï¼Œè…æ°´ä¸‹è™›ï¼Œå°è‡´å¿ƒè…ä¸äº¤ï¼Œå‡ºç¾å¤±çœ å’Œç›œæ±—ç­‰ç—‡ç‹€ã€‚", "treatment_principle": "è«‹æ´½åˆæ ¼ä¸­é†«å¸«", "followup_questions": ["æ‚¨æ˜¯å¦æœ‰å¿ƒæ‚¸æˆ–é ­æšˆçš„ç—‡ç‹€ï¼Ÿ", "æ‚¨æ˜¯å¦æœ‰å£ä¹¾æˆ–å°¿é »çš„ç—‡ç‹€ï¼Ÿ"]}, "selected_case": {"case_id": "CASE_20251005212239_M890_ebf84a5e", "match_score": 1.0, "match_reason": "ä½¿ç”¨è€…çš„å¤±çœ å’Œç›œæ±—ç—‡ç‹€èˆ‡æ¡ˆä¾‹çš„ä¸»è¨´å’Œç—‡ç‹€åˆ—è¡¨é«˜åº¦åŒ¹é…ï¼Œä¸”æ¡ˆä¾‹çš„èˆŒè±¡å’Œè„ˆè±¡ä¹Ÿèˆ‡ä½¿ç”¨è€…çš„ç—‡ç‹€ç›¸ç¬¦ï¼Œè¡¨æ˜å¿ƒè…ä¸äº¤çš„è­‰å‹å¯èƒ½æ˜¯ä½¿ç”¨è€…çš„ç—…å› ã€‚"}, "coverage_evaluation": {"user_symptoms_covered": ["å¤±çœ ", "ç›œæ±—"], "user_symptoms_missing_in_case": [], "case_symptoms_not_mentioned_by_user": ["å¿ƒæ‚¸", "é ­æšˆ"], "coverage_ratio": 1.0}}}
2025-11-04 04:12:47 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 04:12:47 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 04:12:47 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 04:12:47 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 04:12:47 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 04:12:47 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 04:12:47 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 04:12:47 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:12:50 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:12:50 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:12:50 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:12:50 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:12:50 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:12:50 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 04:12:50 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:12:50 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:12:50 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:12:50 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:12:50 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:12:50 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:12:51 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 04:12:51 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 04:12:51 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 04:12:51 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 04:12:51 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 04:12:51 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 04:12:51 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 04:12:51 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 04:12:51 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:12:51 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 04:12:51 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 04:12:51 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 04:12:51 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 04:12:51 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 04:12:51 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:12:51 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 04:12:51 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 04:12:51 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 04:12:51 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 04:12:51 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:12:51 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 04:12:51 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 04:12:51 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 04:12:51 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 04:12:51 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 04:12:51 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 04:12:51 - s_cbr.backend.main - INFO - 
2025-11-04 04:12:51 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 04:12:51 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 04:12:51 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 04:12:51 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 04:12:51 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 04:12:51 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 04:12:51 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 04:12:51 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 04:12:52 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 04:12:52 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 04:12:52 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 04:12:52 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:13:07 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 04:13:07 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 04:13:07 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 04:13:07 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 04:13:07 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 04:13:07 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 04:13:07 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 04:13:07 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:13:10 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:13:10 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:13:10 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:13:10 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:13:10 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:13:10 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 04:13:10 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:13:10 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:13:10 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:13:11 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:13:11 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:13:11 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:13:11 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 04:13:11 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 04:13:11 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 04:13:11 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 04:13:11 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 04:13:11 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 04:13:11 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 04:13:11 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 04:13:11 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:13:11 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 04:13:11 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 04:13:11 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 04:13:11 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 04:13:11 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 04:13:12 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:13:12 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 04:13:12 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 04:13:12 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 04:13:12 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 04:13:12 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:13:12 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 04:13:12 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:13:12 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:13:15 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:13:15 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ç­‰ç—‡ç‹€ï¼ŒåŒæ™‚æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 04:13:15 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ç­‰ç—‡ç‹€ï¼ŒåŒæ™‚æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 04:13:16 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:13:16 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:13:34 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:13:38 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:13:38 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œä¸”æåŠéœ€è¦çœ‹ä¸­é†«èª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æ™šä¸Šå®¹æ˜“é†’ä¾†"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 04:13:38 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œä¸”æåŠéœ€è¦çœ‹ä¸­é†«èª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æ™šä¸Šå®¹æ˜“é†’ä¾†"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 04:13:39 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:13:39 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:14:33 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:14:37 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:14:37 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œä¸”æåˆ°äº†éœ€è¦çœ‹ä¸­é†«èª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 04:14:37 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œä¸”æåˆ°äº†éœ€è¦çœ‹ä¸­é†«èª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 04:14:38 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:14:38 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:14:53 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:14:57 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:14:57 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 04:14:57 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 04:14:59 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:14:59 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:15:15 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:15:19 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:15:19 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«çš„è­‰å‹åˆ†æç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ"
    ],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 04:15:19 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«çš„è­‰å‹åˆ†æç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ"
    ],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 04:15:20 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:15:20 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:15:36 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:15:40 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:15:40 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒè±¡ã€è„ˆè±¡å’Œä¸»è¨´ç—‡ç‹€ï¼Œè¡¨æ˜æ˜¯ä¸€å€‹ä¸­é†«è¨ºæ–·çš„ä»»å‹™ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·åˆ†æã€‚"
}
2025-11-04 04:15:40 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒè±¡ã€è„ˆè±¡å’Œä¸»è¨´ç—‡ç‹€ï¼Œè¡¨æ˜æ˜¯ä¸€å€‹ä¸­é†«è¨ºæ–·çš„ä»»å‹™ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·åˆ†æã€‚"
}
2025-11-04 04:15:40 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:15:40 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:34:19 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 04:34:19 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 04:34:19 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 04:34:19 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 04:34:19 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 04:34:19 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 04:34:19 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 04:34:19 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:34:22 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:34:22 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:34:22 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:34:22 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:34:22 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:34:22 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 04:34:22 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:34:22 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:34:22 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:34:22 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:34:22 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:34:22 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:34:23 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 04:34:23 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 04:34:23 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 04:34:23 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 04:34:23 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 04:34:23 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 04:34:23 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 04:34:23 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 04:34:23 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:34:23 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 04:34:23 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 04:34:23 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 04:34:23 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 04:34:23 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 04:34:23 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:34:23 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 04:34:23 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 04:34:23 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 04:34:23 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 04:34:23 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:34:23 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 04:34:23 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 04:34:23 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 04:34:23 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 04:34:23 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 04:34:23 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 04:34:23 - s_cbr.backend.main - INFO - 
2025-11-04 04:34:23 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 04:34:23 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 04:34:23 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 04:34:23 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 04:34:23 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 04:34:23 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 04:34:23 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 04:34:23 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 04:34:24 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 04:34:24 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 04:34:24 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 04:34:24 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:34:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 04:34:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 04:34:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 04:34:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 04:34:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 04:34:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 04:34:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 04:34:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:34:36 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:34:36 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:34:36 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:34:36 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:34:36 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:34:36 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 04:34:36 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:34:36 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:34:36 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:34:36 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:34:36 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:34:36 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:34:37 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 04:34:37 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 04:34:37 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 04:34:37 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 04:34:37 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 04:34:37 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 04:34:37 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 04:34:37 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 04:34:37 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:34:37 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 04:34:37 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 04:34:37 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 04:34:37 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 04:34:37 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 04:34:37 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:34:37 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 04:34:37 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 04:34:37 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 04:34:37 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 04:34:37 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:34:37 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 04:34:37 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 04:34:37 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 04:34:37 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 04:34:37 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 04:34:37 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 04:34:37 - s_cbr.backend.main - INFO - 
2025-11-04 04:34:37 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 04:34:37 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 04:34:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 04:34:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 04:34:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 04:34:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 04:34:37 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 04:34:37 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 04:34:38 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 04:34:39 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 04:34:39 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 04:34:39 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:34:48 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 04:34:48 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 04:34:48 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 04:34:48 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 04:34:48 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 04:34:48 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 04:34:48 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 04:34:48 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:34:51 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:34:51 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:34:51 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:34:51 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:34:51 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:34:51 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 04:34:51 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:34:51 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:34:51 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:34:51 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:34:51 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:34:51 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:34:52 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 04:34:52 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 04:34:52 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 04:34:52 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 04:34:52 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 04:34:52 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 04:34:52 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 04:34:52 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 04:34:52 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:34:52 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 04:34:52 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 04:34:52 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 04:34:52 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 04:34:52 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 04:34:52 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:34:52 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 04:34:52 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 04:34:52 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 04:34:52 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 04:34:52 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:34:52 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 04:34:52 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 04:34:52 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 04:34:52 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 04:34:52 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 04:34:52 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 04:34:52 - s_cbr.backend.main - INFO - 
2025-11-04 04:34:52 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 04:34:52 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 04:34:52 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 04:34:52 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 04:34:52 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 04:34:52 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 04:34:52 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 04:34:52 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 04:34:53 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 04:34:53 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 04:34:53 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 04:34:53 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:35:02 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 04:35:02 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 04:35:02 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 04:35:02 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 04:35:02 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 04:35:02 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 04:35:02 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 04:35:02 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:35:05 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:35:05 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:35:05 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:35:05 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:35:05 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:35:05 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 04:35:05 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:35:05 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:35:05 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:35:05 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:35:05 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:35:05 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:35:06 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 04:35:06 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 04:35:06 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 04:35:06 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 04:35:06 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 04:35:06 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 04:35:06 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 04:35:06 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 04:35:06 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:35:06 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 04:35:06 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 04:35:06 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 04:35:06 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 04:35:06 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 04:35:07 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:35:07 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 04:35:07 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 04:35:07 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 04:35:07 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 04:35:07 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:35:07 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 04:35:07 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 04:35:07 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 04:35:07 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 04:35:07 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 04:35:07 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 04:35:07 - s_cbr.backend.main - INFO - 
2025-11-04 04:35:07 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 04:35:07 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 04:35:07 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 04:35:07 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 04:35:07 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 04:35:07 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 04:35:07 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 04:35:07 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 04:35:07 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 04:35:08 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 04:35:08 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 04:35:08 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:36:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 04:36:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 04:36:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 04:36:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 04:36:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 04:36:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 04:36:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 04:36:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:36:45 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:36:45 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:36:45 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:36:45 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:36:45 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:36:45 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 04:36:45 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:36:45 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:36:45 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:36:45 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:36:45 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:36:45 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:36:46 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 04:36:46 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 04:36:46 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 04:36:46 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 04:36:46 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 04:36:46 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 04:36:46 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 04:36:46 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 04:36:46 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:36:46 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 04:36:46 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 04:36:46 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 04:36:46 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 04:36:46 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 04:36:46 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:36:46 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 04:36:46 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 04:36:46 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 04:36:46 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 04:36:46 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:36:46 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 04:36:46 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:36:46 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:36:50 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:36:50 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒè„ˆç‰¹å¾µï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©"
}
2025-11-04 04:36:50 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒè„ˆç‰¹å¾µï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©"
}
2025-11-04 04:36:52 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:36:52 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:37:44 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:37:48 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:37:48 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æ™šä¸Šå®¹æ˜“é†’ä¾†"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 04:37:48 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æ™šä¸Šå®¹æ˜“é†’ä¾†"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 04:37:50 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:37:50 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:38:41 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:38:46 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:38:46 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 04:38:46 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 04:38:47 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:38:47 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:39:10 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:39:14 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:39:14 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„èƒƒéƒ¨ç—‡ç‹€ï¼Œæ¶‰åŠè„¹ç—›ã€å—³æ°£å’Œæ—©é£½ï¼Œèˆ‡ä¸­é†«çš„èƒƒç—…æˆ–è„¾èƒƒä¸å’Œçš„ç—‡ç‹€ç›¸ç¬¦ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ",
      "è„¾"
    ],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡å˜—è©¦æ ¹æ“šæ‚¨çš„æè¿°é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 04:39:14 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„èƒƒéƒ¨ç—‡ç‹€ï¼Œæ¶‰åŠè„¹ç—›ã€å—³æ°£å’Œæ—©é£½ï¼Œèˆ‡ä¸­é†«çš„èƒƒç—…æˆ–è„¾èƒƒä¸å’Œçš„ç—‡ç‹€ç›¸ç¬¦ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ",
      "è„¾"
    ],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡å˜—è©¦æ ¹æ“šæ‚¨çš„æè¿°é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 04:39:15 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:39:15 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:39:37 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:39:41 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:39:41 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼Œå¦‚èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œèˆ‡ä¸­é†«çš„è­‰å‹åˆ†æç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 04:39:41 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼Œå¦‚èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œèˆ‡ä¸­é†«çš„è­‰å‹åˆ†æç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 04:39:43 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:39:43 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:40:06 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:40:10 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:40:10 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€å£è‹¦ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µçš„å½±éŸ¿ï¼Œç¬¦åˆä¸­é†«è¨ºæ–·çš„ç‰¹é»ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["èƒƒè„˜è„¹ç—›", "å—³æ°£", "æ—©é£½", "å£è‹¦"],
    "tongue_pulse_terms": ["èˆŒç´…", "è‹”é»ƒè†©", "è„ˆå¼¦æ»‘"],
    "zangfu_terms": [],
    "other_terms": ["æƒ…ç·’ç·Šå¼µ"],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
```
2025-11-04 04:40:10 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€å£è‹¦ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µçš„å½±éŸ¿ï¼Œç¬¦åˆä¸­é†«è¨ºæ–·çš„ç‰¹é»ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["èƒƒè„˜è„¹ç—›", "å—³æ°£", "æ—©é£½", "å£è‹¦"],
    "tongue_pulse_terms": ["èˆŒç´…", "è‹”é»ƒè†©", "è„ˆå¼¦æ»‘"],
    "zangfu_terms": [],
    "other_terms": ["æƒ…ç·’ç·Šå¼µ"],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
```
2025-11-04 04:40:11 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:40:11 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:40:33 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å…¥éé•·ï¼Œå¾ 3179 æˆªæ–·è‡³ 3000 å­—ç¬¦
2025-11-04 04:40:54 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å…¥éé•·ï¼Œå¾ 3183 æˆªæ–·è‡³ 3000 å­—ç¬¦
2025-11-04 04:56:54 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 04:56:54 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 04:56:54 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 04:56:54 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 04:56:54 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 04:56:54 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 04:56:54 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 04:56:54 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:56:57 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:56:57 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:56:57 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:56:57 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:56:57 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:56:57 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 04:56:57 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:56:57 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:56:57 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:56:57 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:56:57 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:56:57 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:56:58 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 04:56:58 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 04:56:58 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 04:56:58 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 04:56:58 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 04:56:58 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 04:56:58 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 04:56:58 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 04:56:58 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:56:58 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 04:56:58 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 04:56:58 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 04:56:58 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 04:56:58 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 04:56:58 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:56:58 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 04:56:58 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 04:56:58 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 04:56:58 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 04:56:58 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:56:58 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 04:56:58 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 04:56:58 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 04:56:58 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 04:56:58 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 04:56:58 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 04:56:58 - s_cbr.backend.main - INFO - 
2025-11-04 04:56:58 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 04:56:58 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 04:56:58 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 04:56:58 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 04:56:58 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 04:56:58 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 04:56:58 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 04:56:58 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 04:56:59 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 04:56:59 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 04:57:00 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 04:57:00 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:57:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 04:57:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 04:57:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 04:57:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 04:57:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 04:57:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 04:57:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 04:57:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:57:10 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:57:10 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:57:10 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:57:10 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:57:10 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:57:10 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 04:57:10 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:57:10 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:57:10 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:57:10 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:57:10 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:57:10 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:57:11 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 04:57:11 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 04:57:11 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 04:57:11 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 04:57:11 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 04:57:11 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 04:57:11 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 04:57:11 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 04:57:11 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:57:11 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 04:57:11 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 04:57:11 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 04:57:11 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 04:57:11 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 04:57:11 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:57:11 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 04:57:11 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 04:57:11 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 04:57:11 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 04:57:11 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:57:11 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 04:57:11 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 04:57:11 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 04:57:11 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 04:57:11 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 04:57:11 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 04:57:11 - s_cbr.backend.main - INFO - 
2025-11-04 04:57:11 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 04:57:11 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 04:57:11 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 04:57:11 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 04:57:11 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 04:57:11 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 04:57:11 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 04:57:11 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 04:57:12 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 04:57:12 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 04:57:12 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 04:57:12 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:58:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 04:58:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 04:58:34 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 04:58:34 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 04:58:34 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 04:58:34 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 04:58:34 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 04:58:34 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:58:37 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:58:37 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 04:58:37 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:58:37 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:58:37 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:58:37 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 04:58:37 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:58:37 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:58:37 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:58:37 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:58:37 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:58:37 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 04:58:38 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 04:58:38 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 04:58:38 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 04:58:38 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 04:58:38 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 04:58:38 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 04:58:38 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 04:58:38 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 04:58:38 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 04:58:38 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 04:58:38 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 04:58:38 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 04:58:38 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 04:58:38 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 04:58:38 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:58:38 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 04:58:38 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 04:58:38 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 04:58:38 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 04:58:38 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 04:58:38 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 04:58:38 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 04:58:39 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:58:43 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:58:43 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸ä¸‹ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸ä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æå’Œè¾¨è­‰è«–æ²»ã€‚"
}
2025-11-04 04:58:43 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸ä¸‹ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸ä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æå’Œè¾¨è­‰è«–æ²»ã€‚"
}
2025-11-04 04:58:44 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:58:44 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:59:10 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:59:14 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:59:14 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 04:59:14 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 04:59:15 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:59:15 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 04:59:49 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 04:59:53 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 04:59:53 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "èˆŒæ·¡", "è„ˆç´°å¼±", "å°ä¾¿æ¸…é•·", "æ€•å†·", "ç™½å¸¶é‡å¤š", "æ™šä¸Šå®¹æ˜“é†’ä¾†", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
```
2025-11-04 04:59:53 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "èˆŒæ·¡", "è„ˆç´°å¼±", "å°ä¾¿æ¸…é•·", "æ€•å†·", "ç™½å¸¶é‡å¤š", "æ™šä¸Šå®¹æ˜“é†’ä¾†", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
```
2025-11-04 04:59:55 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 04:59:55 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:00:19 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:00:22 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:00:22 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼Œå¦‚èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡å˜—è©¦æ ¹æ“šæ‚¨çš„æè¿°é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 05:00:22 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼Œå¦‚èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡å˜—è©¦æ ¹æ“šæ‚¨çš„æè¿°é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 05:00:24 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:00:24 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:00:34 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:00:38 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:00:38 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼Œå¦‚èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œèˆ‡ä¸­é†«çš„è­‰å‹åˆ†æç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["èƒƒè„˜è„¹ç—›", "å—³æ°£", "æ—©é£½", "æƒ…ç·’ç·Šå¼µ", "å£è‹¦"],
    "tongue_pulse_terms": [],
    "zangfu_terms": ["èƒƒ"],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
```
2025-11-04 05:00:38 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼Œå¦‚èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œèˆ‡ä¸­é†«çš„è­‰å‹åˆ†æç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["èƒƒè„˜è„¹ç—›", "å—³æ°£", "æ—©é£½", "æƒ…ç·’ç·Šå¼µ", "å£è‹¦"],
    "tongue_pulse_terms": [],
    "zangfu_terms": ["èƒƒ"],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
```
2025-11-04 05:00:38 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:00:38 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:00:50 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:00:55 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:00:55 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µçš„å½±éŸ¿ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 05:00:55 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µçš„å½±éŸ¿ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 05:00:55 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:00:55 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:08:02 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:08:02 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:08:02 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:08:02 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:08:02 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:08:02 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:08:02 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:08:02 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:08:05 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:08:06 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:08:06 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:08:06 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:08:06 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:08:06 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:08:06 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:08:06 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:08:06 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:08:06 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:08:06 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:08:06 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:08:07 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:08:07 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:08:07 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:08:07 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:08:07 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:08:07 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:08:07 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:08:07 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:08:07 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:08:07 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:08:07 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:08:07 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:08:07 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:08:07 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:08:07 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:08:07 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:08:07 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:08:07 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:08:07 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:08:07 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:08:07 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:08:07 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 05:08:07 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:08:07 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 05:08:07 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 05:08:07 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 05:08:07 - s_cbr.backend.main - INFO - 
2025-11-04 05:08:07 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 05:08:07 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 05:08:07 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 05:08:07 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 05:08:07 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 05:08:07 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 05:08:07 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 05:08:07 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:08:08 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 05:08:08 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 05:08:08 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 05:08:08 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:08:14 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:08:14 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:08:14 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:08:14 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:08:14 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:08:14 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:08:14 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:08:14 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:08:17 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:08:17 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:08:17 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:08:17 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:08:17 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:08:17 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:08:17 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:08:17 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:08:17 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:08:18 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:08:18 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:08:18 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:08:18 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:08:18 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:08:18 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:08:18 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:08:18 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:08:18 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:08:18 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:08:18 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:08:18 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:08:18 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:08:18 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:08:18 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:08:18 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:08:18 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:08:19 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:08:19 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:08:19 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:08:19 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:08:19 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:08:19 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:08:19 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:08:19 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 05:08:19 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:08:19 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 05:08:19 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 05:08:19 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 05:08:19 - s_cbr.backend.main - INFO - 
2025-11-04 05:08:19 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 05:08:19 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 05:08:19 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 05:08:19 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 05:08:19 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 05:08:19 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 05:08:19 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 05:08:19 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:08:19 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 05:08:20 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 05:08:20 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 05:08:20 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:08:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:08:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:08:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:08:33 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:08:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:08:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:08:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:08:33 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:08:36 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:08:36 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:08:36 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:08:36 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:08:36 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:08:36 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:08:36 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:08:36 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:08:36 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:08:37 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:08:37 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:08:37 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:08:37 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:08:37 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:08:37 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:08:37 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:08:37 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:08:37 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:08:37 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:08:37 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:08:37 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:08:37 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:08:38 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:08:38 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:08:38 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:08:38 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:08:38 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:08:38 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:08:38 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:08:38 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:08:38 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:08:38 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:08:38 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:08:38 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 05:08:38 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:08:38 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 05:08:38 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 05:08:38 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 05:08:38 - s_cbr.backend.main - INFO - 
2025-11-04 05:08:38 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 05:08:38 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 05:08:38 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 05:08:38 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 05:08:38 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 05:08:38 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 05:08:38 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 05:08:38 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:08:38 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 05:08:39 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 05:08:39 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 05:08:39 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:09:18 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:09:18 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:09:18 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:09:18 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:09:18 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:09:18 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:09:18 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:09:18 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:09:21 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:09:21 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:09:21 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:09:21 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:09:21 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:09:21 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:09:21 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:09:21 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:09:21 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:09:22 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:09:22 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:09:22 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:09:23 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:09:23 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:09:23 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:09:23 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:09:23 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:09:23 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:09:23 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:09:23 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:09:23 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:09:23 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:09:23 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:09:23 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:09:23 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:09:23 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:09:23 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:09:23 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:09:23 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:09:23 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:09:23 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:09:23 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:09:23 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:09:23 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 05:09:23 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:09:23 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 05:09:23 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 05:09:23 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 05:09:23 - s_cbr.backend.main - INFO - 
2025-11-04 05:09:23 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 05:09:23 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 05:09:23 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 05:09:23 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 05:09:23 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 05:09:23 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 05:09:23 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 05:09:23 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:09:24 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 05:09:24 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 05:09:24 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 05:09:24 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:12:10 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:12:10 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:12:10 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:12:10 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:12:10 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:12:10 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:12:10 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:12:10 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:12:13 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:12:13 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:12:13 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:12:13 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:12:13 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:12:13 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:12:13 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:12:13 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:12:13 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:12:13 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:12:13 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:12:13 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:12:14 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:12:14 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:12:14 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:12:14 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:12:14 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:12:14 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:12:14 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:12:14 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:12:14 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:12:14 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:12:14 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:12:14 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:12:14 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:12:14 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:12:14 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:12:14 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:12:14 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:12:14 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:12:14 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:12:14 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:12:14 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:12:14 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 05:12:14 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:12:14 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 05:12:14 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 05:12:14 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 05:12:14 - s_cbr.backend.main - INFO - 
2025-11-04 05:12:14 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 05:12:14 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 05:12:14 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 05:12:14 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 05:12:14 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 05:12:14 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 05:12:14 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 05:12:14 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:12:15 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 05:12:15 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 05:12:15 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 05:12:15 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:14:47 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:14:48 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:14:48 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:14:48 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:14:48 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:14:48 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:14:48 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:14:48 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:14:51 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:14:51 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:14:51 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:14:51 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:14:51 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:14:51 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:14:51 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:14:51 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:14:51 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:14:51 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:14:51 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:14:51 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:14:52 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:14:52 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:14:52 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:14:52 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:14:52 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:14:52 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:14:52 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:14:52 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:14:52 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:14:52 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:14:52 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:14:52 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:14:52 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:14:52 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:14:52 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:14:52 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:14:52 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:14:52 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:14:52 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:14:52 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:14:52 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:14:52 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:14:53 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:14:56 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:14:56 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ã€èˆŒæ·¡å’Œè„ˆç´°å¼±"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰"
}
2025-11-04 05:14:56 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ã€èˆŒæ·¡å’Œè„ˆç´°å¼±"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰"
}
2025-11-04 05:14:57 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:14:58 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:15:31 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:15:35 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:15:35 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ã€èˆŒæ·¡å’Œè„ˆç´°å¼±ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "é£Ÿæ¬²ä¸æŒ¯", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
```
2025-11-04 05:15:35 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ã€èˆŒæ·¡å’Œè„ˆç´°å¼±ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "é£Ÿæ¬²ä¸æŒ¯", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
```
2025-11-04 05:15:36 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:15:36 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:16:08 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:16:12 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:16:12 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "æ™šä¸Šå®¹æ˜“é†’ä¾†",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 05:16:12 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "æ™šä¸Šå®¹æ˜“é†’ä¾†",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 05:16:13 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:16:13 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:16:48 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:16:51 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:16:51 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„èƒƒéƒ¨ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 05:16:51 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„èƒƒéƒ¨ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 05:16:53 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:16:53 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:17:03 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:17:07 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:17:07 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼Œå¦‚èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’è®ŠåŒ–å°ç—‡ç‹€çš„å½±éŸ¿ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ"
    ],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 05:17:07 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼Œå¦‚èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’è®ŠåŒ–å°ç—‡ç‹€çš„å½±éŸ¿ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ"
    ],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 05:17:08 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:17:08 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:17:22 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:17:27 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:17:27 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µçš„å½±éŸ¿ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 05:17:27 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µçš„å½±éŸ¿ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 05:17:28 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:17:28 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:24:20 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:24:20 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:24:20 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:24:20 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:24:20 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:24:20 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:24:20 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:24:20 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:24:23 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:24:23 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:24:23 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:24:23 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:24:23 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:24:23 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:24:23 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:24:23 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:24:23 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:24:23 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:24:23 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:24:23 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:24:24 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:24:24 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:24:24 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:24:24 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:24:24 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:24:24 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:24:24 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:24:24 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:24:24 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:24:24 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:24:24 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:24:24 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:24:24 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:24:24 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:24:24 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:24:24 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:24:24 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:24:24 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:24:24 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:24:24 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:24:24 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:24:25 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 05:24:25 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:24:25 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 05:24:25 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 05:24:25 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 05:24:25 - s_cbr.backend.main - INFO - 
2025-11-04 05:24:25 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 05:24:25 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 05:24:25 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 05:24:25 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 05:24:25 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 05:24:25 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 05:24:25 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 05:24:25 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:24:25 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 05:24:26 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 05:24:26 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 05:24:26 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:24:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:24:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:24:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:24:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:24:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:24:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:24:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:24:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:24:34 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:24:34 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:24:34 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:24:34 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:24:34 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:24:34 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:24:34 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:24:34 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:24:34 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:24:34 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:24:34 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:24:34 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:24:35 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:24:35 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:24:35 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:24:35 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:24:35 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:24:35 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:24:35 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:24:35 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:24:35 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:24:35 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:24:35 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:24:35 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:24:35 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:24:35 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:24:35 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:24:35 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:24:35 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:24:35 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:24:35 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:24:35 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:24:35 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:24:35 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 05:24:35 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:24:35 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 05:24:35 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 05:24:35 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 05:24:35 - s_cbr.backend.main - INFO - 
2025-11-04 05:24:35 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 05:24:35 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 05:24:35 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 05:24:35 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 05:24:35 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 05:24:35 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 05:24:35 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 05:24:35 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:24:36 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 05:24:37 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 05:24:37 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 05:24:37 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:26:01 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:26:01 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:26:01 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:26:01 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:26:01 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:26:01 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:26:01 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:26:01 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:26:04 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:26:04 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:26:04 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:26:04 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:26:04 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:26:04 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:26:04 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:26:04 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:26:04 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:26:05 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:26:05 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:26:05 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:26:05 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:26:05 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:26:05 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:26:05 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:26:05 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:26:05 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:26:05 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:26:05 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:26:05 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:26:05 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:26:06 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:26:06 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:26:06 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:26:06 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:26:06 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:26:06 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:26:06 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:26:06 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:26:06 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:26:06 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:26:06 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:26:06 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:26:06 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:26:10 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:26:10 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼Œä¸¦æåŠèˆŒè„ˆç‰¹å¾µï¼Œéœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†å»ºè­°"
}
2025-11-04 05:26:10 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼Œä¸¦æåŠèˆŒè„ˆç‰¹å¾µï¼Œéœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†å»ºè­°"
}
2025-11-04 05:26:11 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:26:11 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:26:46 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:26:50 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:26:50 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œä¸”æåŠéœ€è¦çœ‹ä¸­é†«èª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 05:26:50 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œä¸”æåŠéœ€è¦çœ‹ä¸­é†«èª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 05:26:51 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:26:51 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:27:29 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:27:33 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:27:33 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
}
2025-11-04 05:27:33 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
}
2025-11-04 05:27:35 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:27:35 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:28:12 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:28:15 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:28:15 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡å˜—è©¦æ ¹æ“šæ‚¨çš„æè¿°é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 05:28:15 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡å˜—è©¦æ ¹æ“šæ‚¨çš„æè¿°é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 05:28:17 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:28:17 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:28:27 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:28:31 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:28:31 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ„Ÿè¬æ‚¨çš„æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 05:28:31 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ„Ÿè¬æ‚¨çš„æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 05:28:33 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:28:33 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:28:44 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:28:48 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:28:48 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒè±¡ã€è„ˆè±¡å’Œä¸»è¨´ç—‡ç‹€ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["èƒƒè„˜è„¹ç—›", "å—³æ°£", "æ—©é£½", "å£è‹¦"],
    "tongue_pulse_terms": ["èˆŒç´…", "è‹”é»ƒè†©", "è„ˆå¼¦æ»‘"],
    "zangfu_terms": [],
    "other_terms": ["æƒ…ç·’ç·Šå¼µ"],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
```
2025-11-04 05:28:48 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒè±¡ã€è„ˆè±¡å’Œä¸»è¨´ç—‡ç‹€ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["èƒƒè„˜è„¹ç—›", "å—³æ°£", "æ—©é£½", "å£è‹¦"],
    "tongue_pulse_terms": ["èˆŒç´…", "è‹”é»ƒè†©", "è„ˆå¼¦æ»‘"],
    "zangfu_terms": [],
    "other_terms": ["æƒ…ç·’ç·Šå¼µ"],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
```
2025-11-04 05:28:49 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:28:49 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:36:05 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:36:05 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:36:05 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:36:05 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:36:05 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:36:05 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:36:05 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:36:05 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:36:08 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:36:08 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:36:08 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:08 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:08 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:08 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:36:08 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:36:08 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:36:08 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:08 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:36:08 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:36:08 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:09 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:36:09 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:36:09 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:36:09 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:36:09 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:36:09 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:36:09 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:36:09 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:36:09 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:36:09 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:36:09 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:36:09 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:36:09 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:36:09 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:36:10 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:36:10 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:10 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:36:10 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:36:10 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:36:10 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:10 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:36:10 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 05:36:10 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:36:10 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 05:36:10 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 05:36:10 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 05:36:10 - s_cbr.backend.main - INFO - 
2025-11-04 05:36:10 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 05:36:10 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 05:36:10 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 05:36:10 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 05:36:10 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 05:36:10 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 05:36:10 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 05:36:10 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:36:10 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 05:36:11 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 05:36:11 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 05:36:11 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:13 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:36:13 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:36:13 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:36:13 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:36:13 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:36:13 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:36:13 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:36:13 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:36:16 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:36:16 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:36:16 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:16 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:16 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:16 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:36:16 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:36:16 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:36:16 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:16 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:36:16 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:36:16 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:17 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:36:17 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:36:17 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:36:17 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:36:17 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:36:17 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:36:17 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:36:17 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:36:17 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:36:17 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:36:17 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:36:17 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:36:17 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:36:17 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:36:17 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:36:17 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:17 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:36:17 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:36:17 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:36:17 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:17 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:36:17 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 05:36:17 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:36:17 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 05:36:17 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 05:36:17 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 05:36:17 - s_cbr.backend.main - INFO - 
2025-11-04 05:36:17 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 05:36:17 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 05:36:17 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 05:36:17 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 05:36:17 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 05:36:17 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 05:36:17 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 05:36:17 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:36:18 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 05:36:18 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 05:36:19 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 05:36:19 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:21 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:36:21 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:36:21 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:36:21 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:36:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:36:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:36:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:36:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:36:24 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:36:24 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:36:24 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:24 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:24 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:24 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:36:24 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:36:24 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:36:24 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:24 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:36:24 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:36:24 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:25 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:36:25 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:36:25 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:36:25 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:36:25 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:36:25 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:36:25 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:36:25 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:36:25 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:36:25 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:36:25 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:36:25 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:36:25 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:36:25 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:36:25 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:36:25 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:25 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:36:25 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:36:25 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:36:25 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:25 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:36:25 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 05:36:25 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:36:25 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 05:36:25 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 05:36:25 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 05:36:25 - s_cbr.backend.main - INFO - 
2025-11-04 05:36:25 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 05:36:25 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 05:36:25 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 05:36:25 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 05:36:25 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 05:36:25 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 05:36:25 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 05:36:25 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:36:26 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 05:36:26 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 05:36:26 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 05:36:26 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:32 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:36:32 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:36:32 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:36:32 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:36:32 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:36:32 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:36:32 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:36:32 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:36:35 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:36:35 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:36:35 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:35 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:35 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:35 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:36:35 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:36:35 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:36:35 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:35 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:36:35 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:36:35 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:36 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:36:36 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:36:36 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:36:36 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:36:36 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:36:36 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:36:36 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:36:36 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:36:36 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:36:36 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:36:36 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:36:36 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:36:36 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:36:36 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:36:37 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:36:37 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:37 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:36:37 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:36:37 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:36:37 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:37 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:36:37 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 05:36:37 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:36:37 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 05:36:37 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 05:36:37 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 05:36:37 - s_cbr.backend.main - INFO - 
2025-11-04 05:36:37 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 05:36:37 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 05:36:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 05:36:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 05:36:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 05:36:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 05:36:37 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 05:36:37 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:36:37 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 05:36:38 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 05:36:38 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 05:36:38 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:44 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:36:44 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:36:45 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:36:45 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:36:45 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:36:45 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:36:45 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:36:45 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:36:47 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:36:47 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:36:47 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:47 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:47 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:47 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:36:47 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:36:47 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:36:47 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:48 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:36:48 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:36:48 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:36:48 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:36:48 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:36:48 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:36:48 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:36:48 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:36:48 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:36:48 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:36:48 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:36:48 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:36:48 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:36:49 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:36:49 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:36:49 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:36:49 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:36:49 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:36:49 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:49 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:36:49 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:36:49 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:36:49 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:36:49 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:36:49 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 05:36:49 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:36:49 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 05:36:49 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 05:36:49 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 05:36:49 - s_cbr.backend.main - INFO - 
2025-11-04 05:36:49 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 05:36:49 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 05:36:49 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 05:36:49 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 05:36:49 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 05:36:49 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 05:36:49 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 05:36:49 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:36:50 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 05:36:50 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 05:36:50 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 05:36:50 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:37:38 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:37:38 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:37:38 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:37:38 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:37:38 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:37:38 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:37:38 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:37:38 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:37:42 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:37:42 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:37:42 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:37:42 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:37:42 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:37:42 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:37:42 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:37:42 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:37:42 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:37:42 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:37:42 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:37:42 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:37:43 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:37:43 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:37:43 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:37:43 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:37:43 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:37:43 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:37:43 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:37:43 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:37:43 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:37:43 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:37:43 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:37:43 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:37:43 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:37:43 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:37:43 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:37:43 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:37:43 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:37:43 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:37:43 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:37:43 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:37:43 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:37:43 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:37:43 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:37:47 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:37:47 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 05:37:47 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 05:37:48 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:37:48 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:38:31 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å…¥éé•·ï¼Œå¾ 3152 æˆªæ–·è‡³ 3000 å­—ç¬¦
2025-11-04 05:38:39 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:38:42 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:38:42 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼ŒåŒæ™‚æåˆ°äº†èˆŒè„ˆç‰¹å¾µï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¾¨è­‰åˆ†æã€‚"
}
2025-11-04 05:38:42 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼ŒåŒæ™‚æåˆ°äº†èˆŒè„ˆç‰¹å¾µï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¾¨è­‰åˆ†æã€‚"
}
2025-11-04 05:38:44 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:38:44 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:39:06 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å…¥éé•·ï¼Œå¾ 3029 æˆªæ–·è‡³ 3000 å­—ç¬¦
2025-11-04 05:39:28 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å…¥éé•·ï¼Œå¾ 3185 æˆªæ–·è‡³ 3000 å­—ç¬¦
2025-11-04 05:39:35 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:39:39 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:39:39 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "åƒä¸å¤ªä¸‹", "å°ä¾¿æ¸…é•·", "æ€•å†·", "ç™½å¸¶é‡å¤š", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
```
2025-11-04 05:39:39 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "åƒä¸å¤ªä¸‹", "å°ä¾¿æ¸…é•·", "æ€•å†·", "ç™½å¸¶é‡å¤š", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
```
2025-11-04 05:39:41 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:39:41 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:40:04 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:40:07 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:40:07 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„èƒƒéƒ¨ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œ"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 05:40:07 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„èƒƒéƒ¨ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œ"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 05:40:08 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:40:09 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:40:30 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:40:34 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:40:34 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 05:40:34 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 05:40:34 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:40:35 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:40:57 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:41:01 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:41:01 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒè±¡ã€è„ˆè±¡å’Œä¸»è¨´ç—‡ç‹€ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["èƒƒè„˜è„¹ç—›", "å—³æ°£", "æ—©é£½", "å£è‹¦"],
    "tongue_pulse_terms": ["èˆŒç´…", "è‹”é»ƒè†©", "è„ˆå¼¦æ»‘"],
    "zangfu_terms": [],
    "other_terms": ["æƒ…ç·’ç·Šå¼µ"],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
```
2025-11-04 05:41:01 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒè±¡ã€è„ˆè±¡å’Œä¸»è¨´ç—‡ç‹€ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["èƒƒè„˜è„¹ç—›", "å—³æ°£", "æ—©é£½", "å£è‹¦"],
    "tongue_pulse_terms": ["èˆŒç´…", "è‹”é»ƒè†©", "è„ˆå¼¦æ»‘"],
    "zangfu_terms": [],
    "other_terms": ["æƒ…ç·’ç·Šå¼µ"],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
```
2025-11-04 05:41:01 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:41:01 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:51:42 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:51:42 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:51:42 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:51:42 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:51:42 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:51:42 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:51:42 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:51:42 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:51:45 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:51:45 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:51:45 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:51:45 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:51:45 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:51:45 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:51:45 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:51:45 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:51:45 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:51:46 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:51:46 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:51:46 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:51:46 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:51:46 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:51:46 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:51:46 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:51:46 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:51:46 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:51:46 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:51:46 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:51:46 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:51:46 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:51:47 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:51:47 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:51:47 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:51:47 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:51:47 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:51:47 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:51:47 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:51:47 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:51:47 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:51:47 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:51:47 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:51:47 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 05:51:47 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:51:47 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 05:51:47 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 05:51:47 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 05:51:47 - s_cbr.backend.main - INFO - 
2025-11-04 05:51:47 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 05:51:47 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 05:51:47 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 05:51:47 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 05:51:47 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 05:51:47 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 05:51:47 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 05:51:47 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 05:51:48 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 05:51:48 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 05:51:48 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 05:51:48 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:51:54 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 05:51:54 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 05:51:55 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 05:51:55 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 05:51:55 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 05:51:55 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 05:51:55 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 05:51:55 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:51:58 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:51:58 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 05:51:58 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:51:58 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:51:58 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:51:58 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 05:51:58 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:51:58 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:51:58 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:51:58 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:51:58 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:51:58 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 05:51:59 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 05:51:59 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 05:51:59 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 05:51:59 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 05:51:59 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 05:51:59 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 05:51:59 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 05:51:59 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 05:51:59 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 05:51:59 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 05:51:59 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 05:51:59 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 05:51:59 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 05:51:59 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 05:51:59 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:51:59 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 05:51:59 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 05:51:59 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 05:51:59 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 05:51:59 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 05:51:59 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 05:51:59 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 05:51:59 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:52:03 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:52:03 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†å»ºè­°ã€‚"
}
2025-11-04 05:52:03 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†å»ºè­°ã€‚"
}
2025-11-04 05:52:04 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:52:04 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:52:25 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å…¥éé•·ï¼Œå¾ 3006 æˆªæ–·è‡³ 3000 å­—ç¬¦
2025-11-04 05:52:48 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å…¥éé•·ï¼Œå¾ 3176 æˆªæ–·è‡³ 3000 å­—ç¬¦
2025-11-04 05:52:55 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:52:59 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:52:59 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸ä¸‹ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸ä¸‹",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 05:52:59 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸ä¸‹ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸ä¸‹",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 05:53:00 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:53:00 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:53:51 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:53:55 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:53:55 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "åƒä¸å¤ªä¸‹", "å°ä¾¿æ¸…é•·", "æ€•å†·", "ç™½å¸¶é‡å¤š", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†å»ºè­°ã€‚"
}
```
2025-11-04 05:53:55 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "åƒä¸å¤ªä¸‹", "å°ä¾¿æ¸…é•·", "æ€•å†·", "ç™½å¸¶é‡å¤š", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†å»ºè­°ã€‚"
}
```
2025-11-04 05:53:56 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:53:56 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:54:19 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:54:22 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:54:22 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«çš„æ¶ˆåŒ–ç³»çµ±ç–¾ç—…ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ"
    ],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€æè¿°å·²ç¶“æ”¶é›†ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 05:54:22 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«çš„æ¶ˆåŒ–ç³»çµ±ç–¾ç—…ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ"
    ],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€æè¿°å·²ç¶“æ”¶é›†ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 05:54:24 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:54:24 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:54:46 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:54:49 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:54:49 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ„Ÿè¬æ‚¨çš„æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 05:54:49 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ„Ÿè¬æ‚¨çš„æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 05:54:51 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:54:51 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 05:55:13 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 05:55:17 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 05:55:17 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒè±¡ã€è„ˆè±¡å’Œä¸»è¨´ç—‡ç‹€ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["èƒƒè„˜è„¹ç—›", "å—³æ°£", "æ—©é£½", "å£è‹¦"],
    "tongue_pulse_terms": ["èˆŒç´…", "è‹”é»ƒè†©", "è„ˆå¼¦æ»‘"],
    "zangfu_terms": [],
    "other_terms": ["æƒ…ç·’ç·Šå¼µ"],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œæ­£åœ¨é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
```
2025-11-04 05:55:17 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒè±¡ã€è„ˆè±¡å’Œä¸»è¨´ç—‡ç‹€ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["èƒƒè„˜è„¹ç—›", "å—³æ°£", "æ—©é£½", "å£è‹¦"],
    "tongue_pulse_terms": ["èˆŒç´…", "è‹”é»ƒè†©", "è„ˆå¼¦æ»‘"],
    "zangfu_terms": [],
    "other_terms": ["æƒ…ç·’ç·Šå¼µ"],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œæ­£åœ¨é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
```
2025-11-04 05:55:18 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 05:55:18 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 06:08:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 06:08:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 06:08:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 06:08:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 06:08:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 06:08:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 06:08:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 06:08:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 06:08:09 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 06:08:09 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 06:08:09 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 06:08:09 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 06:08:09 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 06:08:09 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 06:08:09 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 06:08:09 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 06:08:09 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 06:08:10 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 06:08:10 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 06:08:10 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 06:08:11 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 06:08:11 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 06:08:11 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 06:08:11 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 06:08:11 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 06:08:11 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 06:08:11 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 06:08:11 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 06:08:11 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 06:08:11 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 06:08:11 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 06:08:11 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 06:08:11 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 06:08:11 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 06:08:11 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 06:08:11 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 06:08:11 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 06:08:11 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 06:08:11 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 06:08:11 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 06:08:11 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 06:08:11 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 06:08:11 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 06:08:11 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 06:08:11 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 06:08:11 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 06:08:11 - s_cbr.backend.main - INFO - 
2025-11-04 06:08:11 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 06:08:11 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 06:08:11 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 06:08:11 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 06:08:11 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 06:08:11 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 06:08:11 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 06:08:11 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 06:08:12 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 06:08:12 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 06:08:12 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 06:08:12 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 06:08:32 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 06:08:32 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 06:08:32 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 06:08:32 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 06:08:32 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 06:08:32 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 06:08:32 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 06:08:32 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 06:08:35 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 06:08:35 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 06:08:35 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 06:08:35 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 06:08:35 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 06:08:35 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 06:08:35 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 06:08:35 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 06:08:35 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 06:08:35 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 06:08:35 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 06:08:35 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 06:08:36 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 06:08:36 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 06:08:36 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 06:08:36 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 06:08:36 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 06:08:36 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 06:08:36 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 06:08:36 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 06:08:36 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 06:08:36 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 06:08:36 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 06:08:36 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 06:08:36 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 06:08:36 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 06:08:37 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 06:08:37 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 06:08:37 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 06:08:37 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 06:08:37 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 06:08:37 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 06:08:37 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 06:08:37 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 06:08:37 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 06:08:37 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 06:08:37 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 06:08:37 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 06:08:37 - s_cbr.backend.main - INFO - 
2025-11-04 06:08:37 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 06:08:37 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 06:08:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 06:08:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 06:08:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 06:08:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 06:08:37 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 06:08:37 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 06:08:37 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 06:08:38 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 06:08:38 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 06:08:38 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 06:08:40 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 06:08:40 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 06:08:40 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 06:08:40 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 06:08:40 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 06:08:40 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 06:08:40 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 06:08:40 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 06:08:43 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 06:08:43 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 06:08:43 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 06:08:43 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 06:08:43 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 06:08:43 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 06:08:43 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 06:08:43 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 06:08:43 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 06:08:43 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 06:08:43 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 06:08:43 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 06:08:44 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 06:08:44 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 06:08:44 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 06:08:44 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 06:08:44 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 06:08:44 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 06:08:44 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 06:08:44 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 06:08:44 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 06:08:44 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 06:08:44 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 06:08:44 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 06:08:44 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 06:08:44 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 06:08:44 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 06:08:44 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 06:08:44 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 06:08:44 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 06:08:44 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 06:08:44 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 06:08:44 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 06:08:44 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 06:08:44 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 06:08:44 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 06:08:44 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 06:08:44 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 06:08:44 - s_cbr.backend.main - INFO - 
2025-11-04 06:08:44 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 06:08:44 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 06:08:44 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 06:08:44 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 06:08:44 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 06:08:44 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 06:08:44 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 06:08:44 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 06:08:45 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 06:08:45 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 06:08:45 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 06:08:45 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 06:09:39 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 06:09:39 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 06:09:39 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 06:09:39 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 06:09:39 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 06:09:39 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 06:09:39 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 06:09:39 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 06:09:43 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 06:09:43 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 06:09:43 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 06:09:43 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 06:09:43 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 06:09:43 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 06:09:43 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 06:09:43 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 06:09:43 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 06:09:43 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 06:09:43 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 06:09:43 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 06:09:44 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 06:09:44 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 06:09:44 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 06:09:44 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 06:09:44 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 06:09:44 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 06:09:44 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 06:09:44 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 06:09:44 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 06:09:44 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 06:09:44 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 06:09:44 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 06:09:44 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 06:09:44 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 06:09:44 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 06:09:44 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 06:09:44 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 06:09:44 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 06:09:44 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 06:09:44 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 06:09:44 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 06:09:44 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 06:09:45 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 06:09:49 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 06:09:49 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 06:09:49 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 06:09:50 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 06:09:50 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 06:10:43 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 06:10:47 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 06:10:47 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸ä¸‹ç­‰ç—‡ç‹€ï¼ŒåŒæ™‚æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "åƒä¸ä¸‹", "æ™šä¸Šå®¹æ˜“é†’ä¾†", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
```
2025-11-04 06:10:47 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸ä¸‹ç­‰ç—‡ç‹€ï¼ŒåŒæ™‚æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "åƒä¸ä¸‹", "æ™šä¸Šå®¹æ˜“é†’ä¾†", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
```
2025-11-04 06:10:47 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 06:10:47 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 06:11:40 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 06:11:45 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 06:11:45 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œéœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
}
2025-11-04 06:11:45 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œéœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
}
2025-11-04 06:11:46 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 06:11:46 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 06:12:37 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 06:12:40 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 06:12:40 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 06:12:40 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 06:12:42 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 06:12:42 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 06:13:04 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 06:13:08 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 06:13:08 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼Œå¦‚èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œèˆ‡ä¸­é†«çš„è¨ºæ–·å’Œè¾¨è­‰æœ‰é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["èƒƒè„˜è„¹ç—›", "å—³æ°£", "æ—©é£½", "æƒ…ç·’ç·Šå¼µ", "å£è‹¦"],
    "tongue_pulse_terms": [],
    "zangfu_terms": ["èƒƒ"],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¾¨è­‰åˆ†æã€‚"
}
```
2025-11-04 06:13:08 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼Œå¦‚èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œèˆ‡ä¸­é†«çš„è¨ºæ–·å’Œè¾¨è­‰æœ‰é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["èƒƒè„˜è„¹ç—›", "å—³æ°£", "æ—©é£½", "æƒ…ç·’ç·Šå¼µ", "å£è‹¦"],
    "tongue_pulse_terms": [],
    "zangfu_terms": ["èƒƒ"],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¾¨è­‰åˆ†æã€‚"
}
```
2025-11-04 06:13:09 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 06:13:09 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 06:13:31 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 06:13:36 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 06:13:36 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œèˆ‡ä¸­é†«çš„è­‰å‹åˆ†æç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦",
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 06:13:36 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œèˆ‡ä¸­é†«çš„è­‰å‹åˆ†æç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦",
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 06:13:37 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 06:13:37 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 09:55:46 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 09:55:46 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 09:55:46 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 09:55:46 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 09:55:46 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 09:55:46 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 09:55:46 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 09:55:46 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 09:55:50 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 09:55:50 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 09:55:50 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 09:55:50 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 09:55:50 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 09:55:50 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 09:55:50 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 09:55:50 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 09:55:50 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 09:55:50 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 09:55:50 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 09:55:50 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 09:55:51 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 09:55:51 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 09:55:51 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 09:55:51 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 09:55:51 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 09:55:51 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 09:55:51 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 09:55:51 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 09:55:51 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 09:55:51 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 09:55:51 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 09:55:51 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 09:55:51 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 09:55:51 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 09:55:51 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 09:55:51 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 09:55:51 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 09:55:51 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 09:55:51 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 09:55:51 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 09:55:51 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 09:55:51 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 09:55:51 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 09:55:51 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 09:55:51 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 09:55:51 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 09:55:51 - s_cbr.backend.main - INFO - 
2025-11-04 09:55:51 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 09:55:51 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 09:55:51 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 09:55:51 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 09:55:51 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 09:55:51 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 09:55:51 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 09:55:51 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 09:55:52 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 09:55:52 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 09:55:52 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 09:55:52 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 09:55:54 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 09:55:54 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 09:55:54 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 09:55:54 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 09:55:54 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 09:55:54 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 09:55:54 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 09:55:54 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 09:55:57 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 09:55:57 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 09:55:58 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 09:55:58 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 09:55:58 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 09:55:58 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 09:55:58 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 09:55:58 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 09:55:58 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 09:55:58 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 09:55:58 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 09:55:58 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 09:55:59 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 09:55:59 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 09:55:59 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 09:55:59 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 09:55:59 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 09:55:59 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 09:55:59 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 09:55:59 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 09:55:59 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 09:55:59 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 09:55:59 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 09:55:59 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 09:55:59 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 09:55:59 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 09:55:59 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 09:55:59 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 09:55:59 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 09:55:59 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 09:55:59 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 09:55:59 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 09:55:59 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 09:55:59 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 09:55:59 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 09:55:59 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 09:55:59 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 09:55:59 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 09:55:59 - s_cbr.backend.main - INFO - 
2025-11-04 09:55:59 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 09:55:59 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 09:55:59 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 09:55:59 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 09:55:59 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 09:55:59 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 09:55:59 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 09:55:59 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 09:56:00 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 09:56:01 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 09:56:01 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 09:56:01 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 09:58:56 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 09:58:56 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 09:58:56 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 09:58:56 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 09:58:56 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 09:58:56 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 09:58:56 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 09:58:56 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 09:59:01 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 09:59:01 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 09:59:01 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 09:59:01 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 09:59:01 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 09:59:01 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 09:59:01 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 09:59:01 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 09:59:01 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 09:59:01 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 09:59:01 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 09:59:01 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 09:59:02 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 09:59:02 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 09:59:02 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 09:59:02 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 09:59:02 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 09:59:02 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 09:59:02 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 09:59:02 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 09:59:02 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 09:59:02 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 09:59:03 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 09:59:03 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 09:59:03 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 09:59:03 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 09:59:03 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 09:59:03 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 09:59:03 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 09:59:03 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 09:59:03 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 09:59:03 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 09:59:03 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 09:59:03 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 09:59:03 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 09:59:09 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 09:59:09 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©"
}
2025-11-04 09:59:09 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©"
}
2025-11-04 09:59:10 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 09:59:10 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 09:59:10 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.98306394'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.98306394, '_attr_score': 0.0, '_final_score': 0.98306394}, {'_additional': {'distance': None, 'score': '0.9463664'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.9463664, '_attr_score': 0.0, '_final_score': 0.9463664}, {'_additional': {'distance': None, 'score': '0.86615515'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.86615515, '_attr_score': 0.0, '_final_score': 0.86615515}]
2025-11-04 09:59:10 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.98306394'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.98306394, '_attr_score': 0.0, '_final_score': 0.98306394}, {'_additional': {'distance': None, 'score': '0.9463664'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.9463664, '_attr_score': 0.0, '_final_score': 0.9463664}, {'_additional': {'distance': None, 'score': '0.86615515'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.86615515, '_attr_score': 0.0, '_final_score': 0.86615515}]
2025-11-04 10:00:03 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:00:07 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:00:07 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œä¸”æåŠéœ€è¦çœ‹ä¸­é†«èª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 10:00:07 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œä¸”æåŠéœ€è¦çœ‹ä¸­é†«èª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 10:00:09 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:00:09 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:00:09 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '1'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0}, {'_additional': {'distance': None, 'score': '0.7679415'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.7679415, '_attr_score': 0.0, '_final_score': 0.7679415}, {'_additional': {'distance': None, 'score': '0.6729221'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6729221, '_attr_score': 0.0, '_final_score': 0.6729221}]
2025-11-04 10:00:09 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '1'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0}, {'_additional': {'distance': None, 'score': '0.7679415'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.7679415, '_attr_score': 0.0, '_final_score': 0.7679415}, {'_additional': {'distance': None, 'score': '0.6729221'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6729221, '_attr_score': 0.0, '_final_score': 0.6729221}]
2025-11-04 10:01:02 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:01:07 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:01:07 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:01:07 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:01:07 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:01:07 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:01:07 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.84997916'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.84997916, '_attr_score': 0.0, '_final_score': 0.84997916}, {'_additional': {'distance': None, 'score': '0.6812105'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6812105, '_attr_score': 0.0, '_final_score': 0.6812105}, {'_additional': {'distance': None, 'score': '0.66008914'}, 'case_id': 'CASE_20251005211351_C309_a4c59017', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'ä¸å¯ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›', 'è¡€è™›', 'è™›è­‰', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹', 'è™›è­‰'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'è‰²æ·¡', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å¿ƒè„¾'], '_confidence': 0.66008914, '_attr_score': 0.0, '_final_score': 0.66008914}]
2025-11-04 10:01:07 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.84997916'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.84997916, '_attr_score': 0.0, '_final_score': 0.84997916}, {'_additional': {'distance': None, 'score': '0.6812105'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6812105, '_attr_score': 0.0, '_final_score': 0.6812105}, {'_additional': {'distance': None, 'score': '0.66008914'}, 'case_id': 'CASE_20251005211351_C309_a4c59017', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'ä¸å¯ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›', 'è¡€è™›', 'è™›è­‰', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹', 'è™›è­‰'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'è‰²æ·¡', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å¿ƒè„¾'], '_confidence': 0.66008914, '_attr_score': 0.0, '_final_score': 0.66008914}]
2025-11-04 10:01:47 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:01:50 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:01:50 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œ"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 10:01:50 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œ"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 10:01:51 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:01:51 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:01:51 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.4975184'}, 'case_id': 'CASE_20251005212258_G890_85162320', 'chief_complaint': 'ç™½å¸¶é‡å¤šè‰²é»ƒä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¸¶é‡', 'èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'æ²¹è†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶é™¤è‡­', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ½”', 'è†½ç€‰'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°', 'è†½ç€‰', 'è‚æ¹¯'], '_confidence': 0.4975184, '_attr_score': 0.0, '_final_score': 0.4975184}, {'_additional': {'distance': None, 'score': '0.43047488'}, 'case_id': 'CASE_20251005211411_P773_ac7de918', 'chief_complaint': 'ç¶“è¡Œé ­ç—›ä¸€å¹´', 'diagnosis': 'ç¶“è¡Œé ­ç—›ï¼ˆè‚é¬±æ°£æ»¯ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è‚æ°£é¬±çµ'], 'symptom_terms': ['é ­ç—›', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['åé»ƒ', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'ç–è‚ç†æ°£ï¼Œæ´»è¡€æ­¢ç—›', 'treatment_terms': [], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚é¬±', 'è‚æ°£é¬±çµ', 'ç–è‚ç†æ°£'], '_confidence': 0.43047488, '_attr_score': 0.0, '_final_score': 0.43047488}]
2025-11-04 10:01:51 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.43047488'}, 'case_id': 'CASE_20251005211411_P773_ac7de918', 'chief_complaint': 'ç¶“è¡Œé ­ç—›ä¸€å¹´', 'diagnosis': 'ç¶“è¡Œé ­ç—›ï¼ˆè‚é¬±æ°£æ»¯ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è‚æ°£é¬±çµ'], 'symptom_terms': ['é ­ç—›', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['åé»ƒ', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'ç–è‚ç†æ°£ï¼Œæ´»è¡€æ­¢ç—›', 'treatment_terms': [], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚é¬±', 'è‚æ°£é¬±çµ', 'ç–è‚ç†æ°£'], '_confidence': 0.43047488, '_attr_score': 0.0, '_final_score': 0.43047488}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.4975184'}, 'case_id': 'CASE_20251005212258_G890_85162320', 'chief_complaint': 'ç™½å¸¶é‡å¤šè‰²é»ƒä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¸¶é‡', 'èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'æ²¹è†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶é™¤è‡­', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ½”', 'è†½ç€‰'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°', 'è†½ç€‰', 'è‚æ¹¯'], '_confidence': 0.4975184, '_attr_score': 0.0, '_final_score': 0.4975184}]
2025-11-04 10:02:13 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:02:17 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:02:17 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:02:17 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:02:18 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:02:18 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:02:18 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.8363438'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.8363438, '_attr_score': 0.0, '_final_score': 0.8363438}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.45252484'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.45252484, '_attr_score': 0.0, '_final_score': 0.45252484}]
2025-11-04 10:02:18 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.8363438'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.8363438, '_attr_score': 0.0, '_final_score': 0.8363438}, {'_additional': {'distance': None, 'score': '0.45252484'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.45252484, '_attr_score': 0.0, '_final_score': 0.45252484}]
2025-11-04 10:02:41 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:02:45 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:02:45 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒè±¡ã€è„ˆè±¡å’Œä¸»è¨´ç—‡ç‹€ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œæ­£åœ¨é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:02:45 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒè±¡ã€è„ˆè±¡å’Œä¸»è¨´ç—‡ç‹€ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œæ­£åœ¨é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:02:47 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:02:47 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:02:47 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.89719427'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.89719427, '_attr_score': 0.0, '_final_score': 0.89719427}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.50715905'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.50715905, '_attr_score': 0.0, '_final_score': 0.50715905}]
2025-11-04 10:02:47 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.89719427'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.89719427, '_attr_score': 0.0, '_final_score': 0.89719427}, {'_additional': {'distance': None, 'score': '0.50715905'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.50715905, '_attr_score': 0.0, '_final_score': 0.50715905}]
2025-11-04 10:13:25 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 10:13:25 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 10:13:25 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 10:13:25 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 10:13:25 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 10:13:25 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 10:13:25 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 10:13:25 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:13:28 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:13:28 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:13:28 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:13:28 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:13:28 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:13:28 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 10:13:28 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 10:13:28 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 10:13:28 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:13:29 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:13:29 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 10:13:29 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:13:30 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 10:13:30 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 10:13:30 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 10:13:30 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 10:13:30 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 10:13:30 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 10:13:30 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 10:13:30 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 10:13:30 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 10:13:30 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 10:13:30 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 10:13:30 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 10:13:30 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 10:13:30 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 10:13:30 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:13:30 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 10:13:30 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 10:13:30 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 10:13:30 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 10:13:30 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:13:30 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 10:13:30 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 10:13:30 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 10:13:30 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 10:13:30 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 10:13:30 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 10:13:30 - s_cbr.backend.main - INFO - 
2025-11-04 10:13:30 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 10:13:30 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 10:13:30 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 10:13:30 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 10:13:30 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 10:13:30 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 10:13:30 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 10:13:30 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 10:13:31 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 10:13:31 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 10:13:31 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 10:13:31 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:14:04 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 10:14:04 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 10:14:04 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 10:14:04 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 10:14:04 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 10:14:04 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 10:14:04 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 10:14:04 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:14:07 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:14:07 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:14:07 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:14:07 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:14:07 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:14:07 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 10:14:07 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 10:14:07 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 10:14:07 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:14:08 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:14:08 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 10:14:08 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:14:09 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 10:14:09 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 10:14:09 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 10:14:09 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 10:14:09 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 10:14:09 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 10:14:09 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 10:14:09 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 10:14:09 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 10:14:09 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 10:14:09 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 10:14:09 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 10:14:09 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 10:14:09 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 10:14:09 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:14:09 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 10:14:09 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 10:14:09 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 10:14:09 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 10:14:09 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:14:09 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 10:14:09 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 10:14:09 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:14:13 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:14:13 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼Œä¸¦æåŠèˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©"
}
2025-11-04 10:14:13 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼Œä¸¦æåŠèˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©"
}
2025-11-04 10:14:14 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:14:15 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:14:15 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.77188754'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.77188754, '_attr_score': 0.0, '_final_score': 0.77188754}, {'_additional': {'distance': None, 'score': '0.7345238'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.7345238, '_attr_score': 0.0, '_final_score': 0.7345238}, {'_additional': {'distance': None, 'score': '0.6577592'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6577592, '_attr_score': 0.0, '_final_score': 0.6577592}]
2025-11-04 10:14:15 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.77188754'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.77188754, '_attr_score': 0.0, '_final_score': 0.77188754}, {'_additional': {'distance': None, 'score': '0.7345238'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.7345238, '_attr_score': 0.0, '_final_score': 0.7345238}, {'_additional': {'distance': None, 'score': '0.6577592'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6577592, '_attr_score': 0.0, '_final_score': 0.6577592}]
2025-11-04 10:15:07 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:15:11 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:15:11 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æ™šä¸Šå®¹æ˜“é†’ä¾†"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:15:11 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æ™šä¸Šå®¹æ˜“é†’ä¾†"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:15:12 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:15:12 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:15:12 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.95597667'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.95597667, '_attr_score': 0.0, '_final_score': 0.95597667}, {'_additional': {'distance': None, 'score': '0.8048727'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.8048727, '_attr_score': 0.0, '_final_score': 0.8048727}, {'_additional': {'distance': None, 'score': '0.66322637'}, 'case_id': 'CASE_20251005212221_A678_eac69714', 'chief_complaint': 'èƒ¸æ‚¶å¿ƒæ‚¸ä¸‰é€±', 'diagnosis': 'å¿ƒæ‚¸', 'pulse_terms': ['æƒ…ç·’ç·Š', 'è„ˆè±¡', 'ç´°æ•¸', 'æ²‰å¼±', 'æ°£è™›', 'é™°è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.66322637, '_attr_score': 0.0, '_final_score': 0.66322637}]
2025-11-04 10:15:12 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.95597667'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.95597667, '_attr_score': 0.0, '_final_score': 0.95597667}, {'_additional': {'distance': None, 'score': '0.8048727'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.8048727, '_attr_score': 0.0, '_final_score': 0.8048727}, {'_additional': {'distance': None, 'score': '0.66322637'}, 'case_id': 'CASE_20251005212221_A678_eac69714', 'chief_complaint': 'èƒ¸æ‚¶å¿ƒæ‚¸ä¸‰é€±', 'diagnosis': 'å¿ƒæ‚¸', 'pulse_terms': ['æƒ…ç·’ç·Š', 'è„ˆè±¡', 'ç´°æ•¸', 'æ²‰å¼±', 'æ°£è™›', 'é™°è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.66322637, '_attr_score': 0.0, '_final_score': 0.66322637}]
2025-11-04 10:16:05 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:16:10 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:16:10 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "èˆŒæ·¡", "è„ˆç´°å¼±", "å°ä¾¿æ¸…é•·", "æ€•å†·", "ç™½å¸¶é‡å¤š", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
```
2025-11-04 10:16:10 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "èˆŒæ·¡", "è„ˆç´°å¼±", "å°ä¾¿æ¸…é•·", "æ€•å†·", "ç™½å¸¶é‡å¤š", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
```
2025-11-04 10:16:10 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:16:10 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:16:10 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.84997916'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.84997916, '_attr_score': 0.0, '_final_score': 0.84997916}, {'_additional': {'distance': None, 'score': '0.6812105'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6812105, '_attr_score': 0.0, '_final_score': 0.6812105}, {'_additional': {'distance': None, 'score': '0.66008914'}, 'case_id': 'CASE_20251005211351_C309_a4c59017', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'ä¸å¯ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›', 'è¡€è™›', 'è™›è­‰', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹', 'è™›è­‰'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'è‰²æ·¡', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å¿ƒè„¾'], '_confidence': 0.66008914, '_attr_score': 0.0, '_final_score': 0.66008914}]
2025-11-04 10:16:10 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚
2025-11-04 10:16:10 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚', 'symptom_terms': ['å¿ƒæ‚¸', 'å¤±çœ ', 'èˆŒæ·¡', 'è„ˆç´°å¼±', 'å°ä¾¿æ¸…é•·', 'æ€•å†·', 'ç™½å¸¶é‡å¤š', 'ç›œæ±—'], 'tongue_terms': ['èˆŒæ·¡', 'è„ˆç´°å¼±'], 'pulse_terms': ['èˆŒæ·¡', 'è„ˆç´°å¼±'], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.84997916'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.84997916, '_attr_score': 0.0, '_final_score': 0.84997916}, {'_additional': {'distance': None, 'score': '0.6812105'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6812105, '_attr_score': 0.0, '_final_score': 0.6812105}]
2025-11-04 10:16:58 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:17:01 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:17:01 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œ"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©"
}
2025-11-04 10:17:01 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œ"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©"
}
2025-11-04 10:17:02 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:17:02 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:17:02 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.4975184'}, 'case_id': 'CASE_20251005212258_G890_85162320', 'chief_complaint': 'ç™½å¸¶é‡å¤šè‰²é»ƒä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¸¶é‡', 'èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'æ²¹è†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶é™¤è‡­', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ½”', 'è†½ç€‰'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°', 'è†½ç€‰', 'è‚æ¹¯'], '_confidence': 0.4975184, '_attr_score': 0.0, '_final_score': 0.4975184}, {'_additional': {'distance': None, 'score': '0.43047488'}, 'case_id': 'CASE_20251005211411_P773_ac7de918', 'chief_complaint': 'ç¶“è¡Œé ­ç—›ä¸€å¹´', 'diagnosis': 'ç¶“è¡Œé ­ç—›ï¼ˆè‚é¬±æ°£æ»¯ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è‚æ°£é¬±çµ'], 'symptom_terms': ['é ­ç—›', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['åé»ƒ', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'ç–è‚ç†æ°£ï¼Œæ´»è¡€æ­¢ç—›', 'treatment_terms': [], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚é¬±', 'è‚æ°£é¬±çµ', 'ç–è‚ç†æ°£'], '_confidence': 0.43047488, '_attr_score': 0.0, '_final_score': 0.43047488}]
2025-11-04 10:17:02 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ
2025-11-04 10:17:02 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ', 'symptom_terms': ['èƒƒè„˜è„¹ç—›', 'å—³æ°£', 'æ—©é£½'], 'tongue_terms': [], 'pulse_terms': [], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.4975184'}, 'case_id': 'CASE_20251005212258_G890_85162320', 'chief_complaint': 'ç™½å¸¶é‡å¤šè‰²é»ƒä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¸¶é‡', 'èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'æ²¹è†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶é™¤è‡­', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ½”', 'è†½ç€‰'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°', 'è†½ç€‰', 'è‚æ¹¯'], '_confidence': 0.4975184, '_attr_score': 0.0, '_final_score': 0.4975184}]
2025-11-04 10:17:22 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:17:26 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:17:26 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ç—‡ç‹€ï¼Œå¦‚èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€å£è‹¦ç­‰ï¼Œä¸”æåˆ°æƒ…ç·’ç·Šå¼µæ™‚ç—‡ç‹€åŠ åŠ‡ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦",
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ"
    ],
    "other_terms": [
      "æƒ…ç·’"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ„Ÿè¬æ‚¨çš„æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:17:26 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ç—‡ç‹€ï¼Œå¦‚èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€å£è‹¦ç­‰ï¼Œä¸”æåˆ°æƒ…ç·’ç·Šå¼µæ™‚ç—‡ç‹€åŠ åŠ‡ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦",
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ"
    ],
    "other_terms": [
      "æƒ…ç·’"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ„Ÿè¬æ‚¨çš„æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:17:27 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:17:27 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:17:27 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.9126822'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.9126822, '_attr_score': 0.0, '_final_score': 0.9126822}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.5498679'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.5498679, '_attr_score': 0.0, '_final_score': 0.5498679}]
2025-11-04 10:17:27 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚
2025-11-04 10:17:27 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚', 'symptom_terms': ['èƒƒè„˜è„¹ç—›', 'å—³æ°£', 'æ—©é£½', 'å£è‹¦', 'æƒ…ç·’ç·Šå¼µ'], 'tongue_terms': [], 'pulse_terms': [], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.9126822'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.9126822, '_attr_score': 0.0, '_final_score': 0.9126822}]
2025-11-04 10:17:50 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:17:54 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:17:54 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œè¡¨æ˜æ˜¯ä¸­é†«è¨ºæ–·ç›¸é—œçš„è«‹æ±‚ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦",
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:17:54 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œè¡¨æ˜æ˜¯ä¸­é†«è¨ºæ–·ç›¸é—œçš„è«‹æ±‚ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦",
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:17:56 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:17:56 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:17:56 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.9016588'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.9016588, '_attr_score': 0.0, '_final_score': 0.9016588}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.52707833'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.52707833, '_attr_score': 0.0, '_final_score': 0.52707833}]
2025-11-04 10:17:56 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚
2025-11-04 10:17:56 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚', 'symptom_terms': ['èƒƒè„˜è„¹ç—›', 'å—³æ°£', 'æ—©é£½', 'å£è‹¦', 'æƒ…ç·’ç·Šå¼µ'], 'tongue_terms': ['èˆŒç´…', 'è‹”é»ƒè†©', 'è„ˆå¼¦æ»‘'], 'pulse_terms': ['èˆŒç´…', 'è‹”é»ƒè†©', 'è„ˆå¼¦æ»‘'], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.9016588'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.9016588, '_attr_score': 0.0, '_final_score': 0.9016588}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}]
2025-11-04 10:28:23 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 10:28:23 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 10:28:23 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 10:28:23 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 10:28:23 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 10:28:23 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 10:28:23 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 10:28:23 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:28:26 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:28:26 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:28:26 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:28:26 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:28:26 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:28:26 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 10:28:26 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 10:28:26 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 10:28:26 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:28:26 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:28:26 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 10:28:26 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:28:27 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 10:28:27 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 10:28:27 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 10:28:27 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 10:28:27 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 10:28:27 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 10:28:27 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 10:28:27 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 10:28:27 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 10:28:27 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 10:28:28 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 10:28:28 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 10:28:28 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 10:28:28 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 10:28:28 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:28:28 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 10:28:28 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 10:28:28 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 10:28:28 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 10:28:28 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:28:28 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 10:28:28 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 10:28:28 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 10:28:28 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 10:28:28 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 10:28:28 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 10:28:28 - s_cbr.backend.main - INFO - 
2025-11-04 10:28:28 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 10:28:28 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 10:28:28 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 10:28:28 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 10:28:28 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 10:28:28 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 10:28:28 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 10:28:28 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 10:28:28 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 10:28:29 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 10:28:29 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 10:28:29 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:28:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 10:28:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 10:28:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 10:28:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 10:28:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 10:28:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 10:28:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 10:28:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:28:34 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:28:34 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:28:34 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:28:34 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:28:34 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:28:34 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 10:28:34 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 10:28:34 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 10:28:34 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:28:34 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:28:34 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 10:28:34 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:28:35 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 10:28:35 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 10:28:35 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 10:28:35 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 10:28:35 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 10:28:35 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 10:28:35 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 10:28:35 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 10:28:35 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 10:28:35 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 10:28:36 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 10:28:36 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 10:28:36 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 10:28:36 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 10:28:36 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:28:36 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 10:28:36 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 10:28:36 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 10:28:36 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 10:28:36 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:28:36 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 10:28:36 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 10:28:36 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 10:28:36 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 10:28:36 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 10:28:36 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 10:28:36 - s_cbr.backend.main - INFO - 
2025-11-04 10:28:36 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 10:28:36 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 10:28:36 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 10:28:36 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 10:28:36 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 10:28:36 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 10:28:36 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 10:28:36 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 10:28:37 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 10:28:37 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 10:28:37 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 10:28:37 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:28:50 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 10:28:50 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 10:28:50 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 10:28:50 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 10:28:50 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 10:28:50 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 10:28:50 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 10:28:50 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:28:54 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:28:54 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:28:54 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:28:54 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:28:54 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:28:54 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 10:28:54 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 10:28:54 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 10:28:54 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:28:54 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:28:54 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 10:28:54 - s_cbr.SpiralEngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:28:55 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ TCM æ“´å±•é…ç½®:
2025-11-04 10:28:55 - s_cbr.TextProcessor - INFO -    - è­‰å‹: 12 ç¨®
2025-11-04 10:28:55 - s_cbr.TextProcessor - INFO -    - è‡Ÿè…‘: 5 å€‹
2025-11-04 10:28:55 - s_cbr.TextProcessor - INFO -    - ç—‡ç‹€åˆ†é¡: 6 é¡
2025-11-04 10:28:55 - s_cbr.TextProcessor - INFO - âœ… è¼‰å…¥ jieba è©å…¸: 287 å€‹è©æ¢
2025-11-04 10:28:55 - s_cbr.TextProcessor - INFO -    è©å…¸è·¯å¾‘: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\anc\tcm_jieba_dict.txt
2025-11-04 10:28:55 - s_cbr.DynamicRetrieval - INFO - âœ… å‹•æ…‹æª¢ç´¢å„ªåŒ–å™¨åˆå§‹åŒ–ï¼ˆç°¡åŒ–ç‰ˆï¼‰
2025-11-04 10:28:55 - s_cbr.OutputFormatter - INFO - âœ… è¼¸å‡ºæ ¼å¼åŒ–å™¨åˆå§‹åŒ–
2025-11-04 10:28:55 - s_cbr.ConvergenceMetrics - INFO - âœ… æ”¶æ–‚åº¦è¨ˆç®—å™¨åˆå§‹åŒ–å®Œæˆï¼ˆé‡æ§‹ç‰ˆï¼‰
2025-11-04 10:28:55 - s_cbr.KnowledgeIntegrator - INFO - çŸ¥è­˜åº«è·¯å¾‘è¨­å®šç‚º: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge
2025-11-04 10:28:55 - s_cbr.KnowledgeIntegrator - INFO - âœ… çŸ¥è­˜æ•´åˆå™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥æ‰€æœ‰çŸ¥è­˜æ–‡ä»¶ã€‚
2025-11-04 10:28:55 - s_cbr.PatternDiagnosis - INFO - âœ… è¾¨è­‰-è¨ºæ–·é›™å±¤æ¨ç†å™¨åˆå§‹åŒ–ï¼ˆæœ€çµ‚ä¿®æ­£ç‰ˆï¼‰
2025-11-04 10:28:55 - s_cbr.ConstitutionClassifier - INFO - âœ… é«”è³ªåˆ†é¡å™¨åˆå§‹åŒ–å®Œæˆï¼Œå·²è¼‰å…¥é«”è³ªæ•¸æ“šã€‚
2025-11-04 10:28:55 - s_cbr.SpiralEngine - INFO - âœ… èºæ—‹æ¨ç†å¼•æ“åˆå§‹åŒ–å®Œæˆ (åŒ…å«é«”è³ªåˆ†é¡å™¨)
2025-11-04 10:28:56 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:28:56 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 10:28:56 - s_cbr.StopCriteria - INFO - âœ… çµ‚æ­¢æ¢ä»¶ç®¡ç†å™¨åˆå§‹åŒ–
2025-11-04 10:28:56 - s_cbr.StopCriteria - INFO -    ç¡¬è¦å‰‡: 4 æ¢
2025-11-04 10:28:56 - s_cbr.StopCriteria - INFO -    è»Ÿè¦å‰‡: 4 æ¢
2025-11-04 10:28:56 - s_cbr.SCBREngine - INFO - âœ… è¼”åŠ©æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:28:56 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 10:28:56 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 10:28:56 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:29:00 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:29:00 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡å’Œè„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æå’Œè¾¨è­‰è«–æ²»ã€‚"
}
2025-11-04 10:29:00 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡å’Œè„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œä¸‹ä¸€æ­¥å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æå’Œè¾¨è­‰è«–æ²»ã€‚"
}
2025-11-04 10:29:01 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:29:01 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:29:01 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.98306394'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.98306394, '_attr_score': 0.0, '_final_score': 0.98306394}, {'_additional': {'distance': None, 'score': '0.9463664'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.9463664, '_attr_score': 0.0, '_final_score': 0.9463664}, {'_additional': {'distance': None, 'score': '0.86615515'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.86615515, '_attr_score': 0.0, '_final_score': 0.86615515}]
2025-11-04 10:29:01 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.98306394'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.98306394, '_attr_score': 0.0, '_final_score': 0.98306394}, {'_additional': {'distance': None, 'score': '0.9463664'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.9463664, '_attr_score': 0.0, '_final_score': 0.9463664}, {'_additional': {'distance': None, 'score': '0.86615515'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.86615515, '_attr_score': 0.0, '_final_score': 0.86615515}]
2025-11-04 10:29:52 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:29:56 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:29:56 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œä¸”æåŠéœ€è¦çœ‹ä¸­é†«èª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "åƒä¸å¤ªä¸‹", "æ™šä¸Šå®¹æ˜“é†’ä¾†", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
```
2025-11-04 10:29:56 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œä¸”æåŠéœ€è¦çœ‹ä¸­é†«èª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "åƒä¸å¤ªä¸‹", "æ™šä¸Šå®¹æ˜“é†’ä¾†", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
```
2025-11-04 10:29:57 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:29:57 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:29:57 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '1'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0}, {'_additional': {'distance': None, 'score': '0.76138204'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.76138204, '_attr_score': 0.0, '_final_score': 0.76138204}, {'_additional': {'distance': None, 'score': '0.6550914'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6550914, '_attr_score': 0.0, '_final_score': 0.6550914}]
2025-11-04 10:29:57 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '1'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0}, {'_additional': {'distance': None, 'score': '0.76138204'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.76138204, '_attr_score': 0.0, '_final_score': 0.76138204}, {'_additional': {'distance': None, 'score': '0.6550914'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6550914, '_attr_score': 0.0, '_final_score': 0.6550914}]
2025-11-04 10:30:48 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:30:53 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:30:53 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:30:53 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:30:53 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:30:53 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:30:53 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.84997916'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.84997916, '_attr_score': 0.0, '_final_score': 0.84997916}, {'_additional': {'distance': None, 'score': '0.6812105'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6812105, '_attr_score': 0.0, '_final_score': 0.6812105}, {'_additional': {'distance': None, 'score': '0.66008914'}, 'case_id': 'CASE_20251005211351_C309_a4c59017', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'ä¸å¯ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›', 'è¡€è™›', 'è™›è­‰', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹', 'è™›è­‰'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'è‰²æ·¡', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å¿ƒè„¾'], '_confidence': 0.66008914, '_attr_score': 0.0, '_final_score': 0.66008914}]
2025-11-04 10:30:53 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.84997916'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.84997916, '_attr_score': 0.0, '_final_score': 0.84997916}, {'_additional': {'distance': None, 'score': '0.6812105'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6812105, '_attr_score': 0.0, '_final_score': 0.6812105}, {'_additional': {'distance': None, 'score': '0.66008914'}, 'case_id': 'CASE_20251005211351_C309_a4c59017', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'ä¸å¯ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›', 'è¡€è™›', 'è™›è­‰', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹', 'è™›è­‰'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'è‰²æ·¡', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å¿ƒè„¾'], '_confidence': 0.66008914, '_attr_score': 0.0, '_final_score': 0.66008914}]
2025-11-04 10:31:33 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:31:37 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:31:37 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„èƒƒéƒ¨ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œ"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ"
    ],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©"
}
2025-11-04 10:31:37 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„èƒƒéƒ¨ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œ"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ"
    ],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©"
}
2025-11-04 10:31:38 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:31:38 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:31:38 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.50256014'}, 'case_id': 'CASE_20251005212258_G890_85162320', 'chief_complaint': 'ç™½å¸¶é‡å¤šè‰²é»ƒä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¸¶é‡', 'èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'æ²¹è†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶é™¤è‡­', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ½”', 'è†½ç€‰'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°', 'è†½ç€‰', 'è‚æ¹¯'], '_confidence': 0.50256014, '_attr_score': 0.0, '_final_score': 0.50256014}, {'_additional': {'distance': None, 'score': '0.4444305'}, 'case_id': 'CASE_20251005211411_P773_ac7de918', 'chief_complaint': 'ç¶“è¡Œé ­ç—›ä¸€å¹´', 'diagnosis': 'ç¶“è¡Œé ­ç—›ï¼ˆè‚é¬±æ°£æ»¯ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è‚æ°£é¬±çµ'], 'symptom_terms': ['é ­ç—›', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['åé»ƒ', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'ç–è‚ç†æ°£ï¼Œæ´»è¡€æ­¢ç—›', 'treatment_terms': [], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚é¬±', 'è‚æ°£é¬±çµ', 'ç–è‚ç†æ°£'], '_confidence': 0.4444305, '_attr_score': 0.0, '_final_score': 0.4444305}]
2025-11-04 10:31:38 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.4444305'}, 'case_id': 'CASE_20251005211411_P773_ac7de918', 'chief_complaint': 'ç¶“è¡Œé ­ç—›ä¸€å¹´', 'diagnosis': 'ç¶“è¡Œé ­ç—›ï¼ˆè‚é¬±æ°£æ»¯ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è‚æ°£é¬±çµ'], 'symptom_terms': ['é ­ç—›', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['åé»ƒ', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'ç–è‚ç†æ°£ï¼Œæ´»è¡€æ­¢ç—›', 'treatment_terms': [], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚é¬±', 'è‚æ°£é¬±çµ', 'ç–è‚ç†æ°£'], '_confidence': 0.4444305, '_attr_score': 0.0, '_final_score': 0.4444305}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.50256014'}, 'case_id': 'CASE_20251005212258_G890_85162320', 'chief_complaint': 'ç™½å¸¶é‡å¤šè‰²é»ƒä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¸¶é‡', 'èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'æ²¹è†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶é™¤è‡­', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ½”', 'è†½ç€‰'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°', 'è†½ç€‰', 'è‚æ¹¯'], '_confidence': 0.50256014, '_attr_score': 0.0, '_final_score': 0.50256014}]
2025-11-04 10:32:29 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:32:33 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:32:33 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:32:33 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:32:34 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:32:34 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:32:34 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.8363438'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.8363438, '_attr_score': 0.0, '_final_score': 0.8363438}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.45252484'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.45252484, '_attr_score': 0.0, '_final_score': 0.45252484}]
2025-11-04 10:32:34 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚
2025-11-04 10:32:34 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚', 'symptom_terms': ['èƒƒè„˜è„¹ç—›', 'å—³æ°£', 'æ—©é£½', 'æƒ…ç·’ç·Šå¼µ', 'å£è‹¦'], 'tongue_terms': [], 'pulse_terms': [], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.8363438'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.8363438, '_attr_score': 0.0, '_final_score': 0.8363438}]
2025-11-04 10:33:25 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:33:30 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 10:33:30 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œè¡¨æ˜æ˜¯ä¸­é†«è¨ºæ–·ç›¸é—œçš„è«‹æ±‚ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦",
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:33:30 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œè¡¨æ˜æ˜¯ä¸­é†«è¨ºæ–·ç›¸é—œçš„è«‹æ±‚ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦",
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 10:33:31 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 10:33:31 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 10:33:31 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.9016588'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.9016588, '_attr_score': 0.0, '_final_score': 0.9016588}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.52707833'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.52707833, '_attr_score': 0.0, '_final_score': 0.52707833}]
2025-11-04 10:33:31 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚
2025-11-04 10:33:31 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚', 'symptom_terms': ['èƒƒè„˜è„¹ç—›', 'å—³æ°£', 'æ—©é£½', 'å£è‹¦', 'æƒ…ç·’ç·Šå¼µ'], 'tongue_terms': ['èˆŒç´…', 'è‹”é»ƒè†©', 'è„ˆå¼¦æ»‘'], 'pulse_terms': ['èˆŒç´…', 'è‹”é»ƒè†©', 'è„ˆå¼¦æ»‘'], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.9016588'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.9016588, '_attr_score': 0.0, '_final_score': 0.9016588}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}]
2025-11-04 10:50:57 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 10:50:57 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 10:50:57 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 10:50:57 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 10:50:57 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 10:50:57 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 10:50:57 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 10:50:57 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:50:59 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:50:59 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:50:59 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:50:59 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:50:59 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:50:59 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 10:50:59 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 10:50:59 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:50:59 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:50:59 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 10:50:59 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 10:51:00 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 10:51:00 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 10:51:00 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 10:51:00 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 10:51:00 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 10:51:00 - s_cbr.backend.main - INFO - 
2025-11-04 10:51:00 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 10:51:00 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 10:51:00 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 10:51:00 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 10:51:00 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 10:51:00 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 10:51:00 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 10:51:00 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 10:51:01 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 10:51:02 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 10:51:02 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 10:51:02 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:51:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 10:51:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 10:51:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 10:51:06 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 10:51:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 10:51:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 10:51:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 10:51:06 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:51:08 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:51:08 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 10:51:08 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:51:08 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:51:08 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 10:51:08 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 10:51:08 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 10:51:08 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 10:51:08 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 10:51:08 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 10:51:08 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 10:51:09 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 10:51:09 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 10:51:09 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 10:51:09 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 10:51:09 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 10:51:09 - s_cbr.backend.main - INFO - 
2025-11-04 10:51:09 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 10:51:09 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 10:51:09 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 10:51:09 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 10:51:09 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 10:51:09 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 10:51:09 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 10:51:09 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 10:51:10 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 10:51:11 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 10:51:11 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 10:51:11 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:06:27 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:06:27 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:06:27 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:06:27 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:06:27 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:06:27 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:06:27 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:06:27 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:06:29 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:06:29 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:06:29 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:06:29 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:06:29 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:06:29 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:06:29 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:06:29 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:06:29 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:06:29 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:06:29 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:06:30 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 11:06:30 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:06:30 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 11:06:30 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 11:06:30 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 11:06:30 - s_cbr.backend.main - INFO - 
2025-11-04 11:06:30 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 11:06:30 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 11:06:30 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 11:06:30 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 11:06:30 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 11:06:30 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 11:06:30 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 11:06:30 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:06:32 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 11:06:32 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 11:06:32 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 11:06:32 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:06:34 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:06:34 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:06:34 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:06:34 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:06:34 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:06:34 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:06:34 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:06:34 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:06:36 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:06:36 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:06:36 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:06:36 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:06:36 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:06:36 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:06:36 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:06:36 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:06:37 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:06:37 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:06:37 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:06:37 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 11:06:37 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:06:37 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 11:06:37 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 11:06:37 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 11:06:37 - s_cbr.backend.main - INFO - 
2025-11-04 11:06:37 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 11:06:37 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 11:06:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 11:06:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 11:06:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 11:06:37 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 11:06:37 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 11:06:37 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:06:39 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 11:06:39 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 11:06:40 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 11:06:40 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:06:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:06:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:06:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:06:41 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:06:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:06:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:06:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:06:41 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:06:43 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:06:43 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:06:44 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:06:44 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:06:44 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:06:44 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:06:44 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:06:44 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:06:44 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:06:44 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:06:44 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:06:44 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 11:06:44 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:06:44 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 11:06:44 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 11:06:44 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 11:06:44 - s_cbr.backend.main - INFO - 
2025-11-04 11:06:44 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 11:06:44 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 11:06:44 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 11:06:44 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 11:06:44 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 11:06:44 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 11:06:44 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 11:06:44 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:06:46 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 11:06:47 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 11:06:47 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 11:06:47 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:06:48 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:06:48 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:06:48 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:06:48 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:06:48 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:06:48 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:06:48 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:06:48 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:06:51 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:06:51 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:06:51 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:06:51 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:06:51 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:06:51 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:06:51 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:06:51 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:06:51 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:06:51 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:06:51 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:06:52 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 11:06:52 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:06:52 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 11:06:52 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 11:06:52 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 11:06:52 - s_cbr.backend.main - INFO - 
2025-11-04 11:06:52 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 11:06:52 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 11:06:52 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 11:06:52 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 11:06:52 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 11:06:52 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 11:06:52 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 11:06:52 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:06:53 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 11:06:54 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 11:06:54 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 11:06:54 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:06:55 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:06:55 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:06:55 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:06:55 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:06:55 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:06:55 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:06:55 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:06:55 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:06:58 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:06:58 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:06:58 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:06:58 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:06:58 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:06:58 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:06:58 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:06:58 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:06:58 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:06:58 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:06:58 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:06:59 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 11:06:59 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:06:59 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 11:06:59 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 11:06:59 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 11:06:59 - s_cbr.backend.main - INFO - 
2025-11-04 11:06:59 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 11:06:59 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 11:06:59 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 11:06:59 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 11:06:59 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 11:06:59 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 11:06:59 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 11:06:59 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:01 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 11:07:01 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 11:07:01 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 11:07:01 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:03 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:07:03 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:07:03 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:07:03 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:07:03 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:07:03 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:07:03 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:07:03 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:05 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:05 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:05 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:05 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:05 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:05 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:07:05 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:07:05 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:05 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:07:05 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:05 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:07:06 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 11:07:06 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:06 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 11:07:06 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 11:07:06 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 11:07:06 - s_cbr.backend.main - INFO - 
2025-11-04 11:07:06 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 11:07:06 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 11:07:06 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 11:07:06 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 11:07:06 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 11:07:06 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 11:07:06 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 11:07:06 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:07 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 11:07:08 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 11:07:08 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 11:07:08 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:10 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:07:10 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:07:10 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:07:10 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:07:10 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:07:10 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:07:10 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:07:10 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:12 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:12 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:12 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:12 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:12 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:12 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:07:12 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:07:12 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:13 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:07:13 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:13 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:07:14 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 11:07:14 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:14 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 11:07:14 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 11:07:14 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 11:07:14 - s_cbr.backend.main - INFO - 
2025-11-04 11:07:14 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 11:07:14 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 11:07:14 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 11:07:14 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 11:07:14 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 11:07:14 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 11:07:14 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 11:07:14 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:15 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 11:07:16 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 11:07:16 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 11:07:16 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:17 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:07:17 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:07:17 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:07:17 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:07:17 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:07:17 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:07:18 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:07:18 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:20 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:20 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:20 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:20 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:20 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:20 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:07:20 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:07:20 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:20 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:07:20 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:20 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:07:21 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 11:07:21 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:21 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 11:07:21 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 11:07:21 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 11:07:21 - s_cbr.backend.main - INFO - 
2025-11-04 11:07:21 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 11:07:21 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 11:07:21 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 11:07:21 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 11:07:21 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 11:07:21 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 11:07:21 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 11:07:21 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:23 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 11:07:23 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 11:07:23 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 11:07:23 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:24 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:07:24 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:07:24 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:07:24 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:07:24 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:07:24 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:07:24 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:07:24 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:26 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:26 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:27 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:27 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:27 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:27 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:07:27 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:07:27 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:27 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:07:27 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:27 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:07:28 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 11:07:28 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:28 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 11:07:28 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 11:07:28 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 11:07:28 - s_cbr.backend.main - INFO - 
2025-11-04 11:07:28 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 11:07:28 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 11:07:28 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 11:07:28 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 11:07:28 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 11:07:28 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 11:07:28 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 11:07:28 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:29 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 11:07:30 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 11:07:30 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 11:07:30 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:07:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:07:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:07:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:07:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:07:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:07:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:07:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:33 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:33 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:33 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:33 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:33 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:33 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:07:33 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:07:33 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:34 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:07:34 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:34 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:07:35 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 11:07:35 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:35 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 11:07:35 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 11:07:35 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 11:07:35 - s_cbr.backend.main - INFO - 
2025-11-04 11:07:35 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 11:07:35 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 11:07:35 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 11:07:35 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 11:07:35 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 11:07:35 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 11:07:35 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 11:07:35 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:36 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 11:07:37 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 11:07:37 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 11:07:37 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:38 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:07:38 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:07:38 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:07:38 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:07:38 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:07:39 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:07:39 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:07:39 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:41 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:41 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:41 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:41 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:41 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:41 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:07:41 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:07:41 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:41 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:07:41 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:41 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:07:42 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 11:07:42 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:42 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 11:07:42 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 11:07:42 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 11:07:42 - s_cbr.backend.main - INFO - 
2025-11-04 11:07:42 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 11:07:42 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 11:07:42 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 11:07:42 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 11:07:42 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 11:07:42 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 11:07:42 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 11:07:42 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:43 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 11:07:44 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 11:07:44 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 11:07:44 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:46 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:07:46 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:07:46 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:07:46 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:07:46 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:07:46 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:07:46 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:07:46 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:48 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:48 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:48 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:48 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:48 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:48 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:07:48 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:07:48 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:49 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:07:49 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:49 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:07:49 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 11:07:49 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:49 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 11:07:49 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 11:07:49 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 11:07:49 - s_cbr.backend.main - INFO - 
2025-11-04 11:07:49 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 11:07:49 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 11:07:49 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 11:07:49 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 11:07:49 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 11:07:49 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 11:07:49 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 11:07:49 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:51 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 11:07:51 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 11:07:51 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 11:07:51 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:53 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:07:53 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:07:53 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:07:53 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:07:53 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:07:53 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:07:53 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:07:53 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:55 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:55 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:07:55 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:55 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:55 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:55 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:07:55 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:07:55 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:07:55 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:07:55 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:07:55 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:07:56 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 11:07:56 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:56 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 11:07:56 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 11:07:56 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 11:07:56 - s_cbr.backend.main - INFO - 
2025-11-04 11:07:56 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 11:07:56 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 11:07:56 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 11:07:56 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 11:07:56 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 11:07:56 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 11:07:56 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 11:07:56 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:07:58 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 11:07:58 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 11:07:58 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 11:07:58 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:08:00 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:08:00 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:08:00 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:08:00 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:08:00 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:08:00 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:08:00 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:08:00 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:08:02 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:08:02 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:08:02 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:08:02 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:08:02 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:08:02 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:08:02 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:08:02 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:08:03 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:08:03 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:08:03 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:08:03 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 11:08:03 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:08:03 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 11:08:03 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 11:08:03 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 11:08:03 - s_cbr.backend.main - INFO - 
2025-11-04 11:08:03 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 11:08:03 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 11:08:03 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 11:08:03 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 11:08:03 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 11:08:03 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 11:08:03 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 11:08:03 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:08:05 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 11:08:05 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 11:08:06 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 11:08:06 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:08:20 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:08:20 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:08:21 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:08:21 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:08:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:08:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:08:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:08:21 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:08:23 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:08:23 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:08:23 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:08:23 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:08:23 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:08:23 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:08:23 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:08:23 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:08:23 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:08:23 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:08:23 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:08:24 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 11:08:24 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:08:24 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 11:08:24 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 11:08:24 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 11:08:24 - s_cbr.backend.main - INFO - 
2025-11-04 11:08:24 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 11:08:24 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 11:08:24 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 11:08:24 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 11:08:24 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 11:08:24 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 11:08:24 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 11:08:24 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 11:08:25 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 11:08:26 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 11:08:26 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 11:08:26 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:09:07 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 11:09:07 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 11:09:07 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 11:09:07 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 11:09:07 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 11:09:07 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 11:09:07 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 11:09:07 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:09:09 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:09:09 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 11:09:09 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:09:09 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:09:09 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 11:09:09 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 11:09:09 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:09:09 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 11:09:09 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:09:09 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 11:09:09 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 11:09:09 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 11:09:10 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:09:15 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 11:09:15 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼Œä¸¦æåŠèˆŒè„ˆç‰¹å¾µï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©"
}
2025-11-04 11:09:15 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼Œä¸¦æåŠèˆŒè„ˆç‰¹å¾µï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©"
}
2025-11-04 11:09:16 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 11:09:16 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 11:09:16 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.77188754'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.77188754, '_attr_score': 0.0, '_final_score': 0.77188754}, {'_additional': {'distance': None, 'score': '0.7345238'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.7345238, '_attr_score': 0.0, '_final_score': 0.7345238}, {'_additional': {'distance': None, 'score': '0.6577592'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6577592, '_attr_score': 0.0, '_final_score': 0.6577592}]
2025-11-04 11:09:16 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.77188754'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.77188754, '_attr_score': 0.0, '_final_score': 0.77188754}, {'_additional': {'distance': None, 'score': '0.7345238'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.7345238, '_attr_score': 0.0, '_final_score': 0.7345238}, {'_additional': {'distance': None, 'score': '0.6577592'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6577592, '_attr_score': 0.0, '_final_score': 0.6577592}]
2025-11-04 11:10:08 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:10:12 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 11:10:12 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æ™šä¸Šå®¹æ˜“é†’ä¾†"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
}
2025-11-04 11:10:12 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æ™šä¸Šå®¹æ˜“é†’ä¾†"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
}
2025-11-04 11:10:14 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 11:10:14 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 11:10:14 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.95597667'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.95597667, '_attr_score': 0.0, '_final_score': 0.95597667}, {'_additional': {'distance': None, 'score': '0.8048727'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.8048727, '_attr_score': 0.0, '_final_score': 0.8048727}, {'_additional': {'distance': None, 'score': '0.66322637'}, 'case_id': 'CASE_20251005212221_A678_eac69714', 'chief_complaint': 'èƒ¸æ‚¶å¿ƒæ‚¸ä¸‰é€±', 'diagnosis': 'å¿ƒæ‚¸', 'pulse_terms': ['æƒ…ç·’ç·Š', 'è„ˆè±¡', 'ç´°æ•¸', 'æ²‰å¼±', 'æ°£è™›', 'é™°è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.66322637, '_attr_score': 0.0, '_final_score': 0.66322637}]
2025-11-04 11:10:14 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.95597667'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.95597667, '_attr_score': 0.0, '_final_score': 0.95597667}, {'_additional': {'distance': None, 'score': '0.8048727'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.8048727, '_attr_score': 0.0, '_final_score': 0.8048727}, {'_additional': {'distance': None, 'score': '0.66322637'}, 'case_id': 'CASE_20251005212221_A678_eac69714', 'chief_complaint': 'èƒ¸æ‚¶å¿ƒæ‚¸ä¸‰é€±', 'diagnosis': 'å¿ƒæ‚¸', 'pulse_terms': ['æƒ…ç·’ç·Š', 'è„ˆè±¡', 'ç´°æ•¸', 'æ²‰å¼±', 'æ°£è™›', 'é™°è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.66322637, '_attr_score': 0.0, '_final_score': 0.66322637}]
2025-11-04 11:11:05 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:11:09 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 11:11:09 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œéœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
}
2025-11-04 11:11:09 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œéœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
}
2025-11-04 11:11:10 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 11:11:10 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 11:11:10 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.84997916'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.84997916, '_attr_score': 0.0, '_final_score': 0.84997916}, {'_additional': {'distance': None, 'score': '0.6812105'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6812105, '_attr_score': 0.0, '_final_score': 0.6812105}, {'_additional': {'distance': None, 'score': '0.66008914'}, 'case_id': 'CASE_20251005211351_C309_a4c59017', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'ä¸å¯ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›', 'è¡€è™›', 'è™›è­‰', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹', 'è™›è­‰'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'è‰²æ·¡', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å¿ƒè„¾'], '_confidence': 0.66008914, '_attr_score': 0.0, '_final_score': 0.66008914}]
2025-11-04 11:11:10 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.84997916'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.84997916, '_attr_score': 0.0, '_final_score': 0.84997916}, {'_additional': {'distance': None, 'score': '0.6812105'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6812105, '_attr_score': 0.0, '_final_score': 0.6812105}, {'_additional': {'distance': None, 'score': '0.66008914'}, 'case_id': 'CASE_20251005211351_C309_a4c59017', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'ä¸å¯ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›', 'è¡€è™›', 'è™›è­‰', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹', 'è™›è­‰'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'è‰²æ·¡', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å¿ƒè„¾'], '_confidence': 0.66008914, '_attr_score': 0.0, '_final_score': 0.66008914}]
2025-11-04 11:12:00 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:12:04 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 11:12:04 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„èƒƒéƒ¨ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡å˜—è©¦æ ¹æ“šæ‚¨çš„æè¿°é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 11:12:04 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„èƒƒéƒ¨ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "æ‚¨çš„ç—‡ç‹€å·²ç¶“è¢«è¨˜éŒ„ï¼Œç³»çµ±å°‡å˜—è©¦æ ¹æ“šæ‚¨çš„æè¿°é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 11:12:04 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 11:12:04 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 11:12:04 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.4975184'}, 'case_id': 'CASE_20251005212258_G890_85162320', 'chief_complaint': 'ç™½å¸¶é‡å¤šè‰²é»ƒä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¸¶é‡', 'èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'æ²¹è†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶é™¤è‡­', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ½”', 'è†½ç€‰'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°', 'è†½ç€‰', 'è‚æ¹¯'], '_confidence': 0.4975184, '_attr_score': 0.0, '_final_score': 0.4975184}, {'_additional': {'distance': None, 'score': '0.43047488'}, 'case_id': 'CASE_20251005211411_P773_ac7de918', 'chief_complaint': 'ç¶“è¡Œé ­ç—›ä¸€å¹´', 'diagnosis': 'ç¶“è¡Œé ­ç—›ï¼ˆè‚é¬±æ°£æ»¯ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è‚æ°£é¬±çµ'], 'symptom_terms': ['é ­ç—›', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['åé»ƒ', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'ç–è‚ç†æ°£ï¼Œæ´»è¡€æ­¢ç—›', 'treatment_terms': [], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚é¬±', 'è‚æ°£é¬±çµ', 'ç–è‚ç†æ°£'], '_confidence': 0.43047488, '_attr_score': 0.0, '_final_score': 0.43047488}]
2025-11-04 11:12:04 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ
2025-11-04 11:12:04 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ', 'symptom_terms': ['èƒƒè„˜è„¹ç—›', 'å—³æ°£', 'æ—©é£½'], 'tongue_terms': [], 'pulse_terms': [], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.4975184'}, 'case_id': 'CASE_20251005212258_G890_85162320', 'chief_complaint': 'ç™½å¸¶é‡å¤šè‰²é»ƒä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¸¶é‡', 'èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'æ²¹è†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶é™¤è‡­', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ½”', 'è†½ç€‰'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°', 'è†½ç€‰', 'è‚æ¹¯'], '_confidence': 0.4975184, '_attr_score': 0.0, '_final_score': 0.4975184}]
2025-11-04 11:12:51 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:12:55 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 11:12:55 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ"
    ],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 11:12:55 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ"
    ],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 11:12:56 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 11:12:56 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 11:12:56 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.86522675'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.86522675, '_attr_score': 0.0, '_final_score': 0.86522675}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.5251382'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.5251382, '_attr_score': 0.0, '_final_score': 0.5251382}]
2025-11-04 11:12:56 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.86522675'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.86522675, '_attr_score': 0.0, '_final_score': 0.86522675}, {'_additional': {'distance': None, 'score': '0.5251382'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.5251382, '_attr_score': 0.0, '_final_score': 0.5251382}]
2025-11-04 11:13:48 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 11:13:52 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 11:13:52 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒè±¡ã€è„ˆè±¡å’Œä¸»è¨´ç—‡ç‹€ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œæ­£åœ¨é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 11:13:52 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒè±¡ã€è„ˆè±¡å’Œä¸»è¨´ç—‡ç‹€ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œæ­£åœ¨é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 11:13:53 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 11:13:53 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 11:13:53 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.89719427'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.89719427, '_attr_score': 0.0, '_final_score': 0.89719427}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.50715905'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.50715905, '_attr_score': 0.0, '_final_score': 0.50715905}]
2025-11-04 11:13:53 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚
2025-11-04 11:13:53 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚', 'symptom_terms': ['èƒƒè„˜è„¹ç—›', 'å—³æ°£', 'æ—©é£½', 'å£è‹¦'], 'tongue_terms': ['èˆŒç´…', 'è‹”é»ƒè†©', 'è„ˆå¼¦æ»‘'], 'pulse_terms': ['èˆŒç´…', 'è‹”é»ƒè†©', 'è„ˆå¼¦æ»‘'], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.89719427'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.89719427, '_attr_score': 0.0, '_final_score': 0.89719427}]
2025-11-04 13:32:45 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 13:32:45 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 13:32:45 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 13:32:45 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 13:32:45 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 13:32:45 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 13:32:45 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 13:32:45 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 13:32:48 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 13:32:48 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 13:32:48 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 13:32:48 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 13:32:48 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 13:32:48 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 13:32:48 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 13:32:48 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 13:32:48 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 13:32:48 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 13:32:48 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 13:32:48 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 13:32:48 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 13:32:54 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 13:32:54 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "treatment_terms",
      "full_text"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 13:32:54 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "treatment_terms",
      "full_text"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 13:32:56 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 13:32:56 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 13:32:56 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.98306394'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.98306394, '_attr_score': 0.0, '_final_score': 0.98306394}, {'_additional': {'distance': None, 'score': '0.9463664'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.9463664, '_attr_score': 0.0, '_final_score': 0.9463664}, {'_additional': {'distance': None, 'score': '0.86615515'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.86615515, '_attr_score': 0.0, '_final_score': 0.86615515}]
2025-11-04 13:32:56 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.98306394'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.98306394, '_attr_score': 0.0, '_final_score': 0.98306394}, {'_additional': {'distance': None, 'score': '0.9463664'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.9463664, '_attr_score': 0.0, '_final_score': 0.9463664}, {'_additional': {'distance': None, 'score': '0.86615515'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.86615515, '_attr_score': 0.0, '_final_score': 0.86615515}]
2025-11-04 13:33:50 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 13:33:55 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 13:33:55 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œä¸”æåŠéœ€è¦çœ‹ä¸­é†«èª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "treatment_terms",
      "full_text"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 13:33:55 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œä¸”æåŠéœ€è¦çœ‹ä¸­é†«èª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "é£Ÿæ¬²ä¸æŒ¯",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "treatment_terms",
      "full_text"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 13:33:57 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 13:33:57 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 13:33:57 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.7740256'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.7740256, '_attr_score': 0.0, '_final_score': 0.7740256}, {'_additional': {'distance': None, 'score': '0.7333802'}, 'case_id': 'CASE_20251005212221_A678_eac69714', 'chief_complaint': 'èƒ¸æ‚¶å¿ƒæ‚¸ä¸‰é€±', 'diagnosis': 'å¿ƒæ‚¸', 'pulse_terms': ['æƒ…ç·’ç·Š', 'è„ˆè±¡', 'ç´°æ•¸', 'æ²‰å¼±', 'æ°£è™›', 'é™°è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.7333802, '_attr_score': 0.0, '_final_score': 0.7333802}, {'_additional': {'distance': None, 'score': '0.5947973'}, 'case_id': 'CASE_20251005211351_C309_a4c59017', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'ä¸å¯ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›', 'è¡€è™›', 'è™›è­‰', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹', 'è™›è­‰'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'è‰²æ·¡', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å¿ƒè„¾'], '_confidence': 0.5947973, '_attr_score': 0.0, '_final_score': 0.5947973}]
2025-11-04 13:33:57 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.7740256'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.7740256, '_attr_score': 0.0, '_final_score': 0.7740256}, {'_additional': {'distance': None, 'score': '0.7333802'}, 'case_id': 'CASE_20251005212221_A678_eac69714', 'chief_complaint': 'èƒ¸æ‚¶å¿ƒæ‚¸ä¸‰é€±', 'diagnosis': 'å¿ƒæ‚¸', 'pulse_terms': ['æƒ…ç·’ç·Š', 'è„ˆè±¡', 'ç´°æ•¸', 'æ²‰å¼±', 'æ°£è™›', 'é™°è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.7333802, '_attr_score': 0.0, '_final_score': 0.7333802}, {'_additional': {'distance': None, 'score': '0.5947973'}, 'case_id': 'CASE_20251005211351_C309_a4c59017', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'ä¸å¯ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›', 'è¡€è™›', 'è™›è­‰', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹', 'è™›è­‰'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'è‰²æ·¡', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å¿ƒè„¾'], '_confidence': 0.5947973, '_attr_score': 0.0, '_final_score': 0.5947973}]
2025-11-04 13:34:50 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 13:34:56 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 13:34:56 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "èˆŒæ·¡", "è„ˆç´°å¼±", "å°ä¾¿æ¸…é•·", "æ€•å†·", "ç™½å¸¶é‡å¤š", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": ["symptom_terms", "tongue_terms", "pulse_terms", "zangfu_terms", "chief_complaint"],
    "properties": ["case_id", "chief_complaint", "symptom_terms", "syndrome_terms", "diagnosis", "treatment_principle", "tongue_terms", "pulse_terms", "zangfu_terms", "treatment_terms", "full_text"]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
}
```
2025-11-04 13:34:56 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["å¿ƒæ‚¸", "å¤±çœ ", "èˆŒæ·¡", "è„ˆç´°å¼±", "å°ä¾¿æ¸…é•·", "æ€•å†·", "ç™½å¸¶é‡å¤š", "ç›œæ±—"],
    "tongue_pulse_terms": ["èˆŒæ·¡", "è„ˆç´°å¼±"],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": ["symptom_terms", "tongue_terms", "pulse_terms", "zangfu_terms", "chief_complaint"],
    "properties": ["case_id", "chief_complaint", "symptom_terms", "syndrome_terms", "diagnosis", "treatment_principle", "tongue_terms", "pulse_terms", "zangfu_terms", "treatment_terms", "full_text"]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
}
```
2025-11-04 13:34:57 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 13:34:57 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 13:34:57 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.84997916'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.84997916, '_attr_score': 0.0, '_final_score': 0.84997916}, {'_additional': {'distance': None, 'score': '0.6812105'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6812105, '_attr_score': 0.0, '_final_score': 0.6812105}, {'_additional': {'distance': None, 'score': '0.66008914'}, 'case_id': 'CASE_20251005211351_C309_a4c59017', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'ä¸å¯ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›', 'è¡€è™›', 'è™›è­‰', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹', 'è™›è­‰'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'è‰²æ·¡', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å¿ƒè„¾'], '_confidence': 0.66008914, '_attr_score': 0.0, '_final_score': 0.66008914}]
2025-11-04 13:34:57 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.84997916'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.84997916, '_attr_score': 0.0, '_final_score': 0.84997916}, {'_additional': {'distance': None, 'score': '0.6812105'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6812105, '_attr_score': 0.0, '_final_score': 0.6812105}, {'_additional': {'distance': None, 'score': '0.66008914'}, 'case_id': 'CASE_20251005211351_C309_a4c59017', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'ä¸å¯ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›', 'è¡€è™›', 'è™›è­‰', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹', 'è™›è­‰'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'è‰²æ·¡', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å¿ƒè„¾'], '_confidence': 0.66008914, '_attr_score': 0.0, '_final_score': 0.66008914}]
2025-11-04 13:35:48 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 13:35:52 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 13:35:52 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„èƒƒéƒ¨ä¸é©ç—‡ç‹€ï¼Œæ¶‰åŠä¸­é†«çš„è­‰å‹åˆ†æ"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 13:35:52 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„èƒƒéƒ¨ä¸é©ç—‡ç‹€ï¼Œæ¶‰åŠä¸­é†«çš„è­‰å‹åˆ†æ"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 13:35:52 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 13:35:53 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 13:35:53 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.4975184'}, 'case_id': 'CASE_20251005212258_G890_85162320', 'chief_complaint': 'ç™½å¸¶é‡å¤šè‰²é»ƒä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¸¶é‡', 'èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'æ²¹è†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶é™¤è‡­', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ½”', 'è†½ç€‰'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°', 'è†½ç€‰', 'è‚æ¹¯'], '_confidence': 0.4975184, '_attr_score': 0.0, '_final_score': 0.4975184}, {'_additional': {'distance': None, 'score': '0.43047488'}, 'case_id': 'CASE_20251005211411_P773_ac7de918', 'chief_complaint': 'ç¶“è¡Œé ­ç—›ä¸€å¹´', 'diagnosis': 'ç¶“è¡Œé ­ç—›ï¼ˆè‚é¬±æ°£æ»¯ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è‚æ°£é¬±çµ'], 'symptom_terms': ['é ­ç—›', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['åé»ƒ', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'ç–è‚ç†æ°£ï¼Œæ´»è¡€æ­¢ç—›', 'treatment_terms': [], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚é¬±', 'è‚æ°£é¬±çµ', 'ç–è‚ç†æ°£'], '_confidence': 0.43047488, '_attr_score': 0.0, '_final_score': 0.43047488}]
2025-11-04 13:35:53 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ
2025-11-04 13:35:53 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ', 'symptom_terms': ['èƒƒè„˜è„¹ç—›', 'å—³æ°£', 'æ—©é£½'], 'tongue_terms': [], 'pulse_terms': [], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.4975184'}, 'case_id': 'CASE_20251005212258_G890_85162320', 'chief_complaint': 'ç™½å¸¶é‡å¤šè‰²é»ƒä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¸¶é‡', 'èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'æ²¹è†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶é™¤è‡­', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ½”', 'è†½ç€‰'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°', 'è†½ç€‰', 'è‚æ¹¯'], '_confidence': 0.4975184, '_attr_score': 0.0, '_final_score': 0.4975184}]
2025-11-04 13:36:42 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 13:36:47 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 13:36:47 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«çš„è­‰å‹åˆ†æç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["èƒƒè„˜è„¹ç—›", "å—³æ°£", "æ—©é£½", "æƒ…ç·’ç·Šå¼µ", "å£è‹¦"],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": ["symptom_terms", "chief_complaint"],
    "properties": ["case_id", "chief_complaint", "symptom_terms", "syndrome_terms", "diagnosis", "treatment_principle"]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
```
2025-11-04 13:36:47 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
```json
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«çš„è­‰å‹åˆ†æç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": ["èƒƒè„˜è„¹ç—›", "å—³æ°£", "æ—©é£½", "æƒ…ç·’ç·Šå¼µ", "å£è‹¦"],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": ["symptom_terms", "chief_complaint"],
    "properties": ["case_id", "chief_complaint", "symptom_terms", "syndrome_terms", "diagnosis", "treatment_principle"]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
```
2025-11-04 13:36:47 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 13:36:47 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 13:36:47 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.8363438'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.8363438, '_attr_score': 0.0, '_final_score': 0.8363438}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.45252484'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.45252484, '_attr_score': 0.0, '_final_score': 0.45252484}]
2025-11-04 13:36:47 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚
2025-11-04 13:36:47 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚', 'symptom_terms': ['èƒƒè„˜è„¹ç—›', 'å—³æ°£', 'æ—©é£½', 'æƒ…ç·’ç·Šå¼µ', 'å£è‹¦'], 'tongue_terms': [], 'pulse_terms': [], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.8363438'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.8363438, '_attr_score': 0.0, '_final_score': 0.8363438}]
2025-11-04 13:37:35 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 13:37:41 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 13:37:41 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œèˆ‡ä¸­é†«çš„è­‰å‹åˆ†æç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "tongue_pulse_terms",
      "zangfu_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "treatment_terms",
      "full_text"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 13:37:41 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œèˆ‡ä¸­é†«çš„è­‰å‹åˆ†æç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "tongue_pulse_terms",
      "zangfu_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "treatment_terms",
      "full_text"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œç³»çµ±å°‡é€²è¡Œä¸­é†«è­‰å‹åˆ†æã€‚"
}
2025-11-04 13:37:41 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 13:37:41 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 13:37:41 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.89719427'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.89719427, '_attr_score': 0.0, '_final_score': 0.89719427}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.50715905'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.50715905, '_attr_score': 0.0, '_final_score': 0.50715905}]
2025-11-04 13:37:41 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚
2025-11-04 13:37:41 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚', 'symptom_terms': ['èƒƒè„˜è„¹ç—›', 'å—³æ°£', 'æ—©é£½', 'å£è‹¦'], 'tongue_terms': ['èˆŒç´…', 'è‹”é»ƒè†©', 'è„ˆå¼¦æ»‘'], 'pulse_terms': ['èˆŒç´…', 'è‹”é»ƒè†©', 'è„ˆå¼¦æ»‘'], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.89719427'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.89719427, '_attr_score': 0.0, '_final_score': 0.89719427}]
2025-11-04 14:37:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 14:37:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 14:37:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 14:37:31 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 14:37:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 14:37:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 14:37:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 14:37:31 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 14:37:33 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 14:37:33 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 14:37:33 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 14:37:33 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 14:37:33 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 14:37:33 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 14:37:33 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 14:37:33 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 14:37:33 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 14:37:33 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 14:37:33 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 14:37:33 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 14:37:33 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 14:37:39 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 14:37:39 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "treatment_terms",
      "full_text"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 14:37:39 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¿ƒæ‚¸ã€å¤±çœ ã€é£Ÿæ¬²ä¸æŒ¯ç­‰ç—‡ç‹€ï¼Œä¸¦æåˆ°äº†èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "treatment_terms",
      "full_text"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 14:37:41 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 14:37:41 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 14:37:41 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.98306394'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.98306394, '_attr_score': 0.0, '_final_score': 0.98306394}, {'_additional': {'distance': None, 'score': '0.9463664'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.9463664, '_attr_score': 0.0, '_final_score': 0.9463664}, {'_additional': {'distance': None, 'score': '0.86615515'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.86615515, '_attr_score': 0.0, '_final_score': 0.86615515}]
2025-11-04 14:37:41 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.98306394'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.98306394, '_attr_score': 0.0, '_final_score': 0.98306394}, {'_additional': {'distance': None, 'score': '0.9463664'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.9463664, '_attr_score': 0.0, '_final_score': 0.9463664}, {'_additional': {'distance': None, 'score': '0.86615515'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.86615515, '_attr_score': 0.0, '_final_score': 0.86615515}]
2025-11-04 14:38:16 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 14:38:21 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 14:38:21 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œéœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "treatment_terms",
      "full_text"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
}
2025-11-04 14:38:21 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œéœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "treatment_terms",
      "full_text"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
}
2025-11-04 14:38:22 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 14:38:22 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 14:38:22 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.93452287'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.93452287, '_attr_score': 0.0, '_final_score': 0.93452287}, {'_additional': {'distance': None, 'score': '0.8048727'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.8048727, '_attr_score': 0.0, '_final_score': 0.8048727}, {'_additional': {'distance': None, 'score': '0.6675158'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6675158, '_attr_score': 0.0, '_final_score': 0.6675158}]
2025-11-04 14:38:22 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.93452287'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.93452287, '_attr_score': 0.0, '_final_score': 0.93452287}, {'_additional': {'distance': None, 'score': '0.8048727'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.8048727, '_attr_score': 0.0, '_final_score': 0.8048727}, {'_additional': {'distance': None, 'score': '0.6675158'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6675158, '_attr_score': 0.0, '_final_score': 0.6675158}]
2025-11-04 14:39:12 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 14:39:17 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 14:39:17 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œéœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "treatment_terms",
      "full_text"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
}
2025-11-04 14:39:17 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œéœ€è¦é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "treatment_terms",
      "full_text"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œè¾¨è­‰ã€‚"
}
2025-11-04 14:39:19 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 14:39:19 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 14:39:19 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.76743287'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.76743287, '_attr_score': 0.0, '_final_score': 0.76743287}, {'_additional': {'distance': None, 'score': '0.57083267'}, 'case_id': 'CASE_20251005211351_C309_a4c59017', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'ä¸å¯ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›', 'è¡€è™›', 'è™›è­‰', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹', 'è™›è­‰'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'è‰²æ·¡', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å¿ƒè„¾'], '_confidence': 0.57083267, '_attr_score': 0.0, '_final_score': 0.57083267}, {'_additional': {'distance': None, 'score': '0.56749415'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.56749415, '_attr_score': 0.0, '_final_score': 0.56749415}]
2025-11-04 14:39:19 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.76743287'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.76743287, '_attr_score': 0.0, '_final_score': 0.76743287}, {'_additional': {'distance': None, 'score': '0.57083267'}, 'case_id': 'CASE_20251005211351_C309_a4c59017', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'ä¸å¯ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›', 'è¡€è™›', 'è™›è­‰', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹', 'è™›è­‰'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'è‰²æ·¡', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å¿ƒè„¾'], '_confidence': 0.57083267, '_attr_score': 0.0, '_final_score': 0.57083267}, {'_additional': {'distance': None, 'score': '0.56749415'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.56749415, '_attr_score': 0.0, '_final_score': 0.56749415}]
2025-11-04 14:40:02 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 14:40:06 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 14:40:06 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 14:40:06 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 14:40:07 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 14:40:08 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 14:40:08 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.4975184'}, 'case_id': 'CASE_20251005212258_G890_85162320', 'chief_complaint': 'ç™½å¸¶é‡å¤šè‰²é»ƒä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¸¶é‡', 'èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'æ²¹è†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶é™¤è‡­', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ½”', 'è†½ç€‰'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°', 'è†½ç€‰', 'è‚æ¹¯'], '_confidence': 0.4975184, '_attr_score': 0.0, '_final_score': 0.4975184}, {'_additional': {'distance': None, 'score': '0.43047488'}, 'case_id': 'CASE_20251005211411_P773_ac7de918', 'chief_complaint': 'ç¶“è¡Œé ­ç—›ä¸€å¹´', 'diagnosis': 'ç¶“è¡Œé ­ç—›ï¼ˆè‚é¬±æ°£æ»¯ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è‚æ°£é¬±çµ'], 'symptom_terms': ['é ­ç—›', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['åé»ƒ', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'ç–è‚ç†æ°£ï¼Œæ´»è¡€æ­¢ç—›', 'treatment_terms': [], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚é¬±', 'è‚æ°£é¬±çµ', 'ç–è‚ç†æ°£'], '_confidence': 0.43047488, '_attr_score': 0.0, '_final_score': 0.43047488}]
2025-11-04 14:40:08 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ
2025-11-04 14:40:08 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ', 'symptom_terms': ['èƒƒè„˜è„¹ç—›', 'å—³æ°£', 'æ—©é£½'], 'tongue_terms': [], 'pulse_terms': [], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.4975184'}, 'case_id': 'CASE_20251005212258_G890_85162320', 'chief_complaint': 'ç™½å¸¶é‡å¤šè‰²é»ƒä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¸¶é‡', 'èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'æ²¹è†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶é™¤è‡­', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ½”', 'è†½ç€‰'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°', 'è†½ç€‰', 'è‚æ¹¯'], '_confidence': 0.4975184, '_attr_score': 0.0, '_final_score': 0.4975184}]
2025-11-04 14:40:56 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 14:41:01 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 14:41:01 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œè¡¨æ˜æ˜¯ä¸­é†«è¨ºæ–·ç›¸é—œçš„è«‹æ±‚ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 14:41:01 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œè¡¨æ˜æ˜¯ä¸­é†«è¨ºæ–·ç›¸é—œçš„è«‹æ±‚ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 14:41:01 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 14:41:01 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 14:41:01 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.8363438'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.8363438, '_attr_score': 0.0, '_final_score': 0.8363438}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.45252484'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.45252484, '_attr_score': 0.0, '_final_score': 0.45252484}]
2025-11-04 14:41:01 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚
2025-11-04 14:41:01 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚', 'symptom_terms': ['èƒƒè„˜è„¹ç—›', 'å—³æ°£', 'æ—©é£½', 'æƒ…ç·’ç·Šå¼µ', 'å£è‹¦'], 'tongue_terms': [], 'pulse_terms': [], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.8363438'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.8363438, '_attr_score': 0.0, '_final_score': 0.8363438}]
2025-11-04 14:41:53 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 14:41:58 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 14:41:58 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒè±¡ã€è„ˆè±¡å’Œä¸»è¨´ç—‡ç‹€ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "treatment_terms",
      "full_text"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 14:41:58 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒè±¡ã€è„ˆè±¡å’Œä¸»è¨´ç—‡ç‹€ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "search_strategy": "exact",
    "search_fields": [
      "symptom_terms",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "chief_complaint"
    ],
    "properties": [
      "case_id",
      "chief_complaint",
      "symptom_terms",
      "syndrome_terms",
      "diagnosis",
      "treatment_principle",
      "tongue_terms",
      "pulse_terms",
      "zangfu_terms",
      "treatment_terms",
      "full_text"
    ]
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 14:41:58 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 14:41:58 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 14:41:58 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.89719427'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.89719427, '_attr_score': 0.0, '_final_score': 0.89719427}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.50715905'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.50715905, '_attr_score': 0.0, '_final_score': 0.50715905}]
2025-11-04 14:41:58 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚
2025-11-04 14:41:58 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚', 'symptom_terms': ['èƒƒè„˜è„¹ç—›', 'å—³æ°£', 'æ—©é£½', 'å£è‹¦'], 'tongue_terms': ['èˆŒç´…', 'è‹”é»ƒè†©', 'è„ˆå¼¦æ»‘'], 'pulse_terms': ['èˆŒç´…', 'è‹”é»ƒè†©', 'è„ˆå¼¦æ»‘'], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.89719427'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.89719427, '_attr_score': 0.0, '_final_score': 0.89719427}]
2025-11-04 15:52:22 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥è­‰å‹è¦å‰‡: 12 ç¨®
2025-11-04 15:52:22 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥é«”è³ªåˆ†é¡: 9 ç¨®
2025-11-04 15:52:22 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥ç—…æ©Ÿæ¨¡å¼åº«
2025-11-04 15:52:22 - s_cbr.KnowledgeLoader - INFO - âœ… è¼‰å…¥æ²»å‰‡æ²»æ³•åº«
2025-11-04 15:52:22 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥åœç”¨è©: 39 å€‹
2025-11-04 15:52:22 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥ TCM é—œéµè©: 89 å€‹
2025-11-04 15:52:22 - s_cbr.knowledge.TCMConfig - INFO - âœ… è¼‰å…¥è­‰å‹é—œéµè©: 12 ç¨®
2025-11-04 15:52:22 - s_cbr.knowledge.TCMConfig - INFO - âœ… TCM é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 15:52:24 - s_cbr.SCBREngine - INFO - âœ… ç­–ç•¥å±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 15:52:25 - s_cbr.SCBREngine - INFO - âœ… ç”Ÿæˆå±¤é…ç½®è¼‰å…¥æˆåŠŸ
2025-11-04 15:52:25 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 15:52:25 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 15:52:25 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 15:52:25 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 15:52:25 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 15:52:25 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 15:52:25 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 15:52:25 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 15:52:25 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 15:52:25 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 15:52:25 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 15:52:29 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 15:52:29 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†è‡ªå·±çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†å»ºè­°ã€‚"
}
2025-11-04 15:52:29 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†è‡ªå·±çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€åƒä¸å¤ªä¸‹ã€èˆŒæ·¡ã€è„ˆç´°å¼±ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "åƒä¸å¤ªä¸‹"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·å’Œèª¿ç†å»ºè­°ã€‚"
}
2025-11-04 15:52:31 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 15:52:31 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 15:52:31 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.98306394'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.98306394, '_attr_score': 0.0, '_final_score': 0.98306394}, {'_additional': {'distance': None, 'score': '0.9463664'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.9463664, '_attr_score': 0.0, '_final_score': 0.9463664}, {'_additional': {'distance': None, 'score': '0.86615515'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.86615515, '_attr_score': 0.0, '_final_score': 0.86615515}]
2025-11-04 15:52:31 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.98306394'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.98306394, '_attr_score': 0.0, '_final_score': 0.98306394}, {'_additional': {'distance': None, 'score': '0.9463664'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.9463664, '_attr_score': 0.0, '_final_score': 0.9463664}, {'_additional': {'distance': None, 'score': '0.86615515'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.86615515, '_attr_score': 0.0, '_final_score': 0.86615515}]
2025-11-04 15:53:23 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 15:53:27 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 15:53:27 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 15:53:27 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¾¨è­‰ã€‚"
}
2025-11-04 15:53:28 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 15:53:28 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 15:53:28 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.93452287'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.93452287, '_attr_score': 0.0, '_final_score': 0.93452287}, {'_additional': {'distance': None, 'score': '0.8048727'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.8048727, '_attr_score': 0.0, '_final_score': 0.8048727}, {'_additional': {'distance': None, 'score': '0.6675158'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6675158, '_attr_score': 0.0, '_final_score': 0.6675158}]
2025-11-04 15:53:28 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.93452287'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.93452287, '_attr_score': 0.0, '_final_score': 0.93452287}, {'_additional': {'distance': None, 'score': '0.8048727'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.8048727, '_attr_score': 0.0, '_final_score': 0.8048727}, {'_additional': {'distance': None, 'score': '0.6675158'}, 'case_id': 'CASE_20251005212248_U678_17f9e6cd', 'chief_complaint': 'å¤±çœ ç„¦æ…®å…©æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¤©', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒç…©', 'å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.6675158, '_attr_score': 0.0, '_final_score': 0.6675158}]
2025-11-04 15:54:20 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 15:54:25 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 15:54:25 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "æ™šä¸Šå®¹æ˜“é†’ä¾†",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 15:54:25 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šå°ä¾¿æ¸…é•·ã€æ€•å†·ã€ç™½å¸¶é‡å¤šã€‚",
    "history_summary": "é€™é™£å­å¸¸å¸¸å¿ƒæ‚¸å¤±çœ ï¼Œåƒä¸å¤ªä¸‹ï¼ŒèˆŒæ·¡ï¼Œè„ˆç´°å¼±ï¼Œéœ€è¦çœ‹ä¸­é†«èª¿ç†å—ï¼Ÿ\nè£œå……ï¼šæ™šä¸Šç‰¹åˆ¥å®¹æ˜“é†’ä¾†è€Œä¸”æœƒç›œæ±—ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†å¤šå€‹èˆ‡ä¸­é†«ç›¸é—œçš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬å¿ƒæ‚¸ã€å¤±çœ ã€èˆŒæ·¡ã€è„ˆç´°å¼±ç­‰ï¼Œè¡¨æ˜éœ€è¦ä¸­é†«è¨ºæ–·å’Œèª¿ç†ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "å¿ƒæ‚¸",
      "å¤±çœ ",
      "èˆŒæ·¡",
      "è„ˆç´°å¼±",
      "å°ä¾¿æ¸…é•·",
      "æ€•å†·",
      "ç™½å¸¶é‡å¤š",
      "æ™šä¸Šå®¹æ˜“é†’ä¾†",
      "ç›œæ±—"
    ],
    "tongue_pulse_terms": [
      "èˆŒæ·¡",
      "è„ˆç´°å¼±"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 15:54:26 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 15:54:26 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 15:54:26 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.86647046'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.86647046, '_attr_score': 0.0, '_final_score': 0.86647046}, {'_additional': {'distance': None, 'score': '0.68827724'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.68827724, '_attr_score': 0.0, '_final_score': 0.68827724}, {'_additional': {'distance': None, 'score': '0.64937186'}, 'case_id': 'CASE_20251005211351_C309_a4c59017', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'ä¸å¯ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›', 'è¡€è™›', 'è™›è­‰', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹', 'è™›è­‰'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'è‰²æ·¡', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å¿ƒè„¾'], '_confidence': 0.64937186, '_attr_score': 0.0, '_final_score': 0.64937186}]
2025-11-04 15:54:26 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.86647046'}, 'case_id': 'CASE_20251005212239_M890_ebf84a5e', 'chief_complaint': 'ç„¦æ…®å¤±çœ ä¸€æœˆ', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè…ä¸äº¤ï¼‰', 'pulse_terms': ['ç·Šå¼µ', 'è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['å¾®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'è–„é»ƒ'], 'treatment_principle': 'æ»‹é™°é™ç«ï¼Œäº¤é€šå¿ƒè…', 'treatment_terms': ['äº¤é€š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè…'], '_confidence': 0.86647046, '_attr_score': 0.0, '_final_score': 0.86647046}, {'_additional': {'distance': None, 'score': '0.68827724'}, 'case_id': 'CASE_20251005212254_D567_d31d0467', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'å¤±çœ ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°å¼±', 'æ²‰å¼±', 'å…©è™›', 'è™›æ'], 'symptom_terms': ['å¤±çœ '], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè„¾'], '_confidence': 0.68827724, '_attr_score': 0.0, '_final_score': 0.68827724}, {'_additional': {'distance': None, 'score': '0.64937186'}, 'case_id': 'CASE_20251005211351_C309_a4c59017', 'chief_complaint': 'å¤±çœ å¤šå¤¢åŠå¹´', 'diagnosis': 'ä¸å¯ï¼ˆå¿ƒè„¾å…©è™›ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'ç´°æ•¸', 'ç´°å¼±', 'é™°è™›', 'è¡€è™›', 'è™›è­‰', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å…©è™›'], 'symptom_terms': ['å¤±çœ ', 'ç›œæ±—'], 'syndrome_terms': ['è­‰å‹', 'è™›è­‰'], 'tongue_terms': ['èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'è‰²æ·¡', 'æ¸…æ·¡'], 'treatment_principle': 'è£œç›Šå¿ƒè„¾ï¼Œé¤Šè¡€å®‰ç¥', 'treatment_terms': ['è£œç›Š', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒæ‚¸', 'å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'å¿ƒè¡€è™›', 'è„¾æ°£è™›', 'å¿ƒè„¾'], '_confidence': 0.64937186, '_attr_score': 0.0, '_final_score': 0.64937186}]
2025-11-04 15:55:19 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 15:55:22 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 15:55:22 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 15:55:22 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ",
    "history_summary": ""
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 15:55:24 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 15:55:24 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 15:55:24 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.4975184'}, 'case_id': 'CASE_20251005212258_G890_85162320', 'chief_complaint': 'ç™½å¸¶é‡å¤šè‰²é»ƒä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¸¶é‡', 'èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'æ²¹è†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶é™¤è‡­', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ½”', 'è†½ç€‰'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°', 'è†½ç€‰', 'è‚æ¹¯'], '_confidence': 0.4975184, '_attr_score': 0.0, '_final_score': 0.4975184}, {'_additional': {'distance': None, 'score': '0.43047488'}, 'case_id': 'CASE_20251005211411_P773_ac7de918', 'chief_complaint': 'ç¶“è¡Œé ­ç—›ä¸€å¹´', 'diagnosis': 'ç¶“è¡Œé ­ç—›ï¼ˆè‚é¬±æ°£æ»¯ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è‚æ°£é¬±çµ'], 'symptom_terms': ['é ­ç—›', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['åé»ƒ', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½'], 'treatment_principle': 'ç–è‚ç†æ°£ï¼Œæ´»è¡€æ­¢ç—›', 'treatment_terms': [], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚é¬±', 'è‚æ°£é¬±çµ', 'ç–è‚ç†æ°£'], '_confidence': 0.43047488, '_attr_score': 0.0, '_final_score': 0.43047488}]
2025-11-04 15:55:24 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ
2025-11-04 15:55:24 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ', 'symptom_terms': ['èƒƒè„˜è„¹ç—›', 'å—³æ°£', 'æ—©é£½'], 'tongue_terms': [], 'pulse_terms': [], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.4975184'}, 'case_id': 'CASE_20251005212258_G890_85162320', 'chief_complaint': 'ç™½å¸¶é‡å¤šè‰²é»ƒä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['ç™½å¸¶é‡', 'èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'æ²¹è†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶é™¤è‡­', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ½”', 'è†½ç€‰'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°', 'è†½ç€‰', 'è‚æ¹¯'], '_confidence': 0.4975184, '_attr_score': 0.0, '_final_score': 0.4975184}]
2025-11-04 15:56:12 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 15:56:16 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 15:56:16 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ"
    ],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„è£œå……ç—‡ç‹€ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 15:56:16 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "è£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ç—‡ç‹€ï¼ŒåŒ…æ‹¬èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ã€æƒ…ç·’ç·Šå¼µå’Œå£è‹¦ï¼Œèˆ‡ä¸­é†«è¨ºæ–·ç›¸é—œã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "æƒ…ç·’ç·Šå¼µ",
      "å£è‹¦"
    ],
    "tongue_pulse_terms": [],
    "zangfu_terms": [
      "èƒƒ"
    ],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„è£œå……ç—‡ç‹€ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·è¼”åŠ©ã€‚"
}
2025-11-04 15:56:16 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 15:56:16 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 15:56:16 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.86522675'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.86522675, '_attr_score': 0.0, '_final_score': 0.86522675}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.5251382'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.5251382, '_attr_score': 0.0, '_final_score': 0.5251382}]
2025-11-04 15:56:16 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.86522675'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.86522675, '_attr_score': 0.0, '_final_score': 0.86522675}, {'_additional': {'distance': None, 'score': '0.5251382'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.5251382, '_attr_score': 0.0, '_final_score': 0.5251382}]
2025-11-04 15:56:25 - s_cbr.KnowledgeLoader - WARNING - âš ï¸  æ–‡ä»¶ä¸å­˜åœ¨: C:\work\ç³»çµ±-ä¸­é†«\Pulse-project\Backend\s_cbr\knowledge\syndromes.yaml
2025-11-04 15:56:25 - s_cbr.KnowledgeLoader - ERROR - âŒ çŸ¥è­˜åº«è¼‰å…¥å¤±æ•—: 'syndromes'
2025-11-04 15:56:25 - root - WARNING - âš ï¸ TCM é…ç½®è¼‰å…¥å¤±æ•—: 'syndromes'ï¼Œä½¿ç”¨é è¨­é…ç½®
2025-11-04 15:56:27 - s_cbr.SCBREngine - ERROR - âŒ ç­–ç•¥å±¤é…ç½®è¼‰å…¥å¤±æ•—: [Errno 2] No such file or directory: 'C:\\work\\ç³»çµ±-ä¸­é†«\\Pulse-project\\Backend\\s_cbr\\strategy_layer.yaml'
2025-11-04 15:56:27 - s_cbr.SCBREngine - WARNING - âš ï¸ ç”Ÿæˆå±¤é…ç½®è¼‰å…¥å¤±æ•—: [Errno 2] No such file or directory: 'C:\\work\\ç³»çµ±-ä¸­é†«\\Pulse-project\\Backend\\s_cbr\\generation_layer.yaml'
2025-11-04 15:56:27 - s_cbr.RateLimiter - INFO - âœ… RateLimiter åˆå§‹åŒ–å®Œæˆ
2025-11-04 15:56:27 - s_cbr.SCBREngine - INFO - âœ… RateLimiter åˆå§‹åŒ–æˆåŠŸ
2025-11-04 15:56:27 - s_cbr.SCBREngine - INFO - âœ… å®‰å…¨æ¨¡çµ„åˆå§‹åŒ–å®Œæˆ
2025-11-04 15:56:27 - s_cbr.DialogManager - INFO - âœ… å°è©±ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ (max_sessions=100)
2025-11-04 15:56:27 - s_cbr.LLMClient - INFO - âœ… LLMå®¢æˆ¶ç«¯åˆå§‹åŒ–: model=meta/llama-3.3-70b-instruct, max_tokens=2000, timeout=30.0s
2025-11-04 15:56:27 - s_cbr.SCBREngine - INFO - âœ… LLM å®¢æˆ¶ç«¯åˆå§‹åŒ–æˆåŠŸ
2025-11-04 15:56:27 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 15:56:27 - s_cbr.SCBREngine - INFO - âœ… å››å±¤ SCBR ç®¡ç·šåˆå§‹åŒ–å®Œæˆ
2025-11-04 15:56:27 - s_cbr.SCBREngine - INFO - âœ… S-CBR Engine åˆå§‹åŒ–å®Œæˆ (å«å®‰å…¨é˜²è­·)
2025-11-04 15:56:28 - s_cbr.backend.main - INFO - ğŸš€ TCM S-CBR Backend v2.2 å•Ÿå‹•
2025-11-04 15:56:28 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 15:56:28 - s_cbr.backend.main - INFO - ğŸ“¦ å·²è¼‰å…¥æ¨¡çµ„:
2025-11-04 15:56:28 - s_cbr.backend.main - INFO -    âœ… S-CBR èºæ—‹æ¨ç†å¼•æ“
2025-11-04 15:56:28 - s_cbr.backend.main - INFO -    âœ… ANC ç—…ä¾‹ç®¡ç†ç³»çµ±
2025-11-04 15:56:28 - s_cbr.backend.main - INFO - 
2025-11-04 15:56:28 - s_cbr.backend.main - INFO - ğŸ”— å¯ç”¨ç«¯é»:
2025-11-04 15:56:28 - s_cbr.backend.main - INFO -    - èºæ—‹æ¨ç†: /api/scbr/v2/*
2025-11-04 15:56:28 - s_cbr.backend.main - INFO -    - ç—…ä¾‹ä¿å­˜: POST /api/case/save
2025-11-04 15:56:28 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æŸ¥è©¢: GET /api/case/get/{case_id}
2025-11-04 15:56:28 - s_cbr.backend.main - INFO -    - ç—…ä¾‹æœç´¢: POST /api/case/search
2025-11-04 15:56:28 - s_cbr.backend.main - INFO -    - ç—…ä¾‹çµ±è¨ˆ: GET /api/case/stats
2025-11-04 15:56:28 - s_cbr.backend.main - INFO -    - å¥åº·æª¢æŸ¥: GET /healthz
2025-11-04 15:56:28 - s_cbr.backend.main - INFO - ============================================================
2025-11-04 15:56:29 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/meta "HTTP/1.1 200 OK"
2025-11-04 15:56:30 - httpx - INFO - HTTP Request: GET https://pypi.org/pypi/weaviate-client/json "HTTP/1.1 200 OK"
2025-11-04 15:56:30 - httpx - INFO - HTTP Request: GET http://localhost:8080/v1/schema/TCMCase "HTTP/1.1 200 OK"
2025-11-04 15:56:30 - s_cbr.backend.main - INFO - âœ… ANC ç—…ä¾‹è™•ç†å™¨åˆå§‹åŒ–æˆåŠŸ
2025-11-04 15:57:08 - s_cbr.SearchEngine - INFO - [SearchEngine] Connected to Weaviate
2025-11-04 15:57:13 - s_cbr.LLMClient - WARNING - âš ï¸ è¼¸å‡ºéæ¿¾ï¼šæª¢æ¸¬åˆ° 1 è™•æ•æ„Ÿè³‡è¨Š
2025-11-04 15:57:13 - s_cbr.FourLayerPipeline - INFO - [L1 BEFORE FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œè¡¨æ˜æ˜¯ä¸€å€‹ä¸­é†«è¨ºæ–·çš„è«‹æ±‚ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "system_prompt_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦",
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·åˆ†æã€‚"
}
2025-11-04 15:57:13 - s_cbr.FourLayerPipeline - INFO - [L1 AFTER  FILTER]
{
  "layer": "L1_GATE",
  "status": "ok",
  "input": {
    "user_query": "å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚",
    "history_summary": "é€™ä¸€å‘¨ç¸½æ˜¯èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ï¼Œè«‹å•å¯èƒ½æ˜¯ä»€éº¼åŸå› ï¼Ÿ\nè£œå……ï¼šæƒ…ç·’ç·Šå¼µæ™‚æ›´æ˜é¡¯ï¼Œä¸¦ä¸”è¦ºå¾—å£è‹¦ã€‚"
  },
  "task_recognition": {
    "is_tcm_task": true,
    "tcm_task_type": "diagnosis",
    "reason": "ä½¿ç”¨è€…æè¿°äº†æ˜é¡¯çš„ä¸­é†«ç—‡ç‹€ï¼ŒåŒ…æ‹¬èˆŒç´…è‹”é»ƒè†©ã€è„ˆå¼¦æ»‘ã€èƒƒè„˜è„¹ç—›ã€å—³æ°£ã€æ—©é£½ç­‰ï¼Œä¸”æåˆ°äº†æƒ…ç·’ç·Šå¼µå’Œå£è‹¦çš„ç—‡ç‹€ï¼Œè¡¨æ˜æ˜¯ä¸€å€‹ä¸­é†«è¨ºæ–·çš„è«‹æ±‚ã€‚"
  },
  "owasp_screening": {
    "prompt_injection_detected": false,
    "sensitive_info_request": false,
    "[ç³»çµ±è³‡è¨Šå·²éš±è—]_leak_attempt": false,
    "excessive_agency_attempt": false,
    "unbounded_consumption_risk": "low",
    "flags": []
  },
  "keyword_plan": {
    "symptom_terms": [
      "èƒƒè„˜è„¹ç—›",
      "å—³æ°£",
      "æ—©é£½",
      "å£è‹¦",
      "æƒ…ç·’ç·Šå¼µ"
    ],
    "tongue_pulse_terms": [
      "èˆŒç´…",
      "è‹”é»ƒè†©",
      "è„ˆå¼¦æ»‘"
    ],
    "zangfu_terms": [],
    "other_terms": [],
    "search_strategy": "exact"
  },
  "next_action": "vector_search",
  "message_to_user": "å·²æ”¶åˆ°æ‚¨çš„ç—‡ç‹€æè¿°ï¼Œå°‡é€²è¡Œä¸­é†«è¨ºæ–·åˆ†æã€‚"
}
2025-11-04 15:57:13 - s_cbr.SearchEngine - INFO - ğŸ” TCMCase HYBRID Î±=0.55, qdim=1024, fields=['full_text'], props=['case_id', 'chief_complaint', 'symptom_terms', 'syndrome_terms', 'diagnosis', 'treatment_principle', 'tongue_terms', 'pulse_terms', 'zangfu_terms', 'treatment_terms', 'full_text']
2025-11-04 15:57:13 - s_cbr.SearchEngine - INFO - ğŸ“Š TCMCase æœç´¢: 3 å€‹çµæœ
2025-11-04 15:57:13 - s_cbr.FourLayerPipeline - INFO - [Retrieval RAW] count=3 samples=[{'_additional': {'distance': None, 'score': '0.9016588'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.9016588, '_attr_score': 0.0, '_final_score': 0.9016588}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}, {'_additional': {'distance': None, 'score': '0.52707833'}, 'case_id': 'CASE_20251005211452_V660_e85bde57', 'chief_complaint': 'å¤šé£²å¤šå°¿ä¸‰æœˆ', 'diagnosis': 'æ¶ˆæ¸´ï¼ˆé™°è™›ç‡¥ç†±ï¼‰', 'pulse_terms': ['é »æ•¸é‡', 'è„ˆè±¡', 'ç´°æ•¸', 'é™°è™›', 'è…é™°è™›'], 'symptom_terms': ['å¤šæ±—', 'ç†±è­‰', 'ç‡¥ç†±', 'æ¸…ç†±'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰', 'æ¶ˆæ¸´'], 'tongue_terms': ['æ½®ç´…', 'èˆŒé«”', 'èˆŒè‹”', 'å°‘è‹”'], 'treatment_principle': 'æ»‹é™°æ¸…ç†±ï¼Œç”Ÿæ´¥æ­¢æ¸´', 'treatment_terms': ['æ¸…ç†±'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è…é™°è™›'], '_confidence': 0.52707833, '_attr_score': 0.0, '_final_score': 0.52707833}]
2025-11-04 15:57:13 - s_cbr.FourLayerPipeline - WARNING - Cross-domain retrieval: injected virtual case for query=å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚
2025-11-04 15:57:13 - s_cbr.FourLayerPipeline - INFO - [Retrieval AFTER ASSEMBLY] used=[{'case_id': 'VIRTUAL_FROM_QUERY', '_confidence': 1.0, '_attr_score': 0.0, '_final_score': 1.0, 'chief_complaint': 'å†è£œå……ï¼šèˆŒç´…è‹”é»ƒè†©ï¼Œè„ˆå¼¦æ»‘ã€‚', 'symptom_terms': ['èƒƒè„˜è„¹ç—›', 'å—³æ°£', 'æ—©é£½', 'å£è‹¦', 'æƒ…ç·’ç·Šå¼µ'], 'tongue_terms': ['èˆŒç´…', 'è‹”é»ƒè†©', 'è„ˆå¼¦æ»‘'], 'pulse_terms': ['èˆŒç´…', 'è‹”é»ƒè†©', 'è„ˆå¼¦æ»‘'], 'diagnosis': 'å¾…è¾¨', 'treatment_principle': 'ä¾ä½¿ç”¨è€…ä¸»è¨´æ¨ä¼°ï¼Œéœ€ä¸­é†«å¸«é¢è¨ºç¢ºèª'}, {'_additional': {'distance': None, 'score': '0.9016588'}, 'case_id': 'CASE_20251005212223_B789_ba5c9599', 'chief_complaint': 'æœˆç¶“æ¨é²å…©æœˆ', 'diagnosis': 'æœˆç¶“ä¸èª¿', 'pulse_terms': ['æ¨é²', 'ç·Šå¼µ', 'è„ˆè±¡', 'æ²‰å¼±', 'ç´°å¼±', 'è¡€è™›', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›'], 'symptom_terms': ['éš±ç—›', 'ç•å¯’', 'æ­¢ç—›'], 'syndrome_terms': ['è­‰å‹'], 'tongue_terms': ['è’¼ç™½', 'èˆŒé«”', 'æ·¡ç´…', 'èˆŒè‹”', 'è–„ç™½', 'ç™½èŠ'], 'treatment_principle': 'é¤Šè¡€ç–è‚ï¼Œèª¿ç¶“æ­¢ç—›', 'treatment_terms': ['æœˆç¶“ä¸èª¿', 'èª¿ç¶“', 'è£œè¡€'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è‚æ°£é¬±çµ', 'è„¾æ°£è™›', 'ç–è‚', 'å¿ƒæƒ…'], '_confidence': 0.9016588, '_attr_score': 0.0, '_final_score': 0.9016588}, {'_additional': {'distance': None, 'score': '0.55'}, 'case_id': 'CASE_20251005211358_G619_dcec38d9', 'chief_complaint': 'å¸¶ä¸‹é‡å¤šä¸€æœˆ', 'diagnosis': 'å¸¶ä¸‹ç—…ï¼ˆæ¿•ç†±ä¸‹æ³¨ï¼‰', 'pulse_terms': ['è„ˆè±¡', 'æ»‘æ•¸', 'è„¾è™›æ¿•å›°'], 'symptom_terms': ['æ¿•ç†±', 'ç†±è­‰', 'æ¸…ç†±åˆ©æ¿•'], 'syndrome_terms': ['è­‰å‹', 'ç†±è­‰'], 'tongue_terms': ['èˆŒé«”', 'èˆŒè‹”', 'é»ƒè†©', 'è‰²é»ƒ', 'æ¸…æ·¡', 'å°‘ç”œè†©'], 'treatment_principle': 'æ¸…ç†±åˆ©æ¿•ï¼Œæ­¢å¸¶', 'treatment_terms': ['æ¸…ç†±åˆ©æ¿•', 'æ¸…æ·¡'], 'zangfu_terms': ['å¿ƒ', 'è‚è†½', 'è…', 'è‚º', 'è„¾èƒƒ', 'è„¾è™›æ¿•å›°'], '_confidence': 0.55, '_attr_score': 0.0, '_final_score': 0.55}]
