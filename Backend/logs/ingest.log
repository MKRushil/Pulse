2025-09-29 00:02:41,884 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:02:41,887 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:02:41,887 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:02:45,444 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:02:45,449 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:02:45,449 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:02:45,449 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:02:45,449 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:02:45,449 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:02:45,451 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:02:45,451 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:02:45,451 [INFO] backend.main - Application startup completed.
2025-09-29 00:05:31,714 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:05:31,715 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:05:31,715 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:05:35,398 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:05:35,401 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:05:35,402 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:05:35,402 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:05:35,402 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:05:35,402 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:05:35,402 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:05:35,402 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:05:35,402 [INFO] backend.main - Application startup completed.
2025-09-29 00:07:08,160 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:07:08,161 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:07:08,161 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:07:11,456 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:07:11,461 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:07:11,461 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:07:11,461 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:07:11,462 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:07:11,462 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:07:11,462 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:07:11,462 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:07:11,463 [INFO] backend.main - Application startup completed.
2025-09-29 00:07:34,812 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:07:34,812 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:07:34,812 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:07:45,986 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:07:45,989 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:07:45,989 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:07:45,989 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:07:45,990 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:07:45,991 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:07:45,991 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:07:45,991 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:07:45,991 [INFO] backend.main - Application startup completed.
2025-09-29 00:07:54,801 [ERROR] backend.main - /api/query payload debug type=dict, keys=['question', 'session_id', 'continue', 'patient_ctx']
2025-09-29 00:07:54,803 [INFO] s_cbr.SCBREngine - 🌀 啟動診斷 [SCBR-20250929-000754-42b677d4] 問題: 患者 67 歲 男，失眠多夢，左寸脈遲
2025-09-29 00:07:54,803 [INFO] s_cbr.DialogManager - 會話建立: 21e4de1e8e044786846afeb30568c74c
2025-09-29 00:07:54,803 [INFO] s_cbr.DialogManager - 會話建立: 21e4de1e8e044786846afeb30568c74c
2025-09-29 00:07:54,804 [INFO] s_cbr.DialogManager - 繼續會話: 21e4de1e8e044786846afeb30568c74c
2025-09-29 00:07:57,096 [INFO] s_cbr.SpiralEngine - 🧭 q_vector: dim=1024
2025-09-29 00:07:57,097 [WARNING] s_cbr.SearchEngine - ↯ Dropped non-GraphQL property names: ['辨證', '主診斷', '證型', '證候', '證名']
2025-09-29 00:07:57,128 [WARNING] s_cbr.SearchEngine - ↯ Dropped non-schema property names for Case: ['case_id', 'diagnosis', 'syndrome', 'pattern', 'gender', 'sex', 'age', 'pulse', 'maixiang', 'symptoms', 'chief_complaint', 'subjective', 'objective', 'assessment', 'tongue', 'coating', 'history', 'notes', 'source']
2025-09-29 00:07:57,128 [INFO] s_cbr.SearchEngine - 🔎 Case HYBRID α=0.5, qdim=1024, ‖v‖₂=0.9999
2025-09-29 00:07:57,129 [INFO] s_cbr.SearchEngine - ↪ return props=['diagnosis_main', 'pulse_text']... | search_fields=['search_all', 'search_all_seg']
2025-09-29 00:07:57,194 [INFO] s_cbr.SearchEngine - 📊 Case 搜索: 20 個結果
2025-09-29 00:07:57,194 [WARNING] s_cbr.SearchEngine - ↯ Dropped non-GraphQL property names: ['辨證', '主診斷', '證型', '證候', '證名']
2025-09-29 00:07:57,199 [WARNING] s_cbr.SearchEngine - ↯ Dropped non-schema property names for PulsePJV: ['case_id', 'diagnosis_main', 'diagnosis', 'syndrome', 'pattern', 'gender', 'sex', 'age', 'pulse', 'pulse_text', 'maixiang', 'chief_complaint', 'subjective', 'objective', 'assessment', 'tongue', 'coating', 'history', 'notes', 'source']
2025-09-29 00:07:57,199 [INFO] s_cbr.SearchEngine - 🔎 PulsePJV HYBRID α=0.5, qdim=1024, ‖v‖₂=0.9999
2025-09-29 00:07:57,199 [INFO] s_cbr.SearchEngine - ↪ return props=['symptoms']... | search_fields=['search_all', 'search_all_seg']
2025-09-29 00:07:57,264 [INFO] s_cbr.SearchEngine - 📊 PulsePJV 搜索: 20 個結果
2025-09-29 00:07:57,265 [WARNING] s_cbr.SearchEngine - ↯ Dropped non-GraphQL property names: ['辨證', '主診斷', '證型', '證候', '證名']
2025-09-29 00:07:57,267 [WARNING] s_cbr.SearchEngine - ↯ Dropped non-schema property names for RPCase: ['case_id', 'diagnosis_main', 'diagnosis', 'syndrome', 'pattern', 'gender', 'sex', 'age', 'pulse', 'pulse_text', 'maixiang', 'symptoms', 'chief_complaint', 'subjective', 'objective', 'assessment', 'tongue', 'coating', 'history', 'notes', 'source']
2025-09-29 00:07:57,269 [INFO] s_cbr.SearchEngine - 🔎 RPCase HYBRID α=0.5, qdim=1024, ‖v‖₂=0.9999
2025-09-29 00:07:57,269 [INFO] s_cbr.SearchEngine - ↪ return props=['final_diagnosis', 'pulse_tags', 'symptom_tags']... | search_fields=['search_all', 'search_all_seg']
2025-09-29 00:07:57,328 [INFO] s_cbr.SearchEngine - 📊 RPCase 搜索: 3 個結果
2025-09-29 00:07:57,328 [INFO] s_cbr.SpiralEngine - best_case keys (sample): ['_additional', 'diagnosis_main', 'pulse_text', '_confidence', '_attr_score', '_final_score']
2025-09-29 00:07:57,329 [INFO] s_cbr.DialogManager - 記錄輪次 1 結果於 21e4de1e8e044786846afeb30568c74c
2025-09-29 00:07:57,329 [INFO] s_cbr.SCBREngine - 🌀 啟動診斷 [SCBR-20250929-000757-6f25cad3] 問題: 患者 67 歲 男，失眠多夢，左寸脈遲
2025-09-29 00:07:57,329 [INFO] s_cbr.DialogManager - 會話建立: cad9f2bdde8c438da893670aa63bb28c
2025-09-29 00:07:57,329 [INFO] s_cbr.DialogManager - 會話建立: cad9f2bdde8c438da893670aa63bb28c
2025-09-29 00:07:57,329 [INFO] s_cbr.DialogManager - 繼續會話: cad9f2bdde8c438da893670aa63bb28c
2025-09-29 00:07:58,681 [INFO] s_cbr.SpiralEngine - 🧭 q_vector: dim=1024
2025-09-29 00:07:58,682 [WARNING] s_cbr.SearchEngine - ↯ Dropped non-GraphQL property names: ['辨證', '主診斷', '證型', '證候', '證名']
2025-09-29 00:07:58,686 [WARNING] s_cbr.SearchEngine - ↯ Dropped non-schema property names for Case: ['case_id', 'diagnosis', 'syndrome', 'pattern', 'gender', 'sex', 'age', 'pulse', 'maixiang', 'symptoms', 'chief_complaint', 'subjective', 'objective', 'assessment', 'tongue', 'coating', 'history', 'notes', 'source']
2025-09-29 00:07:58,686 [INFO] s_cbr.SearchEngine - 🔎 Case HYBRID α=0.5, qdim=1024, ‖v‖₂=0.9999
2025-09-29 00:07:58,686 [INFO] s_cbr.SearchEngine - ↪ return props=['diagnosis_main', 'pulse_text']... | search_fields=['search_all', 'search_all_seg']
2025-09-29 00:07:58,750 [INFO] s_cbr.SearchEngine - 📊 Case 搜索: 20 個結果
2025-09-29 00:07:58,751 [WARNING] s_cbr.SearchEngine - ↯ Dropped non-GraphQL property names: ['辨證', '主診斷', '證型', '證候', '證名']
2025-09-29 00:07:58,755 [WARNING] s_cbr.SearchEngine - ↯ Dropped non-schema property names for PulsePJV: ['case_id', 'diagnosis_main', 'diagnosis', 'syndrome', 'pattern', 'gender', 'sex', 'age', 'pulse', 'pulse_text', 'maixiang', 'chief_complaint', 'subjective', 'objective', 'assessment', 'tongue', 'coating', 'history', 'notes', 'source']
2025-09-29 00:07:58,755 [INFO] s_cbr.SearchEngine - 🔎 PulsePJV HYBRID α=0.5, qdim=1024, ‖v‖₂=0.9999
2025-09-29 00:07:58,756 [INFO] s_cbr.SearchEngine - ↪ return props=['symptoms']... | search_fields=['search_all', 'search_all_seg']
2025-09-29 00:07:58,812 [INFO] s_cbr.SearchEngine - 📊 PulsePJV 搜索: 20 個結果
2025-09-29 00:07:58,814 [WARNING] s_cbr.SearchEngine - ↯ Dropped non-GraphQL property names: ['辨證', '主診斷', '證型', '證候', '證名']
2025-09-29 00:07:58,819 [WARNING] s_cbr.SearchEngine - ↯ Dropped non-schema property names for RPCase: ['case_id', 'diagnosis_main', 'diagnosis', 'syndrome', 'pattern', 'gender', 'sex', 'age', 'pulse', 'pulse_text', 'maixiang', 'symptoms', 'chief_complaint', 'subjective', 'objective', 'assessment', 'tongue', 'coating', 'history', 'notes', 'source']
2025-09-29 00:07:58,820 [INFO] s_cbr.SearchEngine - 🔎 RPCase HYBRID α=0.5, qdim=1024, ‖v‖₂=0.9999
2025-09-29 00:07:58,820 [INFO] s_cbr.SearchEngine - ↪ return props=['final_diagnosis', 'pulse_tags', 'symptom_tags']... | search_fields=['search_all', 'search_all_seg']
2025-09-29 00:07:58,872 [INFO] s_cbr.SearchEngine - 📊 RPCase 搜索: 3 個結果
2025-09-29 00:07:58,874 [INFO] s_cbr.SpiralEngine - best_case keys (sample): ['_additional', 'diagnosis_main', 'pulse_text', '_confidence', '_attr_score', '_final_score']
2025-09-29 00:07:58,875 [INFO] s_cbr.DialogManager - 記錄輪次 1 結果於 cad9f2bdde8c438da893670aa63bb28c
2025-09-29 00:15:21,047 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:15:21,047 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:15:21,048 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:15:24,864 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:15:24,868 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:15:24,869 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:15:24,869 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:15:24,869 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:15:24,869 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:15:24,869 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:15:24,870 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:15:24,870 [INFO] backend.main - Application startup completed.
2025-09-29 00:30:41,016 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:30:41,016 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:30:41,016 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:30:44,512 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:30:44,515 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:30:44,515 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:30:44,516 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:30:44,516 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:30:44,516 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:30:44,516 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:30:44,516 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:30:44,517 [INFO] backend.main - Application startup completed.
2025-09-29 00:32:09,612 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:32:09,613 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:32:09,613 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:32:13,026 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:32:13,030 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:32:13,030 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:32:13,030 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:32:13,030 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:32:13,030 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:32:13,030 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:32:13,031 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:32:13,031 [INFO] backend.main - Application startup completed.
2025-09-29 00:36:10,432 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:36:10,433 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:36:10,433 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:36:14,175 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:36:14,179 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:36:14,179 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:36:14,179 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:36:14,180 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:36:14,180 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:36:14,180 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:36:14,180 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:36:14,180 [INFO] backend.main - Application startup completed.
2025-09-29 00:42:03,848 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:42:03,848 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:42:03,848 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:42:07,250 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:42:07,254 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:42:07,254 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:42:07,255 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:42:07,255 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:42:07,255 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:42:07,255 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:42:07,255 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:42:07,255 [INFO] backend.main - Application startup completed.
2025-09-29 00:45:03,339 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:45:03,340 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:45:03,340 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:45:06,874 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:45:06,876 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:45:06,876 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:45:06,876 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:45:06,876 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:45:06,876 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:45:06,876 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:45:06,876 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:45:06,877 [INFO] backend.main - Application startup completed.
2025-09-29 00:46:18,677 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:46:18,678 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:46:18,678 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:46:22,068 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:46:22,071 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:46:22,072 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:46:22,072 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:46:22,072 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:46:22,072 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:46:22,072 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:46:22,072 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:46:22,072 [INFO] backend.main - Application startup completed.
2025-09-29 00:50:40,784 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:50:40,784 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:50:40,785 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:50:44,489 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:50:44,494 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:50:44,494 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:50:44,494 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:50:44,495 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:50:44,495 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:50:44,495 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:50:44,496 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:50:44,496 [INFO] backend.main - Application startup completed.
2025-09-29 00:53:46,131 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:53:46,132 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:53:46,132 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:53:49,606 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:53:49,610 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:53:49,610 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:53:49,611 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:53:49,611 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:53:49,611 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:53:49,611 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:53:49,611 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:53:49,611 [INFO] backend.main - Application startup completed.
2025-09-29 00:54:08,733 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:54:08,733 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:54:08,733 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:54:21,549 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:54:21,552 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:54:21,552 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:54:21,552 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:54:21,554 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:54:21,554 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:54:21,554 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:54:21,554 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:54:21,555 [INFO] backend.main - Application startup completed.
2025-09-29 00:55:41,028 [ERROR] backend.main - /api/query payload debug type=dict, keys=['question', 'session_id', 'continue', 'patient_ctx']
2025-09-29 00:55:41,029 [INFO] s_cbr.SCBREngine - 🌀 啟動診斷 [SCBR-20250929-005541-2a14b687] 問題: 患者 67 歲 男，失眠多夢，左寸脈遲
2025-09-29 00:55:41,030 [INFO] s_cbr.DialogManager - 會話建立: e4ade4eab8ad4225bf3dd02e27a36f7e
2025-09-29 00:55:41,030 [ERROR] backend.main - 相容性查詢處理失敗: AttributeError("'SpiralEngine' object has no attribute 'execute_spiral_cycle'")
Traceback (most recent call last):
  File "C:\work\系統-中醫\Pulse-project\Backend\main.py", line 231, in api_query_compatibility
    result = await run_spiral_cbr(
  File "C:\work\系統-中醫\Pulse-project\Backend\s_cbr\main.py", line 64, in run_spiral_cbr
    return await engine.diagnose(question, **kwargs)
  File "C:\work\系統-中醫\Pulse-project\Backend\s_cbr\main.py", line 50, in diagnose
    result = await self.spiral.execute_spiral_cycle(question, session_id)
AttributeError: 'SpiralEngine' object has no attribute 'execute_spiral_cycle'
2025-09-29 00:58:36,067 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:58:36,067 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:58:36,067 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:58:39,729 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:58:39,733 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:58:39,734 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:58:39,734 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:58:39,734 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:58:39,734 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:58:39,735 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:58:39,735 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:58:39,735 [INFO] backend.main - Application startup completed.
2025-09-29 00:58:42,025 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 00:58:42,025 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 00:58:42,026 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 00:59:02,207 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 00:59:02,211 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 00:59:02,212 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 00:59:02,212 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 00:59:02,212 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 00:59:02,212 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 00:59:02,212 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 00:59:02,213 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 00:59:02,213 [INFO] backend.main - Application startup completed.
2025-09-29 00:59:14,657 [ERROR] backend.main - /api/query payload debug type=dict, keys=['question', 'session_id', 'continue', 'patient_ctx']
2025-09-29 00:59:14,659 [INFO] s_cbr.SCBREngine - 🌀 啟動診斷 [SCBR-20250929-005914-90360a47] 問題: 患者 67 歲 男，失眠多夢，左寸脈遲
2025-09-29 00:59:14,659 [INFO] s_cbr.DialogManager - 會話建立: 1331fd974b7e40919d72e3838c8f58f8
2025-09-29 00:59:14,659 [INFO] s_cbr.DialogManager - 會話建立: 1331fd974b7e40919d72e3838c8f58f8
2025-09-29 00:59:14,659 [INFO] s_cbr.DialogManager - 繼續會話: 1331fd974b7e40919d72e3838c8f58f8
2025-09-29 00:59:18,171 [INFO] s_cbr.SpiralEngine - 🧭 q_vector: dim=1024
2025-09-29 00:59:18,172 [INFO] s_cbr.SearchEngine - 🔎 Case HYBRID α=0.5, qdim=1024, ‖v‖₂=0.9999
2025-09-29 00:59:18,172 [INFO] s_cbr.SearchEngine - ↪ return props=['src_casev_uuid', 'diagnosis_main', 'pulse_text']... | search_fields=['search_all', 'search_all_seg']
2025-09-29 00:59:18,233 [INFO] s_cbr.SearchEngine - 📊 Case 搜索: 20 個結果
2025-09-29 00:59:18,234 [INFO] s_cbr.SearchEngine - 🔎 PulsePJV HYBRID α=0.5, qdim=1024, ‖v‖₂=0.9999
2025-09-29 00:59:18,234 [INFO] s_cbr.SearchEngine - ↪ return props=['symptoms', 'category_id', 'name']... | search_fields=['search_all', 'search_all_seg']
2025-09-29 00:59:18,298 [INFO] s_cbr.SearchEngine - 📊 PulsePJV 搜索: 20 個結果
2025-09-29 00:59:18,311 [INFO] s_cbr.SearchEngine - 🔎 RPCase HYBRID α=0.5, qdim=1024, ‖v‖₂=0.9999
2025-09-29 00:59:18,312 [INFO] s_cbr.SearchEngine - ↪ return props=['pulse_tags', 'symptom_tags', 'final_diagnosis']... | search_fields=['search_all', 'search_all_seg']
2025-09-29 00:59:18,337 [INFO] s_cbr.SearchEngine - 📊 RPCase 搜索: 3 個結果
2025-09-29 00:59:18,339 [INFO] s_cbr.DialogManager - 記錄輪次 1 結果於 1331fd974b7e40919d72e3838c8f58f8
2025-09-29 00:59:18,339 [INFO] s_cbr.SCBREngine - 🌀 啟動診斷 [SCBR-20250929-005918-f1776397] 問題: 患者 67 歲 男，失眠多夢，左寸脈遲
2025-09-29 00:59:18,339 [INFO] s_cbr.DialogManager - 會話建立: c30a6baa3aab4761b279509f9a34f24d
2025-09-29 00:59:18,340 [INFO] s_cbr.DialogManager - 會話建立: c30a6baa3aab4761b279509f9a34f24d
2025-09-29 00:59:18,340 [INFO] s_cbr.DialogManager - 繼續會話: c30a6baa3aab4761b279509f9a34f24d
2025-09-29 00:59:19,694 [INFO] s_cbr.SpiralEngine - 🧭 q_vector: dim=1024
2025-09-29 00:59:19,695 [INFO] s_cbr.SearchEngine - 🔎 Case HYBRID α=0.5, qdim=1024, ‖v‖₂=0.9999
2025-09-29 00:59:19,695 [INFO] s_cbr.SearchEngine - ↪ return props=['src_casev_uuid', 'diagnosis_main', 'pulse_text']... | search_fields=['search_all', 'search_all_seg']
2025-09-29 00:59:19,761 [INFO] s_cbr.SearchEngine - 📊 Case 搜索: 20 個結果
2025-09-29 00:59:19,762 [INFO] s_cbr.SearchEngine - 🔎 PulsePJV HYBRID α=0.5, qdim=1024, ‖v‖₂=0.9999
2025-09-29 00:59:19,762 [INFO] s_cbr.SearchEngine - ↪ return props=['symptoms', 'category_id', 'name']... | search_fields=['search_all', 'search_all_seg']
2025-09-29 00:59:19,829 [INFO] s_cbr.SearchEngine - 📊 PulsePJV 搜索: 20 個結果
2025-09-29 00:59:19,829 [INFO] s_cbr.SearchEngine - 🔎 RPCase HYBRID α=0.5, qdim=1024, ‖v‖₂=0.9999
2025-09-29 00:59:19,829 [INFO] s_cbr.SearchEngine - ↪ return props=['pulse_tags', 'symptom_tags', 'final_diagnosis']... | search_fields=['search_all', 'search_all_seg']
2025-09-29 00:59:19,885 [INFO] s_cbr.SearchEngine - 📊 RPCase 搜索: 3 個結果
2025-09-29 00:59:19,887 [INFO] s_cbr.DialogManager - 記錄輪次 1 結果於 c30a6baa3aab4761b279509f9a34f24d
2025-09-29 01:06:43,753 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 01:06:43,753 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 01:06:43,753 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 01:06:47,577 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 01:06:47,580 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 01:06:47,580 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 01:06:47,580 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 01:06:47,581 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 01:06:47,581 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 01:06:47,581 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 01:06:47,581 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 01:06:47,582 [INFO] backend.main - Application startup completed.
2025-09-29 01:07:10,186 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 01:07:10,186 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 01:07:10,187 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 01:07:13,622 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 01:07:13,626 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 01:07:13,626 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 01:07:13,626 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 01:07:13,626 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 01:07:13,626 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 01:07:13,626 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 01:07:13,626 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 01:07:13,627 [INFO] backend.main - Application startup completed.
2025-09-29 01:08:09,370 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 01:08:09,371 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 01:08:09,371 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 01:08:12,655 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 01:08:12,658 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 01:08:12,658 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 01:08:12,658 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 01:08:12,658 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 01:08:12,658 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 01:08:12,658 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 01:08:12,658 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 01:08:12,658 [INFO] backend.main - Application startup completed.
2025-09-29 01:08:25,870 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 01:08:25,870 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 01:08:25,870 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 01:08:40,046 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 01:08:40,050 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 01:08:40,050 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 01:08:40,050 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 01:08:40,050 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 01:08:40,050 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 01:08:40,051 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 01:08:40,051 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 01:08:40,051 [INFO] backend.main - Application startup completed.
2025-09-29 01:08:52,675 [ERROR] backend.main - /api/query payload debug type=dict, keys=['question', 'session_id', 'continue', 'patient_ctx']
2025-09-29 01:08:52,677 [INFO] s_cbr.SCBREngine - 🌀 啟動診斷 [SCBR-20250929-010852-9685412d] 問題: 患者 67 歲 男，失眠多夢，左寸脈遲
2025-09-29 01:08:52,677 [INFO] s_cbr.DialogManager - 會話建立: cca8b07b5a344484acfc5740fb4a2f54
2025-09-29 01:08:52,677 [INFO] s_cbr.SpiralEngine - 🧭 q_vector: dim=0
2025-09-29 01:08:52,678 [ERROR] backend.main - 相容性查詢處理失敗: AttributeError("'SpiralEngine' object has no attribute 'search_engine'")
Traceback (most recent call last):
  File "C:\work\系統-中醫\Pulse-project\Backend\main.py", line 231, in api_query_compatibility
    result = await run_spiral_cbr(
  File "C:\work\系統-中醫\Pulse-project\Backend\s_cbr\main.py", line 64, in run_spiral_cbr
    return await engine.diagnose(question, **kwargs)
  File "C:\work\系統-中醫\Pulse-project\Backend\s_cbr\main.py", line 50, in diagnose
    result = await self.spiral.execute_spiral_cycle(question, session_id)
  File "C:\work\系統-中醫\Pulse-project\Backend\s_cbr\core\spiral_engine.py", line 138, in execute_spiral_cycle
    srch = self.search_engine
AttributeError: 'SpiralEngine' object has no attribute 'search_engine'
2025-09-29 01:18:33,017 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 01:18:33,018 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 01:18:33,018 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 01:18:36,677 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 01:18:36,685 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 01:18:36,685 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 01:18:36,685 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 01:18:36,685 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 01:18:36,685 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 01:18:36,686 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 01:18:36,686 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 01:18:36,686 [INFO] backend.main - Application startup completed.
2025-09-29 01:18:52,349 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 01:18:52,349 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 01:18:52,349 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 01:18:54,522 [ERROR] backend.main - ❌ S-CBR v2.1 路由器整合失敗: 'SpiralEngine' object has no attribute 'searcher'
2025-09-29 01:18:54,527 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 01:18:54,527 [WARNING] backend.main -    - S-CBR 螺旋推理引擎: ❌ 未載入
2025-09-29 01:18:54,527 [WARNING] backend.main -    - API 端點 /api/scbr/v2/*: ❌ 不可用
2025-09-29 01:18:54,528 [ERROR] backend.main -    - 載入錯誤: 'SpiralEngine' object has no attribute 'searcher'
2025-09-29 01:18:54,528 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 01:18:54,528 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 01:18:54,528 [INFO] backend.main - Application startup completed.
2025-09-29 01:19:25,100 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 01:19:25,100 [INFO] backend.main - 🔻 Application shutdown completed.
2025-09-29 01:19:28,637 [INFO] backend.main - ✅ S-CBR v2.1 路由器整合成功
2025-09-29 01:19:28,640 [INFO] backend.main - 🚀 TCM S-CBR Backend v2.1 啟動
2025-09-29 01:19:28,641 [INFO] backend.main -    - S-CBR v2.1 螺旋推理引擎: ✅ 已載入
2025-09-29 01:19:28,641 [INFO] backend.main -    - API 端點 /api/scbr/v2/*: ✅ 可用
2025-09-29 01:19:28,641 [INFO] backend.main -    - 累積式多輪對話: ✅ 支援
2025-09-29 01:19:28,641 [INFO] backend.main -    - Hybrid 搜索引擎: ✅ 可用
2025-09-29 01:19:28,641 [INFO] backend.main -    - 病例存儲 /api/case/save: ✅ 可用
2025-09-29 01:19:28,642 [INFO] backend.main -    - 健康檢查 /healthz: ✅ 可用
2025-09-29 01:19:28,642 [INFO] backend.main - Application startup completed.
2025-09-29 01:19:35,554 [INFO] backend.main - 🔄 正在關閉應用程式...
2025-09-29 01:19:35,554 [INFO] backend.main -    - S-CBR v2.1 資源清理: ✅ 完成
2025-09-29 01:19:35,555 [INFO] backend.main - 🔻 Application shutdown completed.
